var B=(i,t)=>{for(let e in t)i.style[e]=t[e]},I=i=>document.getElementById(i),tt=(i,t="block")=>{i.style.display=t},k=i=>{i.style.display="none"},_=class{constructor(t=0,e=0){this.x=t,this.y=e}Copy(t){this.x=t.x,this.y=t.y}Clone(){return new _(this.x,this.y)}Add(t){return this.x+=t.x,this.y+=t.y,this}Sub(t){return this.x-=t.x,this.y-=t.y,this}Mult(t){return this.x*=t,this.y*=t,this}Norm(){return[this.x,this.y]=[this.y,-this.x],this}Unit(){let t=this.Mag();return t===0?this:(this.x/=t,this.y/=t,this)}MagSquared(){return Math.pow(this.x,2)+Math.pow(this.y,2)}Mag(){return Math.sqrt(this.MagSquared())}Lerp(t,e){return this.Add(t.Clone().Sub(this).Mult(e)),this}Rotate(t){let e=Math.sin(t),s=Math.cos(t),n=this.x*s-this.y*e,r=this.x*e+this.y*s;return this.x=n,this.y=r,this}Angle(){return Math.atan2(this.y,this.x)}static Dot(t,e){return t.x*e.x+t.y*e.y}static Dist(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static AngleBetween(t,e){let s=t.Mag(),n=e.Mag();return s===0||n===0?0:Math.acos(_.Dot(t,e)/(s*n))}},g=function(){return{rand(i,t){return Math.random()*(t-i)+i},randint(i,t){return Math.floor(Math.random()*(t-i+1)+i)},lerp(i,t,e){return t+(e-t)*i},clamp(i,t,e){return Math.min(Math.max(i,t),e)},in_range(i,t,e){return i>=t&&i<=e},sat(i){return Math.min(Math.max(i,0),1)},ease_out(i){return Math.min(Math.max(Math.pow(i,1/2),0),1)},ease_in(i){return Math.min(Math.max(Math.pow(i,3),0),1)}}}(),x=function(){return{fromAngle(i){let t=Math.sin(i),e=Math.cos(i),s=Math.SQRT2/2;if(e>=s)return"right";if(e<=-s)return"left";if(t>=s)return"bottom";if(t<=-s)return"top"},opposite(i){return{left:"right",right:"left",top:"bottom",bottom:"top"}[i]}}}(),et=class{constructor(t){this._params=t,this._renderer=t.renderer,this._sceneManager=t.scenes,this._callback=t.start,this._timeouts=[],this._paused=!0,this._Init()}Timeout(t,e){this._timeouts.push({action:t,dur:e,counter:0})}_Init(){this.Start();let t=I("intro-section-click"),e=I("intro-section"),s=navigator.userAgent.match(/ipod|ipad|iphone/i)?"touchstart":"click";t.addEventListener(s,()=>{k(t),tt(e),this.Timeout(()=>this._callback(),2e3)},{once:!0})}_RAF(){this._paused||(this._frame=window.requestAnimationFrame(t=>{this._previousRAF||(this._previousRAF=performance.now());let e=Math.min(t-this._previousRAF,1e3/30);for(let s=0;s<this._timeouts.length;++s){let n=this._timeouts[s];(n.counter+=e)>=n.dur&&(n.action(),this._timeouts.splice(s--,1))}if(this._sceneManager._currentScene){this._renderer.Render();let s=e*.001;this._sceneManager._currentScene.Update(s)}this._previousRAF=t,this._RAF()}))}Start(){this._paused=!1,this._RAF()}Stop(){this._paused=!0,window.cancelAnimationFrame(this._frame)}},st=class{constructor(t){this._params=t,this._container=t.container,this._canvas=t.canvas,this._width=t.width,this._height=t.height,this._sceneManager=t.scenes,this._bgColor="black",this._Init()}get dimension(){return this._canvas.getBoundingClientRect()}_Init(){B(document.body,{"user-select":"none","-webkit-user-select":"none","-ms-touch-action":"none","touch-action":"none",position:"relative",height:"100%",overflow:"hidden",margin:"0",padding:"0"}),this._aspect=this._width/this._height,this._scale=1,this._container.style.width=this._width+"px",this._container.style.height=this._height+"px",B(this._container,{position:"absolute",left:"50%",top:"50%","transform-origin":"center"}),this._canvas.width=this._width,this._canvas.height=this._height,this._context=this._canvas.getContext("2d"),B(this._canvas,{position:"absolute",left:"0",top:"0",display:"block"}),this._InitSections(),this._InitEvents(),this._OnResize(),window.addEventListener("resize",()=>this._OnResize())}CreateSection(t){let e=document.createElement("div");return e.id=t,e.classList.add("game-section"),this._container.appendChild(e),e}_InitSections(){let t=document.getElementsByClassName("game-section");for(let n of t)k(n);let e=this.CreateSection("intro-section-click");e.innerHTML=`
            <div class="centered-both">
                <h3>Click to start</h3>
            </div>
        `;let s=this.CreateSection("intro-section");s.innerHTML=`
            <div class="centered-both">
                <div class="intro-section_container">
                    <svg class="intro-section_logo" version="1.0" xmlns="http://www.w3.org/2000/svg" width="306.000000pt" height="431.000000pt" viewBox="0 0 306.000000 431.000000" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(0.000000,431.000000) scale(0.100000,-0.100000)" fill="#FFFFFF" stroke="none">
                        <path d="M1546 3868 c-10 -68 -50 -397 -90 -731 l-72 -608 -50 -29 c-28 -15
                -82 -59 -120 -96 -38 -37 -75 -69 -81 -70 -20 -3 -89 -61 -128 -106 -37 -44
                -71 -121 -81 -188 -4 -26 -19 -53 -41 -77 -54 -57 -109 -133 -138 -190 -17
                -34 -41 -63 -69 -82 -65 -45 -131 -124 -145 -173 -17 -62 -2 -118 69 -254 81
                -155 80 -178 -19 -305 l-20 -26 64 -88 c50 -68 73 -91 100 -101 l36 -12 49 85
                c28 46 66 116 85 154 43 84 92 133 175 176 61 31 63 32 101 16 22 -8 41 -14
                43 -12 2 2 10 17 18 33 l15 29 37 -61 c46 -76 109 -147 179 -201 44 -34 60
                -41 81 -35 34 8 121 105 197 219 33 50 58 79 55 65 -4 -17 1 -34 17 -53 l23
                -28 27 21 27 21 77 -38 c84 -41 109 -68 139 -151 82 -223 96 -249 130 -238 26
                8 164 181 164 204 0 9 -14 44 -30 77 -53 108 -41 159 67 279 67 75 86 118 81
                187 -5 65 -44 138 -116 217 -24 26 -51 60 -59 76 -8 15 -35 56 -60 90 -25 33
                -56 84 -70 111 -14 28 -29 52 -34 55 -4 3 -17 31 -29 62 -26 71 -66 125 -126
                174 -27 22 -84 73 -129 115 -44 41 -99 88 -122 104 -37 24 -43 32 -43 64 -1
                60 -119 1218 -137 1334 -9 59 -19 107 -22 107 -4 0 -15 -55 -25 -122z m64
                -894 c22 -220 40 -406 40 -415 0 -15 -6 -16 -42 -7 -24 5 -65 8 -92 5 l-48 -4
                5 41 c3 22 25 208 49 413 23 204 44 370 46 369 1 -2 21 -183 42 -402z m75
                -534 c33 -16 95 -61 138 -100 l77 -72 0 -141 c0 -232 -11 -272 -122 -448 -29
                -47 -91 -156 -138 -242 -47 -86 -87 -157 -90 -157 -3 0 -34 48 -70 107 -36 60
                -113 183 -172 275 -58 93 -105 168 -103 168 15 0 53 -24 49 -31 -2 -4 8 -15
                23 -23 44 -22 66 -53 127 -171 66 -129 118 -197 137 -178 10 10 16 10 27 1 12
                -10 19 -7 39 17 26 33 75 129 125 250 23 55 41 83 58 92 14 7 24 19 22 27 -1
                8 7 17 18 21 11 3 20 10 20 14 0 18 -124 292 -160 352 -52 87 -90 119 -141
                119 -73 0 -145 -90 -284 -354 l-68 -129 -20 39 c-26 51 -32 143 -17 269 l12
                105 75 72 c131 128 200 161 313 153 45 -3 84 -14 125 -35z m-87 -242 c37 -54
                64 -108 118 -232 38 -90 41 -101 27 -112 -14 -10 -23 -3 -58 45 -109 148 -178
                148 -289 1 -27 -36 -51 -66 -55 -67 -3 -1 -14 4 -25 12 -17 13 -16 18 34 112
                29 54 73 130 97 168 83 130 105 140 151 73z m-522 -150 c-1 -169 -1 -169 124
                -363 45 -70 80 -128 78 -130 -2 -2 -34 7 -73 21 -41 14 -94 24 -127 24 l-57 0
                -10 -37 c-13 -47 -14 -114 -2 -145 10 -25 25 -42 90 -101 22 -21 41 -42 41
                -46 0 -16 -213 67 -239 93 -23 24 -24 28 -12 49 63 100 78 163 92 387 12 196
                29 286 64 346 14 24 27 44 28 44 2 0 3 -64 3 -142z m951 105 c57 -78 58 -83
                63 -323 5 -222 6 -226 33 -278 l28 -53 -25 -44 c-14 -24 -43 -56 -63 -72 -51
                -39 -133 -95 -133 -90 0 2 14 22 31 43 43 53 65 101 74 154 4 25 11 53 16 62
                7 13 1 21 -25 37 -46 29 -110 27 -171 -4 -27 -13 -50 -23 -51 -22 -1 1 29 53
                67 116 38 63 76 137 84 166 12 40 33 233 35 323 0 20 15 14 37 -15z m-427
                -275 c75 -94 76 -100 45 -182 -16 -39 -41 -98 -58 -131 l-29 -59 -20 24 c-11
                14 -45 74 -75 134 -62 124 -63 113 13 209 27 33 53 57 65 57 10 0 36 -22 59
                -52z m655 -115 c40 -59 43 -85 16 -128 -41 -63 -56 -78 -68 -63 -23 30 -33 87
                -33 192 l1 111 25 -30 c13 -16 40 -53 59 -82z m-1364 -97 c-12 -89 -30 -156
                -42 -156 -5 0 -19 19 -31 43 -42 80 -25 167 50 267 l27 35 3 -55 c2 -30 -2
                -90 -7 -134z m1496 -73 c52 -71 66 -130 41 -176 -6 -12 -37 -53 -70 -90 -32
                -38 -67 -86 -78 -107 -26 -51 -26 -125 1 -198 11 -31 23 -64 25 -72 3 -8 -13
                -35 -34 -59 l-38 -44 -28 84 c-55 161 -100 221 -193 263 -24 10 -43 22 -43 25
                0 3 26 22 58 41 74 45 137 103 168 157 14 23 52 70 84 103 33 34 62 70 65 81
                9 26 18 24 42 -8z m-1663 -16 c3 -19 22 -60 41 -91 19 -32 33 -62 30 -66 -3
                -5 -1 -12 5 -15 8 -5 8 -11 0 -19 -7 -10 -2 -24 19 -54 27 -37 84 -72 180
                -109 24 -9 23 -10 -22 -36 -64 -38 -105 -90 -178 -227 -35 -66 -66 -120 -69
                -120 -3 0 -19 21 -37 46 l-32 47 23 31 c42 55 56 94 56 150 0 49 -8 70 -64
                178 -92 177 -94 201 -18 281 44 46 58 47 66 4z m1199 -78 c-34 -59 -68 -79
                -135 -79 -51 0 -59 2 -56 18 2 10 11 16 23 15 11 -2 52 15 90 37 87 49 103 51
                78 9z m-687 -19 c42 -17 83 -29 90 -26 16 6 38 -19 29 -34 -8 -13 -95 -13
                -130 0 -26 10 -85 67 -85 82 0 13 16 9 96 -22z m523 -145 c12 -13 -120 -217
                -193 -298 l-35 -39 -46 39 c-67 54 -120 125 -161 211 -19 41 -34 75 -32 77 2
                1 30 6 63 10 l60 6 48 -79 c38 -62 53 -79 67 -75 10 3 27 0 38 -6 19 -10 25
                -4 68 80 l47 91 36 -7 c20 -4 38 -8 40 -10z"/>
                        </g>
                    </svg>
                
                    <div>
                        <p class="intro-section_label">Powered by</p>
                        <h1 class="intro-section_title">Lancelot.js</h1>
                    </div>
                </div>
            </div>
        `,k(s)}_InitEvents(){this._mouse={pressed:!1,x:null,y:null},this._keys=new Set,"ontouchstart"in document?(this._canvas.addEventListener("touchstart",e=>this._HandleTouchEvent(e)),this._canvas.addEventListener("touchmove",e=>this._HandleTouchEvent(e)),this._canvas.addEventListener("touchend",e=>this._HandleTouchEvent(e))):(this._canvas.addEventListener("mousedown",e=>this._HandleMouseEvent(e)),this._canvas.addEventListener("mousemove",e=>this._HandleMouseEvent(e)),this._canvas.addEventListener("mouseup",e=>this._HandleMouseEvent(e))),window.addEventListener("keydown",e=>this._HandleKeyEvent(e)),window.addEventListener("keyup",e=>this._HandleKeyEvent(e)),this._canvas.onclick=()=>{let e=this._sceneManager._currentScene;!e||e._On("click")}}_CreateMouseEventObject=(t,e,s,n)=>{let r=this.Display2SceneCoords(n,t,e);return{x:r.x,y:r.y,id:s}};_HandleTouchEvent(t){let e=this._sceneManager._currentScene;if(!e)return;let s={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};for(let n of t.changedTouches)e._On(s[t.type]||"",this._CreateMouseEventObject(n.pageX,n.pageY,n.identifier,e))}_HandleMouseEvent(t){t.type=="mousedown"?this._mouse.pressed=!0:t.type=="mouseup"&&(this._mouse.pressed=!1);let e=this._sceneManager._currentScene;!e||e._On(t.type,this._CreateMouseEventObject(t.pageX,t.pageY,0,e))}_HandleKeyEvent(t){t.type=="keydown"?this._keys.add(t.key):this._keys.delete(t.key);let e=this._sceneManager._currentScene;!e||e._On(t.type,{key:t.key})}IsKeyPressed(t){return this._keys.has(t)}IsMousePressed(){return this._mouse.pressed}_OnResize(){let[t,e]=[document.body.clientWidth,document.body.clientHeight];t/e>this._aspect?this._scale=e/this._height:this._scale=t/this._width,this._container.style.transform="translate(-50%, -50%) scale("+this._scale+")",this._context.imageSmoothingEnabled=!1}Render(){let t=this._sceneManager._currentScene;if(!!t){this._context.beginPath(),this._context.fillStyle=this._bgColor,this._context.fillRect(0,0,this._width,this._height),this._context.save(),this._context.translate(-t._camera.pos.x*t._camera._scale+this._width/2,-t._camera.pos.y*t._camera._scale+this._height/2),this._context.scale(t._camera._scale,t._camera._scale);for(let e of t._drawable){let s=e._pos.Clone();s.Sub(t._camera.pos),s.Mult(t._camera._scale);let[n,r]=[e.width,e.height].map(a=>a*t._camera._scale);s.x+n/2<-this._width/2||s.x-n/2>this._width/2||s.y+r/2<-this._height/2||s.y-r/2>this._height/2||e.Draw(this._context)}this._context.restore()}}Display2SceneCoords(t,e,s){let n=this.dimension,r=(e-n.left)/this._scale,a=(s-n.top)/this._scale;return{x:(r-this._width/2)/t._camera._scale+t._camera._pos.x,y:(a-this._height/2)/t._camera._scale+t._camera._pos.y}}},it=class{constructor(){this._currentScene=null,this._scenes=new Map}set currentScene(t){this._currentScene=this._scenes.get(t)||null}Add(t,e){this._scenes.set(e,t)}Play(t){return this.currentScene=t,this._currentScene&&this._currentScene.Play(),this._currentScene}},nt=class{constructor(t){this._params=t,this._resources=t.resources,this._input=t.input,this._bounds=t.bounds,this._cellDimensions=t.cellDimensions||[50,50],this._interactiveEntities=[],this._timeouts=[],this._Init()}Timeout(t,e){this._timeouts.push({action:t,dur:e,counter:0})}_Init(){this._paused=!0,this._speed=1,this._entityManager=new L,this._spatialGrid=new F(this._bounds,[Math.floor((this._bounds[1][0]-this._bounds[0][0])/this._cellDimensions[0]),Math.floor((this._bounds[1][1]-this._bounds[0][1])/this._cellDimensions[1])]),this._camera=new z,this._drawable=[],this._eventHandlers=new Map,this._interactive=[];let t=new b;t.AddComponent(new U(this._entityManager._entities)),this.AddEntity(t)}AddEventHandler(t,e){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(e)}RemoveEventHandler(t,e){if(!this._eventHandlers.has(t))return;let s=this._eventHandlers.get(t),n=s.indexOf(e);n>-1&&s.splice(n,1)}SetInteractive(t,e){this._interactiveEntities.push(t);let s=new G(e);t.AddComponent(s),t.interactive=s}_On(t,e){if(this._eventHandlers.has(t)){let s=this._eventHandlers.get(t);for(let n of s)n(e)}if(t=="mousedown"){let s=this._spatialGrid.FindNear([e.x,e.y],[0,0]).map(n=>n.entity);for(let n of s)if(!!n.interactive&&n.body.Contains(new _(e.x,e.y))&&(n.interactive._On(t,e),n.interactive._id=e.id,n.interactive._capture))break}else if(t=="mousemove"||t=="mouseup")for(let s of this._interactiveEntities)s.interactive._id==e.id&&(s.interactive._On(t,e),t=="mouseup"&&(s.interactive._id=-1))}GetEntityByName(t){return this._entityManager.Get(t)}GetEntitiesByGroup(t){return this._entityManager.Filter(e=>e.groupList.has(t))}AddEntity(t,e){t._scene=this,this._entityManager.Add(t,e),t._components.forEach(n=>{n._type=="drawable"&&this._AddDrawable(n)});let s=t.GetComponent("Body");if(s){t.body=s;let n=new j({grid:this._spatialGrid,width:s.width,height:s.height});t.AddComponent(n)}}RemoveEntity(t){this._entityManager.Remove(t),t._components.forEach(s=>{s._type=="drawable"&&this._RemoveDrawable(s)});let e=t.GetComponent("SpatialGridController");e&&this._spatialGrid.RemoveClient(e._client)}_AddDrawable(t){this._drawable.push(t);for(let e=this._drawable.length-1;e>0&&!(t._zIndex>=this._drawable[e-1]._zIndex);--e)[this._drawable[e],this._drawable[e-1]]=[this._drawable[e-1],this._drawable[e]]}Play(){this._paused=!1}Pause(){this._paused=!0}_RemoveDrawable(t){let e=this._drawable.indexOf(t);e>0&&this._drawable.splice(e,1)}Update(t){if(!this._paused){for(let e=0;e<this._timeouts.length;++e){let s=this._timeouts[e];(s.counter+=t*1e3)>=s.dur&&(s.action(),this._timeouts.splice(e--,1))}t*=this._speed,this._entityManager.Update(t),this._camera.Update(t)}}},F=class{constructor(t,e){let[s,n]=e;this._cells=[...Array(n)].map(r=>[...Array(s)].map(a=>null)),this._dimensions=e,this._bounds=t}NewClient(t,e){let s={position:t,dimensions:e,indices:null};return this._InsertClient(s),s}_InsertClient(t){let[e,s]=t.dimensions,[n,r]=t.position,a=this._GetCellIndex([n-e/2,r-s/2]),d=this._GetCellIndex([n+e/2,r+s/2]);t.indices=[a,d];for(let c=a[1];c<=d[1];++c)for(let l=a[0];l<=d[0];++l)this._cells[c][l]||(this._cells[c][l]=new Set),this._cells[c][l].add(t)}_GetCellIndex(t){let e=g.sat((t[0]-this._bounds[0][0])/(this._bounds[1][0]-this._bounds[0][0])),s=g.sat((t[1]-this._bounds[0][1])/(this._bounds[1][1]-this._bounds[0][1])),n=Math.floor(e*(this._dimensions[0]-1)),r=Math.floor(s*(this._dimensions[1]-1));return[n,r]}FindNear(t,e){let[s,n]=e,[r,a]=t,d=this._GetCellIndex([r-s/2,a-n/2]),c=this._GetCellIndex([r+s/2,a+n/2]),l=new Set;for(let u=d[1];u<=c[1];++u)for(let p=d[0];p<=c[0];++p)if(this._cells[u][p])for(let o of this._cells[u][p])l.add(o);return Array.from(l)}UpdateClient(t){this.RemoveClient(t),this._InsertClient(t)}RemoveClient(t){let[e,s]=t.indices;for(let n=e[1];n<=s[1];++n)for(let r=e[0];r<=s[0];++r)this._cells[n][r].delete(t)}},z=class{constructor(){this._pos=new _,this._scale=1,this._target=null,this._vel=new _,this._scaling=null,this._moving=null,this._shaking=null,this._offset=new _}get pos(){return this._pos.Clone().Add(this._offset)}get shaking(){return this._shaking}get scaling(){return this._scaling}get moving(){return this._moving}Follow(t){this._target=t}Unfollow(){this._target=null}SetPosition(t){this._pos.Copy(t)}SetScale(t){this._scale=t}ScaleTo(t,e,s="linear"){this._scaling={counter:0,dur:e,from:this._scale,to:t,timing:s}}MoveTo(t,e,s="linear"){this._moving={counter:0,dur:e,from:this._pos.Clone(),to:t,timing:s}}Shake(t,e,s,n){this._shaking={counter:0,count:s,angle:n,dur:e,range:t}}Reset(){this._pos=new _(0,0),this._scale=1,this._scaling=null,this._moving=null}Update(t){if(this._moving){let e=this._moving;e.counter+=t*1e3;let s=Math.min(e.counter/e.dur,1),n;switch(e.timing){case"linear":n=s;break;case"ease-in":n=g.ease_in(s);break;case"ease-out":n=g.ease_out(s);break}this._pos.Copy(e.from.Clone().Lerp(e.to,n)),s==1&&(this._moving=null)}else if(this._target)if(_.Dist(this._pos,this._target._pos)<1)this._pos.Copy(this._target._pos);else{let e=4*t;this._pos.Lerp(this._target._pos,e)}else{let e=this._vel.Clone();e.Mult(t),this._pos.Add(e)}if(this._scaling){let e=this._scaling;e.counter+=t*1e3;let s=Math.min(e.counter/e.dur,1),n;switch(e.timing){case"linear":n=s;break;case"ease-in":n=g.ease_in(s);break;case"ease-out":n=g.ease_out(s);break}this._scale=g.lerp(n,e.from,e.to),s==1&&(this._scaling=null)}if(this._shaking){let e=this._shaking;e.counter+=t*1e3;let s=Math.min(e.counter/e.dur,1);this._offset.Copy(new _(Math.sin(s*Math.PI*2*e.count)*e.range,0).Rotate(e.angle)),s==1&&(this._scaling=null)}}},L=class{constructor(){this._entities=[],this._entitiesMap=new Map,this._ids=0}_GenerateName(){return++this._ids,"__entity__"+this._ids}Add(t,e){e===void 0&&(e=this._GenerateName()),this._entities.push(t),this._entitiesMap.set(e,t),t._parent=this,t._name=e}Get(t){return this._entitiesMap.get(t)}Remove(t){let e=this._entities.indexOf(t);e<0||this._entities.splice(e,1)}Filter(t){return this._entities.filter(t)}Update(t){for(let e of this._entities)e.Update(t)}},b=class{constructor(){this._pos=new _(0,0),this._components=new Map,this._parent=null,this._name=null,this._scene=null,this.groupList=new Set;let t=new O;this.AddComponent(t),this.animator=t}Update(t){this._components.forEach(e=>{e.Update(t)})}AddComponent(t,e){e===void 0&&(e=t.constructor.name),this._components.set(e,t),t._parent=this,t.InitComponent()}GetComponent(t){return this._components.get(t)}SetPosition(t){if(this.body&&!this.body._fixed){let e=this.body._pos.Clone().Sub(this._pos);this.body.SetPosition(t.Clone().Add(e))}this._pos.Copy(t)}FindEntity(t){return this._parent.Get(t)}},y=class{constructor(){this._type="",this._parent=null}get scene(){return this._parent._scene}InitComponent(){}GetComponent(t){return this._parent.GetComponent(t)}FindEntity(t){return this._parent.FindEntity(t)}Update(t){}},U=class extends y{constructor(t){super();this._entities=t}Update(t){for(let e of this._entities){let s=e.body;s&&(s._collisions.left.clear(),s._collisions.right.clear(),s._collisions.top.clear(),s._collisions.bottom.clear())}}},G=class extends y{constructor(t){super();this._capture=t.capture,this._eventHandlers=new Map}AddEventHandler(t,e){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(e)}RemoveEventHandler(t,e){if(!this._eventHandlers.has(t))return;let s=this._eventHandlers.get(t),n=s.indexOf(e);n>-1&&s.splice(n,1)}_On(t,e){if(!this._eventHandlers.has(t))return;let s=this._eventHandlers.get(t);for(let n of s)n(e)}},O=class extends y{constructor(){super();this._moving=null}MoveTo(t,e,s="linear"){this._moving={counter:0,dur:e,from:this._parent._pos.Clone(),to:t,timing:s}}Update(t){if(this._moving){let e=this._moving;e.counter+=t*1e3;let s=Math.min(e.counter/e.dur,1),n;switch(e.timing){case"linear":n=s;break;case"ease-in":n=g.ease_in(s);break;case"ease-out":n=g.ease_out(s);break}this._parent.SetPosition(e.from.Clone().Lerp(e.to,n)),s==1&&(this._moving=null)}}},j=class extends y{constructor(t){super();this._params=t,this._width=this._params.width,this._height=this._params.height,this._grid=this._params.grid}set width(t){this._width=t,this._Reset()}set height(t){this._height=t,this._Reset()}InitComponent(){let t=[this._parent.body._pos.x,this._parent.body._pos.y];this._client=this._grid.NewClient(t,[this._width,this._height]),this._client.entity=this._parent}_Reset(){this._grid.RemoveClient(this._client),this.InitComponent()}Update(t){let e=[this._parent.body._pos.x,this._parent.body._pos.y];e[0]==this._client.position[0]&&e[1]==this._client.position[1]||(this._client.position=e,this._grid.UpdateClient(this._client))}FindNearby(t,e){return this._grid.FindNear([this._parent._pos.x,this._parent._pos.y],[t,e]).filter(n=>n.entity!=this._parent).map(n=>n.entity)}},v=class extends y{constructor(t){super();this._type="drawable",this._params=t,this._pos=new _,this._width=this._params.width||0,this._height=this._params.height||0,this._height=0,this._fixed=this._params.fixed===void 0?!0:this._params.fixed,this._zIndex=this._params.zIndex||0,this._flip={x:this._params.flipX||!1,y:this._params.flipY||!1},this._angle=this._params.angle||0,this._opacity=this._params.opacity!==void 0?this._params.opacity:1,this._boundingBox={width:0,height:0}}set zIndex(t){this._zIndex=t,this.scene&&(this.scene._RemoveDrawable(this),this.scene._AddDrawable(this))}get width(){return this._boundingBox.width}get height(){return this._boundingBox.height}set width(t){this._width=t,this._UpdateBoundingBox()}set height(t){this._height=t,this._UpdateBoundingBox()}set angle(t){this._angle=t,this._UpdateBoundingBox()}InitComponent(){this._fixed&&(this._pos=this._parent._pos),this._UpdateBoundingBox()}_UpdateBoundingBox(){let t=new Array(4);t[0]=new _(-this._width/2,-this._height/2).Rotate(this._angle),t[1]=new _(this._width/2,-this._height/2).Rotate(this._angle),t[2]=new _(this._width/2,this._height/2).Rotate(this._angle),t[3]=new _(-this._width/2,this._height/2).Rotate(this._angle);let e=0,s=0;for(let n=0;n<2;++n){let r=Math.abs(t[n].x)+Math.abs(t[n+2].x),a=Math.abs(t[n].y)+Math.abs(t[n+2].y);r>e&&(e=r),a>s&&(s=a)}this._boundingBox={width:e,height:s}}SetSize(t,e){this._width=t,this._height=e}Draw(t){}},N=class extends v{constructor(t){super(t);this._text=this._params.text,this._lines=this._text.split(/\n/),this._padding=this._params.padding||0,this._fontSize=this._params.fontSize,this._fontFamily=this._params.fontFamily||"Arial",this._color=this._params.color||"black",this._ComputeDimensions()}get linesCount(){return this._lines.length}get lineHeight(){return this._fontSize+this._padding*2}set text(t){this._text=t,this._ComputeDimensions()}set fontSize(t){this._fontSize=t,this._ComputeDimensions()}set fontFamily(t){this._fontFamily=t,this._ComputeDimensions()}set padding(t){this._padding=t,this._ComputeDimensions()}_ComputeDimensions(){this._height=this.lineHeight*this.linesCount;let t=0,e=document.createElement("canvas").getContext("2d");e.font=`${this._fontSize}px '${this._fontFamily}'`;for(let s of this._lines){let n=e.measureText(s).width;n>t&&(t=n)}this._width=t,this._UpdateBoundingBox()}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this._opacity,t.translate(this._pos.x,this._pos.y),t.rotate(this._angle),t.fillStyle=this._color,t.font=`${this._fontSize}px '${this._fontFamily}'`,t.textAlign="center",t.textBaseline="middle";for(let e=0;e<this.linesCount;++e)t.fillText(this._lines[e],0,this.lineHeight*e-(this.linesCount-1)/2*this.lineHeight);t.restore()}},W=class extends v{constructor(t){super(t);this._width=this._params.width,this._height=this._params.height,this._image=this._params.image,this._frameWidth=this._params.frameWidth||this._image.width,this._frameHeight=this._params.frameHeight||this._image.height,this._framePos={x:this._params.posX||0,y:this._params.posY||0}}Draw(t){t.save(),t.globalAlpha=this._opacity,t.translate(this._pos.x,this._pos.y),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.rotate(this._angle),t.drawImage(this._image,this._framePos.x*this._frameWidth,this._framePos.y*this._frameHeight,this._frameWidth,this._frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}},T=class extends v{constructor(t){super(t);this._width=this._params.width,this._height=this._params.height,this._background=this._params.background||"black",this._borderColor=this._params.borderColor||"black",this._borderWidth=this._params.borderWidth||0}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this._opacity,t.translate(this._pos.x,this._pos.y),t.rotate(this._angle),t.fillStyle=this._background,t.strokeStyle=this._borderColor,t.lineWidth=this._borderWidth,t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill(),this._borderWidth>0&&t.stroke(),t.restore()}},V=class extends v{constructor(t){super(t);this._radius=this._params.radius,this._background=this._params.background||"black",this._borderColor=this._params.borderColor||"black",this._borderWidth=this._params.borderWidth||0}set radius(t){this._radius=t,this._UpdateBoundingBox()}_UpdateBoundingBox(){this._boundingBox={width:this._radius*2,height:this._radius*2}}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this._opacity,t.translate(this._pos.x,this._pos.y),t.fillStyle=this._background,t.strokeStyle=this._borderColor,t.lineWidth=this._borderWidth,t.arc(0,0,this._radius,0,2*Math.PI),t.fill(),this._borderWidth>0&&t.stroke(),t.restore()}},Y=class extends v{constructor(t){super(t);this._width=this._params.width,this._height=this._params.height,this._anims={},this._currentAnim=null,this._paused=!0,this._framePos={x:0,y:0}}AddAnim(t,e){this._anims[t]=e}PlayAnim(t,e,s,n){if(this.currentAnim==t)return;this._paused=!1;let r={name:t,rate:e,repeat:s,OnEnd:n,frame:0,counter:0};this._currentAnim=r,this._framePos=this._anims[r.name][r.frame]}Reset(){this._currentAnim&&(this._currentAnim.frame=0,this._currentAnim.counter=0)}Pause(){this._paused=!0}Resume(){this._currentAnim&&(this._paused=!1)}Update(t){if(this._paused)return;let e=this._currentAnim;e.counter+=t*1e3,e.counter>=e.rate&&(e.counter=0,++e.frame,e.frame>=this._anims[e.name].length&&(e.frame=0,e.OnEnd&&e.OnEnd(),e.repeat||(this._currentAnim=null,this._paused=!0)),this._framePos=this._anims[e.name][e.frame])}get currentAnim(){return this._currentAnim?this._currentAnim.name:null}Draw(t){t.save(),t.globalAlpha=this._opacity,t.translate(this._pos.x,this._pos.y),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.rotate(this._angle),t.drawImage(this._params.image,this._framePos.x*this._params.frameWidth,this._framePos.y*this._params.frameHeight,this._params.frameWidth,this._params.frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}},$=class extends v{constructor(t){super(t);this._dur=this._params.dur||1e3,this._lineWidth=this._params.lineWidth||5,this._rgb=this._params.rgb||[255,255,255],this._frames=[],this._width=this._params.width||100,this._height=this._params.height||100}get count(){return this._frames.length}Update(t){this._frames.unshift({pos:this._pos.Clone(),counter:0});for(let e=0;e<this._frames.length;++e)this._frames[e].counter+=t*1e3,this._frames[e].counter>=this._dur&&this._frames.splice(e--,1)}Draw(t){t.save();for(let e=0;e<this.count-1;++e){let s=this._frames[e].pos,n=this._frames[e+1].pos,r=t.createLinearGradient(s.x,s.y,n.x,n.y);r.addColorStop(0,`rgba(${this._rgb.join(",")},${(this.count-e)/this.count})`),r.addColorStop(1,`rgba(${this._rgb.join(",")},${(this.count-e-1)/this.count})`),t.beginPath(),t.strokeStyle=r,t.lineWidth=(this.count-e)/this.count*this._lineWidth+1,t.lineCap="round",t.moveTo(s.x,s.y),t.lineTo(n.x,n.y),t.stroke()}t.restore()}},E=class extends y{constructor(t){super();this._params=t,this._fixed=this._params.fixed===void 0?!0:this._params.fixed,this._pos=new _,this._oldPos=new _,this._vel=new _,this._passiveVel=new _,this._friction={x:this._params.frictionX||0,y:this._params.frictionY||0},this._bounce=this._params.bounce||0,this._decceleration=new _(-100*this._friction.x,-100*this._friction.y),this._mass=this._params.mass||0,this._collisions={left:new Set,right:new Set,top:new Set,bottom:new Set},this._options={followBottomObject:this._params.followBottomObject||!1},this._behavior=[]}get inverseMass(){return this._mass===0?0:1/this._mass}get width(){return 0}get height(){return 0}InitComponent(){this._fixed&&(this._pos=this._parent._pos),this._oldPos.Copy(this._pos)}SetPosition(t){this._pos.Copy(t),this._oldPos.Copy(t)}SetVelocity(t){this._vel.Copy(t)}AddBehavior(t,e,s){this._behavior.push({type:t,action:s,group:e})}Contains(t){return!1}Update(t){let e=new _(this._vel.x*this._decceleration.x,this._vel.y*this._decceleration.y);this._oldPos.Copy(this._pos),this._vel.Add(e.Mult(t)),this._pos.Add(this._vel.Clone().Mult(t)),this._pos.Add(this._passiveVel.Clone().Mult(t));let s=this.GetComponent("SpatialGridController");for(let n of this._behavior){let r=s.FindNearby(this.width+Math.abs(this._pos.x-this._oldPos.x),this.height+Math.abs(this._pos.y-this._oldPos.y)).filter(a=>a.groupList.has(n.group));r.sort((a,d)=>_.Dist(this._pos,a.body._pos)/new _(this.width+a.body.width,this.height+a.body.height).Mag()-_.Dist(this._pos,d.body._pos)/new _(this.width+d.body.width,this.height+d.body.height).Mag());for(let a of r)n.type=="resolveCollision"?Q.ResolveCollision(this,a.body)&&n.action&&n.action(a):n.type=="isCollision"&&Q.DetectCollision(this,a.body)&&n.action(a)}}},X=class extends E{constructor(t){super(t);this._width=t.width,this._height=t.height,this._edges=t.edges||[1,1,1,1]}_Project(t,e){let s=1/0,n=-1/0;for(let r=0;r<e.length;r++){let a=_.Dot(t,e[r]);a>n&&(n=a),a<s&&(s=a)}return{min:s,max:n}}get width(){return this._width}get height(){return this._height}set width(t){this._width=t,this.GetComponent("SpatialGridController").width=this.width}set height(t){this._height=t,this.GetComponent("SpatialGridController").height=this.height}get left(){return this._pos.x-this._width/2}get right(){return this._pos.x+this._width/2}get top(){return this._pos.y-this._height/2}get bottom(){return this._pos.y+this._height/2}get oldLeft(){return this._oldPos.x-this._width/2}get oldRight(){return this._oldPos.x+this._width/2}get oldTop(){return this._oldPos.y-this._height/2}get oldBottom(){return this._oldPos.y+this._height/2}Contains(t){return Math.abs(t.x-this._pos.x)<this._width/2&&Math.abs(t.y-this._pos.y)<this._height/2}},q=class extends E{constructor(t){super(t);this._radius=this._params.radius}_Project(t){let e=t.Clone().Mult(this._radius),s=this._pos.Clone().Add(e),n=this._pos.Clone().Sub(e),r=_.Dot(t,s),a=_.Dot(t,n);if(r<a){let d=r;r=a,a=d}return{min:a,max:r}}_FindNearestVertex(t){let e=1/0,s=null;for(let n=0;n<t.length;n++){let r=t[n].Clone().Sub(this._pos).Mag();r<e&&(e=r,s=n)}return{v:t[s]}}get width(){return this._radius*2}get height(){return this._radius*2}set radius(t){this._radius=t,this.GetComponent("SpatialGridController").width=this.width,this.GetComponent("SpatialGridController").height=this.height}Contains(t){return _.Dist(this._pos,t)<this._radius}},ot=(i,t)=>({collided:Math.abs(i._pos.x-t._pos.x)<=(i._width+t._width)/2&&Math.abs(i._pos.y-t._pos.y)<=(i._height+t._height)/2,info:null}),ht=(i,t)=>{if(i._mass==0&&t._mass==0)return;let e=1e-4,s=i._pos.Clone().Sub(i._oldPos),n=t._pos.Clone().Sub(t._oldPos);if(Math.abs(i._oldPos.x-t._oldPos.x)<(i._width+t._width)/2&&Math.abs(i._oldPos.y-t._oldPos.y)<(i._height+t._height)/2)if(Math.abs(i._oldPos.x-t._oldPos.x)/(i._width+t._width)<Math.abs(i._oldPos.y-t._oldPos.y)/(i._height+t._height)){let[l,u]=i._oldPos.y<=t._oldPos.y?[i,t]:[t,i];l._oldPos.y=l._pos.y=l._pos.y-(l.bottom-u.top)/(l.inverseMass+u.inverseMass)*l.inverseMass,u._oldPos.y=u._pos.y=l.bottom+u._height/2}else{let[l,u]=i._oldPos.x<=t._oldPos.x?[i,t]:[t,i];l._oldPos.x=l._pos.x=l._pos.x-(l.right-u.left)/(l.inverseMass+u.inverseMass)*l.inverseMass,u._oldPos.x=u._pos.x=l.right+u._width/2}let r,a;i.oldRight<=t.oldLeft?r=1:i.oldLeft>=t.oldRight?r=-1:r=0,i.oldBottom<=t.oldTop?a=1:i.oldTop>=t.oldBottom?a=-1:a=0;let d=!1,c=Math.max(i._bounce,t._bounce);if(a!=0&&d==!1){let l=a*(i._height+t._height)/2,u=n.y-s.y,p=(i._oldPos.y-t._oldPos.y+l)/(u+e);if(p>=0&&p<=1&&Math.abs(i._oldPos.x-t._oldPos.x+(s.x-n.x)*p)<(i._width+t._width)/2){d=!0;let[o,h]=a==1?[i,t]:[t,i];if(h._mass==0)(o._vel.y>=-o._passiveVel.y||o._vel.y>=h._vel.y)&&(o._oldPos.y=o._pos.y=h.top-o._height/2-e,o._vel.y>0&&(o._vel.y*=-c),o._options.followBottomObject&&o._passiveVel.Copy(h._vel));else if(o._mass==0)(h._vel.y<=-h._passiveVel.y||h._vel.y<=o._vel.y)&&(h._oldPos.y=h._pos.y=o.bottom+h._height/2+e,h._vel.y<0&&(h._vel.y*=-c));else if(o._vel.y>=h._vel.y){h._vel.y>=0?(h._oldPos.y=h._pos.y=h._pos.y+(o.bottom-h.top)/(o.inverseMass+h.inverseMass)*h.inverseMass,o._oldPos.y=o._pos.y=h.top-o._height/2-e):(o._vel.y<=0,o._oldPos.y=o._pos.y=o._pos.y-(o.bottom-h.top)/(o.inverseMass+h.inverseMass)*o.inverseMass,h._oldPos.y=h._pos.y=o.bottom+h._height/2+e);let f=-(1+c)*(o._vel.y-h._vel.y)/(o.inverseMass+h.inverseMass);o._vel.y+=f*o.inverseMass,h._vel.y-=f*h.inverseMass,o._options.followBottomObject&&o._passiveVel.Copy(h._vel)}o._collisions.bottom.add(h),h._collisions.top.add(o)}}if(r!=0&&d==!1){let l=r*(i._width+t._width)/2,u=n.x-s.x,p=(i._oldPos.x-t._oldPos.x+l)/(u+e);if(p>=0&&p<=1&&Math.abs(i._oldPos.y-t._oldPos.y+(s.y-n.y)*p)<(i._height+t._height)/2){d=!0;let[o,h]=r==1?[i,t]:[t,i];if(h._mass.x==0)(o._vel.x>=-o._passiveVel.x||o._vel.x>=h._vel.x)&&(o._oldPos.x=o._pos.x=h.left-o._width/2-e,o._vel.x>0&&(o._vel.x*=-c));else if(o._mass.x==0)(h._vel.x<=-h._passiveVel.x||h._vel.x<=o._vel.x)&&(h._oldPos.x=h._pos.x=o.right+h._width/2+e,h._vel.x<0&&(h._vel.x*=-c));else if(o._vel.x>=h._vel.x){h._vel.x>=0?(h._oldPos.x=h._pos.x=h._pos.x+(o.right-h.left)/(o.inverseMass+h.inverseMass)*h.inverseMass,o._oldPos.x=o._pos.x=h.left-o._width/2-e):o._vel.x<=0?(o._oldPos.x=o._pos.x=o._pos.x-(o.right-h.left)/(o.inverseMass+h.inverseMass)*o.inverseMass,h._oldPos.x=h._pos.x=o.right+h._width/2+e):(o._oldPos.x=o._pos.x=o._pos.x-(o.right-h.left)/(o.inverseMass+h.inverseMass)*o.inverseMass-e/2,h._oldPos.x=h._pos.x=o.right+h._width/2+e);let f=-(1+c)*(o._vel.x-h._vel.x)/(o.inverseMass+h.inverseMass);o._vel.x+=f*o.inverseMass,h._vel.x-=f*h.inverseMass}o._collisions.right.add(h),h._collisions.left.add(o)}}return d},K=(i,t)=>{let e=i._radius+t._radius,s=t._pos.Clone().Sub(i._pos);return s.MagSquared()<Math.pow(e,2)?{collided:!0,info:{n:s.Clone().Unit(),d:e-s.Mag()}}:{collided:!1,info:null}},rt=(i,t)=>{if(i._mass==0&&t._mass==0)return!1;let e=K(i,t);if(e.collided){let s=e.info.n.Clone().Mult(e.info.d/(i.inverseMass+t.inverseMass));if(i._pos.Sub(s.Clone().Mult(i.inverseMass)),i._oldPos.Copy(i._pos),t._pos.Add(s.Clone().Mult(t.inverseMass)),t._oldPos.Copy(t._pos),!(_.Dot(i._vel,e.info.n)<=0&&_.Dot(t._vel,e.info.n)>=0)){let r=i._vel.Clone().Sub(t._vel),a=Math.max(i._bounce,t._bounce),d=-(1+a)*_.Dot(r,e.info.n)/(i.inverseMass+t.inverseMass),c=e.info.n.Clone().Mult(d);i._vel.Add(c.Clone().Mult(i.inverseMass)),t._vel.Sub(c.Clone().Mult(t.inverseMass))}let n=x.fromAngle(e.info.n.Angle());return i._collisions[n].add(t),t._collisions[x.opposite(n)].add(i),!0}return!1},D=(i,t)=>{let e=[];e[0]=new _(i._pos.x-i._width/2,i._pos.y-i._height/2),e[1]=new _(i._pos.x+i._width/2,i._pos.y-i._height/2),e[2]=new _(i._pos.x+i._width/2,i._pos.y+i._height/2),e[3]=new _(i._pos.x-i._width/2,i._pos.y+i._height/2);let s=[];s[0]=e[1].Clone().Sub(e[0]).Unit(),s[1]=e[2].Clone().Sub(e[1]).Unit(),s[2]=e[3].Clone().Sub(e[2]).Unit(),s[3]=e[0].Clone().Sub(e[3]).Unit();let n=[];for(let m=0;m<s.length;m++){let H=i._Project(s[m],e),C=H.min,P=H.max,R=t._Project(s[m]),S=R.min,A=R.max;if(S<P&&A>C)n.push({d:Math.abs(S-P),normal:s[m]});else return{collided:!1,info:null};if(C<A&&P>S)n.push({d:Math.abs(C-A),normal:s[m]});else return{collided:!1,info:null}}let d=t._FindNearestVertex(e).v.Clone().Sub(t._pos).Clone().Unit(),c=i._Project(d,e),l=c.min,u=c.max,p=t._Project(d),o=p.min,h=p.max;if(o<u&&h>l)n.push({d:Math.abs(o-u),normal:d});else return{collided:!1,info:null};if(l<h&&u>o)n.push({d:Math.abs(l-h),normal:d});else return{collided:!1,info:null};let f=1/0,M=null;for(let m=0;m<n.length;m++)n[m].d<f&&(f=n[m].d,M=n[m].normal);let Z=t._pos.Clone().Sub(i._pos);return _.Dot(Z,M)>0&&M.Mult(-1),{collided:!0,info:{d:f,n:M}}},J=(i,t)=>{if(i._mass==0&&t._mass==0)return!1;let e=D(i,t);if(e.collided){let s=e.info.n.Clone().Mult(e.info.d/(i.inverseMass+t.inverseMass));if(i._pos.Add(s.Clone().Mult(i.inverseMass)),i._oldPos.Copy(i._pos),t._pos.Sub(s.Clone().Mult(t.inverseMass)),t._oldPos.Copy(t._pos),!(_.Dot(i._vel,e.info.n)>=0&&_.Dot(t._vel,e.info.n)<=0)){let r=i._vel.Clone().Sub(t._vel),a=Math.max(i._bounce,t._bounce),d=-(1+a)*_.Dot(r,e.info.n)/(i.inverseMass+t.inverseMass),c=e.info.n.Clone().Mult(d);i._vel.Add(c.Clone().Mult(i.inverseMass)),t._vel.Sub(c.Clone().Mult(t.inverseMass))}let n=x.fromAngle(e.info.n.Angle());return t._collisions[n].add(i),i._collisions[x.opposite(n)].add(t),!0}return!1},at=(i,t)=>i.constructor.name=="Box"&&t.constructor.name=="Box"?ht(i,t):i.constructor.name=="Ball"&&t.constructor.name=="Ball"?rt(i,t):i.constructor.name=="Box"&&t.constructor.name=="Ball"?J(i,t):i.constructor.name=="Ball"&&t.constructor.name=="Box"?J(t,i):!1,_t=(i,t)=>i.constructor.name=="Box"&&t.constructor.name=="Box"?ot(i,t).collided:i.constructor.name=="Ball"&&t.constructor.name=="Ball"?K(i,t).collided:i.constructor.name=="Box"&&t.constructor.name=="Ball"?D(i,t).collided:i.constructor.name=="Ball"&&t.constructor.name=="Box"?D(t,i).collided:!1,w=class{constructor(){this._toLoad=[],this._size=0,this._counter=0,this._path=""}_Add(t,e,s){this._toLoad.push({name:t,path:this._path+"/"+e,type:s}),++this._size}AddImage(t,e){return this._Add(t,e,"image"),this}AddAudio(t,e){return this._Add(t,e,"audio"),this}AddJSON(t,e){return this._Add(t,e,"json"),this}AddFont(t,e){return this._Add(t,e,"font"),this}_HandleCallback(t,e,s,n){t.set(e.name,s),++this._counter,this._HandleOnProgress(e),this._counter===this._size&&(this._counter=this._size=0,this._toLoad=[],n(t))}_OnProgressHandler(t,e){}OnProgress(t){return this._OnProgressHandler=t,this}SetPath(t){return this._path=t,this}_HandleOnProgress(t){let e=this._counter/this._size;this._OnProgressHandler(e,t)}Load(t){let e=new Map;if(this._size===0){t(e);return}for(let s of this._toLoad)switch(s.type){case"image":w.LoadImage(s.path,n=>{this._HandleCallback(e,s,n,t)});break;case"audio":w.LoadAudio(s.path,n=>{this._HandleCallback(e,s,n,t)});break;case"json":w.LoadJSON(s.path,n=>{this._HandleCallback(e,s,n,t)});break;case"font":w.LoadFont(s.name,s.path,n=>{this._HandleCallback(e,s,n,t)})}}static LoadImage(t,e){let s=new Image;s.src=t,s.addEventListener("load",()=>{e(s)},{once:!0})}static LoadAudio(t,e){let s=new Audio(t);s.load(),s.addEventListener("canplaythrough",()=>{e(s)},{once:!0})}static LoadJSON(t,e){fetch(t).then(s=>s.json()).then(s=>e(s))}static LoadFont(t,e,s){new FontFace(t,`url(${e})`).load().then(r=>{document.fonts.add(r),s(t)})}},lt={Drawable:v,Text:N,Picture:W,Rect:T,Circle:V,Sprite:Y,TrailEffect:$},Q={Box:X,Ball:q,DetectCollision:_t,ResolveCollision:at};export{y as Component,et as Engine,b as Entity,w as Loader,st as Renderer,nt as Scene,it as SceneManager,_ as Vector,B as css,lt as drawable,k as hide,I as id,g as math,Q as physics,tt as show,x as side};
