var U=Object.defineProperty;var L=n=>U(n,"__esModule",{value:!0});var W=(n,t)=>{L(n);for(var e in t)U(n,e,{get:t[e],enumerable:!0})};var m=class{constructor(){this._timeouts=[]}Set(t,e){this._timeouts.push({action:t,dur:e,counter:0})}Update(t){for(let e=0;e<this._timeouts.length;++e){let i=this._timeouts[e];(i.counter+=t)>=i.dur&&(i.action(),this._timeouts.splice(e--,1))}}};var x=class{constructor(t){this._step=t,this.paused=!0,this.timeout=new m}_RAF(){this._paused||(this._frame=window.requestAnimationFrame(t=>{this._RAF();let e=Math.min(t-this._previousRAF,1e3/30);this.timeout.Update(e),this._step(e),this._previousRAF=t}))}Start(){this.paused=!1,this._previousRAF=performance.now(),this._RAF()}Stop(){this.paused=!0,window.cancelAnimationFrame(this._frame)}};var C=class{constructor(t){this._width=t.width,this._height=t.height,this._aspect=this._width/this._height,this._scale=1,this.background="black",this._InitContainer(),this._InitCanvas(),this._OnResize(),window.addEventListener("resize",()=>this._OnResize())}get dimension(){return this._canvas.getBoundingClientRect()}_InitContainer(){let t=document.body;t.style.userSelect="none",t.style.touchAction="none",t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.overflow="hidden",t.style.margin="0",t.style.padding="0";let e=this._container=document.createElement("div");e.style.width=this._width+"px",e.style.height=this._height+"px",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transformOrigin="center",t.appendChild(e)}_InitCanvas(){let t=this._canvas=document.createElement("canvas");t.width=this._width,t.height=this._height,this._context=t.getContext("2d"),t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.display="block",this._container.appendChild(t)}_OnResize(){let[t,e]=[document.body.clientWidth,document.body.clientHeight];t/e>this._aspect?this._scale=e/this._height:this._scale=t/this._width,this._container.style.transform="translate(-50%, -50%) scale("+this._scale+")",this._context.imageSmoothingEnabled=!1}Render(t){let e=this._context;if(e.beginPath(),e.fillStyle=this.background,e.fillRect(0,0,this._width,this._height),!t)return;let i=t.camera;e.save(),e.translate(-i.position.x*i.scale+this._width/2,-i.position.y*i.scale+this._height/2),e.scale(i.scale,i.scale);for(let s of t._drawable){let o=s.position.Clone();o.Sub(i.position),o.Mult(i.scale);let[r,a]=[s.boundingBox.width,s.boundingBox.height].map(_=>_*i.scale);o.x+r/2<-this._width/2||o.x-r/2>this._width/2||o.y+a/2<-this._height/2||o.y-a/2>this._height/2||s.Draw(e)}e.restore()}DisplayToSceneCoords(t,e,i){let s=this.dimension,o=(e-s.left)/this._scale,r=(i-s.top)/this._scale,a=t.camera;return{x:(o-this._width/2)/a.scale+a.position.x,y:(r-this._height/2)/a.scale+a.position.y}}};var M=class{constructor(){this._currentScene=null,this._scenes=new Map}get currentScene(){return this._currentScene}set currentScene(t){this._currentScene=this._scenes.get(t)||null}Add(t,e){this._scenes.set(e,t)}Play(t){return this.currentScene=t,this._currentScene&&this._currentScene.Play(),this._currentScene}};var l=function(){return{rand(n,t){return Math.random()*(t-n)+n},randint(n,t){return Math.floor(Math.random()*(t-n+1)+n)},lerp(n,t,e){return t+(e-t)*n},clamp(n,t,e){return Math.min(Math.max(n,t),e)},in_range(n,t,e){return n>=t&&n<=e},sat(n){return Math.min(Math.max(n,0),1)},ease_out(n){return Math.min(Math.max(Math.pow(n,1/2),0),1)},ease_in(n){return Math.min(Math.max(Math.pow(n,3),0),1)}}}();var S=class{constructor(t,e){let[i,s]=e;this._cells=[...Array(s)].map(o=>[...Array(i)].map(r=>null)),this._dimensions=e,this._bounds=t}NewClient(t,e){let i={position:t,dimensions:e,indices:null};return this._InsertClient(i),i}_InsertClient(t){let[e,i]=t.dimensions,[s,o]=t.position,r=this._GetCellIndex([s-e/2,o-i/2]),a=this._GetCellIndex([s+e/2,o+i/2]);t.indices=[r,a];for(let _=r[1];_<=a[1];++_)for(let d=r[0];d<=a[0];++d)this._cells[_][d]||(this._cells[_][d]=new Set),this._cells[_][d].add(t)}_GetCellIndex(t){let e=l.sat((t[0]-this._bounds[0][0])/(this._bounds[1][0]-this._bounds[0][0])),i=l.sat((t[1]-this._bounds[0][1])/(this._bounds[1][1]-this._bounds[0][1])),s=Math.floor(e*(this._dimensions[0]-1)),o=Math.floor(i*(this._dimensions[1]-1));return[s,o]}FindNear(t,e){let[i,s]=e,[o,r]=t,a=this._GetCellIndex([o-i/2,r-s/2]),_=this._GetCellIndex([o+i/2,r+s/2]),d=new Set;for(let y=a[1];y<=_[1];++y)for(let w=a[0];w<=_[0];++w)if(this._cells[y][w])for(let G of this._cells[y][w])d.add(G);return Array.from(d)}UpdateClient(t){this.RemoveClient(t),this._InsertClient(t)}RemoveClient(t){let[e,i]=t.indices;for(let s=e[1];s<=i[1];++s)for(let o=e[0];o<=i[0];++o)this._cells[s][o].delete(t)}};var A=class{constructor(){this._entities=[],this._entitiesMap=new Map,this._ids=0}_GenerateName(){return++this._ids,"__entity__"+this._ids}Add(t,e){e===void 0&&(e=this._GenerateName()),this._entities.push(t),this._entitiesMap.set(e,t),t._parent=this,t._name=e}Get(t){return this._entitiesMap.get(t)}Remove(t){let e=this._entities.indexOf(t);e<0||this._entities.splice(e,1)}Filter(t){return this._entities.filter(t)}Update(t){for(let e of this._entities)e.Update(t)}};var h=class{constructor(t=0,e=0){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}set x(t){this._x=t}set y(t){this._y=t}Copy(t){this._x=t._x,this._y=t._y}Clone(){return new h(this._x,this._y)}Add(t){return this._x+=t._x,this._y+=t._y,this}Sub(t){return this._x-=t._x,this._y-=t._y,this}Mult(t){return this._x*=t,this._y*=t,this}Norm(){return[this._x,this._y]=[this._y,-this._x],this}Unit(){let t=this.Mag();return t===0?this:(this._x/=t,this._y/=t,this)}Mag(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}Lerp(t,e){return this.Add(t.Clone().Sub(this).Mult(e)),this}Angle(){return Math.atan2(this._y,this._x)}Rotate(t){let e=this._x*Math.cos(t)-this._y*Math.sin(t),i=this._x*Math.sin(t)+this._y*Math.cos(t);return this._x=e,this._y=i,this}static Dot(t,e){return t._x*e._x+t._y*e._y}static Dist(t,e){return Math.sqrt(Math.pow(t._x-e._x,2)+Math.pow(t._y-e._y,2))}static AngleBetween(t,e){let i=t.Mag(),s=e.Mag();return i===0||s===0?0:Math.acos(h.Dot(t,e)/(i*s))}},g=class extends h{constructor(t,e=0,i=0){super(e,i);this._parent=t}get x(){return this._x}set x(t){let e=new h(t,this._y);this._parent.position=e,this._x=t}get y(){return this._y}set y(t){let e=new h(this._x,t);this._parent.position=e,this._y=t}};var f=class{constructor(t){this._parent=t,this._pos=new g(t),this._attached=[],this._moving=null}Clip(t){this._attached.push(t)}Unclip(t){let e=this._attached.indexOf(t);e!=-1&&this._attached.splice(e,1)}get position(){return this._pos}set position(t){for(let e of this._attached){let i=e._pos.Clone().Sub(this._pos);e._parent.position=t.Clone().Add(i)}this._pos.Copy(t)}MoveTo(t,e,i="linear"){this._moving={counter:0,dur:e,from:this._pos.Clone(),to:t,timing:i}}StopMoving(){this._moving=null}Update(t){if(this._moving){let e=this._moving;e.counter+=t*1e3;let i=Math.min(e.counter/e.dur,1),s;switch(e.timing){case"linear":s=i;break;case"ease-in":s=l.ease_in(i);break;case"ease-out":s=l.ease_out(i);break}this._parent.position=e.from.Clone().Lerp(e.to,s),i==1&&(this._moving=null)}}};var H=class{constructor(){this._position=new f(this),this._pos=this._position._pos,this.scale=1,this._target=null,this._vel=new h,this._scaling=null,this._shaking=null,this._offset=new h}get position(){return this._pos}set position(t){this._position.position=t}get shaking(){return this._shaking}get scaling(){return this._scaling}get moving(){return this._position._moving}get velocity(){return this._vel}set velocity(t){this._vel.Copy(t)}Clip(t){this._position.Clip(t._position)}Unclip(t){this._position.Unclip(t._position)}MoveTo(t,e,i="linear"){this._position.MoveTo(t,e,i)}StopMoving(){this._position.StopMoving()}Follow(t){this._target=t}Unfollow(){this._target=null}ScaleTo(t,e,i="linear"){this._scaling={counter:0,dur:e,from:this.scale,to:t,timing:i}}StopScaling(){this._scaling=null}Shake(t,e,i,s){this._shaking={counter:0,count:i,angle:s,dur:e,range:t}}StopShaking(){this._shaking=null,this._offset=new h}Update(t){if(this.moving)this._position.Update(t);else if(this._target)if(h.Dist(this._pos,this._target._pos)<1)this.position=this._target._pos.Clone();else{let e=4*t;this.position=this._pos.Clone().Lerp(this._target._pos,e)}else{let e=this._vel.Clone();e.Mult(t),this.position=this._pos.Clone().Add(e)}if(this._scaling){let e=this._scaling;e.counter+=t*1e3;let i=Math.min(e.counter/e.dur,1),s;switch(e.timing){case"linear":s=i;break;case"ease-in":s=l.ease_in(i);break;case"ease-out":s=l.ease_out(i);break}this.scale=l.lerp(s,e.from,e.to),i==1&&this.StopScaling()}if(this._shaking){let e=this._shaking;e.counter+=t*1e3;let i=Math.min(e.counter/e.dur,1);this.position=this._pos.Clone().Sub(this._offset),this._offset.Copy(new h(Math.sin(i*Math.PI*2*e.count)*e.range,0).Rotate(e.angle)),this.position=this._pos.Clone().Add(this._offset),i==1&&this.StopShaking()}}};var u=class{constructor(){this._type="",this._parent=null,this._pos=new g(this),this.offset=new h}get type(){return this._type}get scene(){return this._parent._scene}get parent(){return this._parent}get position(){return this._pos}set position(t){this._pos.Copy(t),this._parent.SetPosition(t.Clone().Sub(this.offset))}InitComponent(){}GetComponent(t){return this._parent.GetComponent(t)}FindEntity(t){return this._parent.FindEntity(t)}Update(t){}};var E=class extends u{constructor(t){super();this._capture=t.capture,this._eventHandlers=new Map}AddEventHandler(t,e){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(e)}RemoveEventHandler(t,e){if(!this._eventHandlers.has(t))return;let i=this._eventHandlers.get(t),s=i.indexOf(e);s>-1&&i.splice(s,1)}_On(t,e){if(!this._eventHandlers.has(t))return;let i=this._eventHandlers.get(t);for(let s of i)s(e)}};var k=class{constructor(t){this._resources=t.resources,this._input=t.input,this._bounds=t.bounds,this._cellDimensions=t.cellDimensions||[100,100],this._relaxationCount=t.relaxationCount||5,this.paused=!0,this.speed=1,this.timeout=new m,this._bodies=[],this._drawable=[],this._interactiveEntities=[],this._eventHandlers=new Map,this._entityManager=new A,this._spatialGrid=new S(this._bounds,[Math.floor((this._bounds[1][0]-this._bounds[0][0])/this._cellDimensions[0]),Math.floor((this._bounds[1][1]-this._bounds[0][1])/this._cellDimensions[1])]),this._camera=new H}get camera(){return this._camera}AddEventHandler(t,e){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(e)}RemoveEventHandler(t,e){if(!this._eventHandlers.has(t))return;let i=this._eventHandlers.get(t),s=i.indexOf(e);s>-1&&i.splice(s,1)}SetInteractive(t,e){this._interactiveEntities.push(t);let i=new E(e);t.AddComponent(i),t.interactive=i}_On(t,e){if(this._eventHandlers.has(t)){let i=this._eventHandlers.get(t);for(let s of i)s(e)}if(t=="mousedown"){let i=this._spatialGrid.FindNear([e.x,e.y],[0,0]).map(s=>s.entity);for(let s of i)if(!!s.interactive&&s.body.Contains(new Vector(e.x,e.y))&&(s.interactive._On(t,e),s.interactive._id=e.id,s.interactive._capture))break}else if(t=="mousemove"||t=="mouseup")for(let i of this._interactiveEntities)i.interactive._id==e.id&&(i.interactive._On(t,e),t=="mouseup"&&(i.interactive._id=-1))}GetEntityByName(t){return this._entityManager.Get(t)}GetEntitiesByGroup(t){return this._entityManager.Filter(e=>e.groupList.has(t))}AddEntity(t,e){t._scene=this,this._entityManager.Add(t,e),t._components.forEach(i=>{i._type=="drawable"?this._AddDrawable(i):i._type=="body"&&this._AddBody(t,i)})}RemoveEntity(t){this._entityManager.Remove(t),t._components.forEach(e=>{e._type=="drawable"?this._RemoveDrawable(e):e._type=="body"&&this._RemoveBody(t,b)})}_AddDrawable(t){this._drawable.push(t);for(let e=this._drawable.length-1;e>0&&!(t._zIndex>=this._drawable[e-1]._zIndex);--e)[this._drawable[e],this._drawable[e-1]]=[this._drawable[e-1],this._drawable[e]]}_RemoveDrawable(t){let e=this._drawable.indexOf(t);e!=-1&&this._drawable.splice(e,1)}_AddBody(t,e){t.body=e;let i=new SpatialGridController({grid:this._spatialGrid,width:e.width,height:e.height});t.AddComponent(i),this._bodies.push(e)}_RemoveBody(t,e){let i=t.GetComponent("SpatialGridController");i&&this._spatialGrid.RemoveClient(i._client);let s=this._bodies.indexOf(e);s!=-1&&this._bodies.splice(s,1)}_PhysicsUpdate(t){for(let e of this._bodies)e._collisions.left.clear(),e._collisions.right.clear(),e._collisions.top.clear(),e._collisions.bottom.clear();for(let e of this._bodies)e.UpdatePosition(t);for(let e=0;e<this._relaxationCount;++e)for(let i of this._bodies)i.HandleBehavior()}Update(t){this.paused||(this.timeout.Update(t*1e3),t*=this.speed,this._entityManager.Update(t),this._PhysicsUpdate(t),this._camera.Update(t))}Play(){this.paused=!1}Pause(){this.paused=!0}};var P=class{constructor(t){this._width=t.width,this._height=t.height,this._renderer=new C({width:this._width,height:this._height}),this._engine=new x,this._sceneManager=new M,this.timeout=this._engine.timeout;let e=i=>{let s=this._sceneManager.currentScene;s&&s.Update(i*.001),this._renderer.Render(s)};this._engine._step=e,this._InitSceneEvents(),this._engine.Start()}get background(){return this._renderer.background}set background(t){this._renderer.background=t}_InitSceneEvents(){let t="ontouchstart"in document,e=this._renderer._canvas;t?(e.addEventListener("touchstart",i=>this._HandleTouchEvent(i)),e.addEventListener("touchmove",i=>this._HandleTouchEvent(i)),e.addEventListener("touchend",i=>this._HandleTouchEvent(i))):(e.addEventListener("mousedown",i=>this._HandleMouseEvent(i)),e.addEventListener("mousemove",i=>this._HandleMouseEvent(i)),e.addEventListener("mouseup",i=>this._HandleMouseEvent(i)))}_HandleTouchEvent(t){let e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};this._HandleSceneEvent(e[t.type],t.changedTouches[0].pageX,t.changedTouches[0].pageY)}_HandleMouseEvent(t){this._HandleSceneEvent(t.type,t.pageX,t.pageY)}_HandleSceneEvent(t,e,i){let s=this._sceneManager.currentScene;if(s){let o=this._renderer.DisplayToSceneCoords(s,e,i);s._On(t,{x:o.x,y:o.y,id:0,type:t})}}CreateSection(t){}ShowSection(t){}HideSection(t){}CreateScene(t,e={}){let i=new k({bounds:e.bounds||[[-1e3,-1e3],[1e3,1e3]],cellDimensions:e.cellDimensions});return this._sceneManager.Add(i,t),i}PlayScene(t){return this._sceneManager.Play(t)}PauseScene(){let t=this._sceneManager.currentScene;t&&(t.paused?t.Play():t.Pause())}};var c=class{constructor(){this._toLoad=[],this._size=0,this._counter=0,this._path=""}_Add(t,e,i){this._toLoad.push({name:t,path:this._path+"/"+e,type:i}),++this._size}AddImage(t,e){return this._Add(t,e,"image"),this}AddAudio(t,e){return this._Add(t,e,"audio"),this}AddJSON(t,e){return this._Add(t,e,"json"),this}AddFont(t,e){return this._Add(t,e,"font"),this}_HandleCallback(t,e,i,s){t.set(e.name,i),++this._counter,this._HandleOnProgress(e),this._counter===this._size&&(this._counter=this._size=0,this._toLoad=[],s(t))}_OnProgressHandler(t,e){}OnProgress(t){return this._OnProgressHandler=t,this}SetPath(t){return this._path=t,this}_HandleOnProgress(t){let e=this._counter/this._size;this._OnProgressHandler(e,t)}Load(t){let e=new Map;if(this._size===0){t(e);return}for(let i of this._toLoad)switch(i.type){case"image":c.LoadImage(i.path,s=>{this._HandleCallback(e,i,s,t)});break;case"audio":c.LoadAudio(i.path,s=>{this._HandleCallback(e,i,s,t)});break;case"json":c.LoadJSON(i.path,s=>{this._HandleCallback(e,i,s,t)});break;case"font":c.LoadFont(i.name,i.path,s=>{this._HandleCallback(e,i,s,t)})}}static LoadImage(t,e){let i=new Image;i.src=t,i.addEventListener("load",()=>{e(i)},{once:!0})}static LoadAudio(t,e){let i=new Audio(t);i.load(),i.addEventListener("canplaythrough",()=>{e(i)},{once:!0})}static LoadJSON(t,e){fetch(t).then(i=>i.json()).then(i=>e(i))}static LoadFont(t,e,i){new FontFace(t,`url(${e})`).load().then(o=>{document.fonts.add(o),i(t)})}};var I=class{constructor(){this._position=new f(this),this._pos=this._position._pos,this._components=new Map,this._parent=null,this._name=null,this._scene=null,this.groupList=new Set}get name(){return this._name}get scene(){return this._scene}get parent(){return this._parent}get position(){return this._pos}set position(t){this._position.position=t,this._components.forEach(e=>{e._pos.Copy(this._pos.Clone().Add(e.offset))})}get moving(){return this._position._moving}Update(t){this._position.Update(t),this._components.forEach(e=>{e.Update(t)})}Clip(t){this._position.Clip(t._position)}Unclip(t){this._position.Unclip(t._position)}MoveTo(t,e,i="linear"){this._position.MoveTo(t,e,i)}StopMoving(){this._position.StopMoving()}AddComponent(t,e){e===void 0&&(e=t.constructor.name),this._components.set(e,t),t._parent=this,t._pos.Copy(this._pos.Clone().Add(t.offset)),t.InitComponent()}GetComponent(t){return this._components.get(t)}FindEntity(t){return this._parent.Get(t)}};var R={};W(R,{Circle:()=>F,Drawable:()=>p,Picture:()=>D,Rect:()=>z,Sprite:()=>B,Text:()=>j});var p=class extends u{constructor(t){super();this._type="drawable",this._params=t,this._width=this._params.width||0,this._height=this._params.height||0,this._zIndex=this._params.zIndex||0,this.flip={x:this._params.flipX||!1,y:this._params.flipY||!1},this._rotationCount=this._params.rotationCount||0,this.opacity=this._params.opacity!==void 0?this._params.opacity:1,this._angle=this._params.angle||this._rotationCount*Math.PI/2||0,this.boundingBox={width:0,height:0,x:0,y:0}}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.scene&&(this.scene._RemoveDrawable(this),this.scene._AddDrawable(this))}get width(){return this._width}get height(){return this._height}set width(t){this._width=t,this._UpdateBoundingBox()}set height(t){this._height=t,this._UpdateBoundingBox()}set angle(t){this._angle=t,this._UpdateBoundingBox()}get angle(){return this._angle}get rotationCount(){return this._rotationCount}set rotationCount(t){this._rotationCount=t,this.angle=this._rotationCount*Math.PI/2}InitComponent(){this._UpdateBoundingBox()}_UpdateBoundingBox(){let t=new Array(4);t[0]=new h(-this._width/2,-this._height/2).Rotate(this._angle),t[1]=new h(this._width/2,-this._height/2).Rotate(this._angle),t[2]=new h(this._width/2,this._height/2).Rotate(this._angle),t[3]=new h(-this._width/2,this._height/2).Rotate(this._angle);let e=0,i=0;for(let s=0;s<2;++s){let o=Math.abs(t[s].x)+Math.abs(t[s+2].x),r=Math.abs(t[s].y)+Math.abs(t[s+2].y);o>e&&(e=o),r>i&&(i=r)}this.boundingBox.width=e,this.boundingBox.height=i}SetSize(t,e){this._width=t,this._height=e}Draw(t){}},j=class extends p{constructor(t){super(t);this._text=this._params.text,this._lines=this._text.split(/\n/),this._padding=this._params.padding||0,this._fontSize=this._params.fontSize||16,this._fontFamily=this._params.fontFamily||"Arial",this._color=this._params.color||"black",this._ComputeDimensions()}get linesCount(){return this._lines.length}get lineHeight(){return this._fontSize+this._padding*2}get text(){return this._text}set text(t){this._text=t,this._ComputeDimensions()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this._ComputeDimensions()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this._ComputeDimensions()}get padding(){return this._padding}set padding(t){this._padding=t,this._ComputeDimensions()}_ComputeDimensions(){this._height=this.lineHeight*this.linesCount;let t=0,e=document.createElement("canvas").getContext("2d");e.font=`${this._fontSize}px '${this._fontFamily}'`;for(let i of this._lines){let s=e.measureText(i).width;s>t&&(t=s)}this._width=t}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this.opacity,t.translate(this._pos.x,this._pos.y),t.rotate(this.angle),t.fillStyle=this._color,t.font=`${this._fontSize}px '${this._fontFamily}'`,t.textAlign="center",t.textBaseline="middle";for(let e=0;e<this.linesCount;++e)t.fillText(this._lines[e],0,this.lineHeight*e-(this.linesCount-1)/2*this.lineHeight);t.restore()}},D=class extends p{constructor(t){super(t);this._image=this._params.image,this._frameWidth=this._params.frameWidth||this._image.width,this._frameHeight=this._params.frameHeight||this._image.height,this._framePos={x:this._params.posX||0,y:this._params.posY||0}}Draw(t){t.save(),t.globalAlpha=this.opacity,t.translate(this._pos.x,this._pos.y),t.scale(this.flip.x?-1:1,this.flip.y?-1:1),t.rotate(this.angle),t.drawImage(this._image,this._framePos.x*this._frameWidth,this._framePos.y*this._frameHeight,this._frameWidth,this._frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}},z=class extends p{constructor(t){super(t);this.background=this._params.background||"black",this.borderColor=this._params.borderColor||"black",this.borderWidth=this._params.borderWidth||0}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this.opacity,t.translate(this._pos.x,this._pos.y),t.rotate(this.angle),t.fillStyle=this.background,t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill(),this.borderWidth>0&&t.stroke(),t.restore()}},F=class extends p{constructor(t){super(t);this._radius=this._params.radius,this._width=this._radius*2,this._height=this._radius*2,this.background=this._params.background||"black",this.borderColor=this._params.borderColor||"black",this.borderWidth=this._params.borderWidth||0}get radius(){return this._radius}set radius(t){this._radius=t,this._width=this._radius*2,this._height=this._radius*2,this._UpdateBoundingBox()}Draw(t){t.beginPath(),t.save(),t.globalAlpha=this.opacity,t.translate(this._pos.x,this._pos.y),t.fillStyle=this.background,t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.arc(0,0,this._radius,0,2*Math.PI),t.fill(),this.borderWidth>0&&t.stroke(),t.restore()}},B=class extends p{constructor(t){super(t);this._anims=new Map,this._currentAnim=null,this._paused=!0,this._framePos={x:0,y:0}}AddAnim(t,e){this._anims.set(t,e)}PlayAnim(t,e,i,s){if(this.currentAnim==t)return;this._paused=!1;let o={name:t,rate:e,repeat:i,OnEnd:s,frame:0,counter:0};this._currentAnim=o,this._framePos=this._anims[o.name][o.frame]}Reset(){this._currentAnim&&(this._currentAnim.frame=0,this._currentAnim.counter=0)}Pause(){this._paused=!0}Resume(){this._currentAnim&&(this._paused=!1)}Update(t){if(this._paused)return;let e=this._currentAnim,i=this._anims.get(e.name);e.counter+=t*1e3,e.counter>=e.rate&&(e.counter=0,++e.frame,e.frame>=i.length&&(e.frame=0,e.OnEnd&&e.OnEnd(),e.repeat||(this._currentAnim=null,this._paused=!0)),this._framePos=i[e.frame])}get currentAnim(){return this._currentAnim?this._currentAnim.name:null}Draw(t){t.save(),t.globalAlpha=this.opacity,t.translate(this._pos.x,this._pos.y),t.scale(this.flip.x?-1:1,this.flip.y?-1:1),t.rotate(this.angle),t.drawImage(this._params.image,this._framePos.x*this._params.frameWidth,this._framePos.y*this._params.frameHeight,this._params.frameWidth,this._params.frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}};var O="Lancelot",v={Vector:h,Game:P,Loader:c,Entity:I,Component:u,drawable:R};if(typeof module=="object"&&typeof module.exports=="object")module.exports=v;else if(typeof define=="function"&&define.amd)define(O,[],v);else{let n=typeof globalThis!="undefined"?globalThis:self;n[O]=v}var Ut=v;export{Ut as default};
