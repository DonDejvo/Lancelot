var G=Object.defineProperty;var W=n=>G(n,"__esModule",{value:!0});var $=(n,t)=>{W(n);for(var i in t)G(n,i,{get:t[i],enumerable:!0})};var _=function(){return{rand(n,t){return Math.random()*(t-n)+n},randint(n,t){return Math.floor(Math.random()*(t-n+1)+n)},lerp(n,t,i){return t+(i-t)*n},clamp(n,t,i){return Math.min(Math.max(n,t),i)},in_range(n,t,i){return n>=t&&n<=i},sat(n){return Math.min(Math.max(n,0),1)},ease_out(n){return Math.min(Math.max(Math.pow(n,1/2),0),1)},ease_in(n){return Math.min(Math.max(Math.pow(n,3),0),1)},choice(n){let t=n.length;return n[Math.floor(Math.random()*t)]}}}();var C=class{constructor(){this._volume=1,this._playing=!1,this._audioMap=new Map,this._current=null}get volume(){return this._volume}set volume(t){t=_.sat(t),this._volume=t,this._audioMap.forEach(i=>{i.volume=this._volume})}get playing(){return this._current?!this._current.paused:!1}AddAudio(t,i,e=!1){i.loop=e,i.volume=this._volume,this._audioMap.set(t,i)}Play(t,i=!1){this._current&&this._current.pause();let e=this._audioMap.get(t);e&&(this._current=e,i&&(this._current.currentTime=0),this._current.play())}PlayClone(t){let i=this._audioMap.get(t);if(i){let e=i.cloneNode(!0);e.volume=this._volume,e.play()}}Pause(){this._current&&this._current.pause()}};var y=class{constructor(){this._timeouts=[]}Set(t,i){this._timeouts.push({action:t,dur:i,counter:0})}Update(t){for(let i=0;i<this._timeouts.length;++i){let e=this._timeouts[i];(e.counter+=t)>=e.dur&&(e.action(),this._timeouts.splice(i--,1))}}};var x=class{constructor(t){this._step=t,this.paused=!0,this.timeout=new y}_RAF(){this._paused||(this._frame=window.requestAnimationFrame(t=>{this._RAF();let i=Math.min(t-this._previousRAF,1e3/30);this.timeout.Update(i),this._step(i),this._previousRAF=t}))}Start(){this.paused=!1,this._previousRAF=performance.now(),this._RAF()}Stop(){this.paused=!0,window.cancelAnimationFrame(this._frame)}};var r=class{constructor(t=0,i=0){this._x=t,this._y=i}get x(){return this._x}get y(){return this._y}set x(t){this.Set(t,this.y)}set y(t){this.Set(this.x,t)}Set(t,i){this._x=t,this._y=i}Copy(t){return this.Set(t.x,t.y),this}Clone(){return new r(this.x,this.y)}Add(t){return this.Set(this.x+t.x,this.y+t.y),this}Sub(t){return this.Set(this.x-t.x,this.y-t.y),this}Mult(t){return this.Set(this.x*t,this.y*t),this}Norm(){return this.Set(this.y,-this.x),this}Unit(){let t=this.Mag();return t===0?this:(this.Set(this.x/t,this.y/t),this)}Mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}Lerp(t,i){return this.Add(t.Clone().Sub(this).Mult(i))}Angle(){return Math.atan2(this.y,this_x)}Rotate(t){let i=Math.sin(t),e=Math.cos(t),s=this.x*e-this.y*i,o=this.x*i+this.y*e;return this.Set(s,o),this}static Dot(t,i){return t.x*i.x+t.y*i.y}static Dist(t,i){return t.Clone().Sub(i).Mag()}static AngleBetween(t,i){let e=t.Mag(),s=i.Mag();return e===0||s===0?0:Math.acos(r.Dot(t,i)/(e*s))}},w=class extends r{constructor(t,i=0,e=0){super(i,e);this._positionFunction=t}Set(t,i){(t!=this.x||i!=this.y)&&(this._x=t,this._y=i,this._positionFunction())}};var M=class{constructor(t){this._width=t.width,this._height=t.height,this._aspect=this._width/this._height,this._scale=1,this._background=t.background||"black",this._InitContainer(),this._InitCanvas(),this._OnResize(),window.addEventListener("resize",()=>this._OnResize())}get dimension(){return this._canvas.getBoundingClientRect()}get background(){return this._background}set background(t){this._background=t,this._canvas.style.background=t}_InitContainer(){let t=document.body;t.style.userSelect="none",t.style.touchAction="none",t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.overflow="hidden",t.style.margin="0",t.style.padding="0";let i=this._container=document.createElement("div");i.style.width=this._width+"px",i.style.height=this._height+"px",i.style.position="absolute",i.style.left="50%",i.style.top="50%",i.style.transformOrigin="center",t.appendChild(i)}_InitCanvas(){let t=this._canvas=document.createElement("canvas");t.width=this._width,t.height=this._height,this._context=t.getContext("2d"),t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.display="block",t.style.background=this._background,this._container.appendChild(t)}_OnResize(){let[t,i]=[document.body.clientWidth,document.body.clientHeight];t/i>this._aspect?this._scale=i/this._height:this._scale=t/this._width,this._container.style.transform="translate(-50%, -50%) scale("+this._scale+")",this._context.imageSmoothingEnabled=!1}Render(t){let i=this._context;if(i.beginPath(),i.fillStyle=this.background,i.fillRect(0,0,this._width,this._height),!t)return;let e=t.camera;i.save(),i.translate(-e.position.x*e.scale+this._width/2,-e.position.y*e.scale+this._height/2),i.scale(e.scale,e.scale);for(let s of t._drawable){let o=s.boundingBox,a=new r(o.x,o.y);a.Sub(e.position),a.Mult(e.scale);let[c,h]=[o.width,o.height].map(l=>l*e.scale);a.x+c/2<-this._width/2||a.x-c/2>this._width/2||a.y+h/2<-this._height/2||a.y-h/2>this._height/2||s.Draw(i)}i.restore()}DisplayToSceneCoords(t,i,e){let s=this.dimension,o=(i-s.left)/this._scale,a=(e-s.top)/this._scale,c=t.camera;return{x:(o-this._width/2)/c.scale+c.position.x,y:(a-this._height/2)/c.scale+c.position.y}}};var S=class{constructor(){this._currentScene=null,this._scenes=new Map}get currentScene(){return this._currentScene}set currentScene(t){this._currentScene=this._scenes.get(t)||null}Add(t,i){this._scenes.set(i,t)}Play(t){return this.currentScene=t,this._currentScene&&this._currentScene.Play(),this._currentScene}};var A=class{constructor(t,i){let[e,s]=i;this._cells=[...Array(s)].map(o=>[...Array(e)].map(a=>null)),this._dimensions=i,this._bounds=t}NewClient(t,i){let e={position:t,dimensions:i,indices:null};return this._InsertClient(e),e}_InsertClient(t){let[i,e]=t.dimensions,[s,o]=t.position,a=this._GetCellIndex([s-i/2,o-e/2]),c=this._GetCellIndex([s+i/2,o+e/2]);t.indices=[a,c];for(let h=a[1];h<=c[1];++h)for(let l=a[0];l<=c[0];++l)this._cells[h][l]||(this._cells[h][l]=new Set),this._cells[h][l].add(t)}_GetCellIndex(t){let i=_.sat((t[0]-this._bounds[0][0])/(this._bounds[1][0]-this._bounds[0][0])),e=_.sat((t[1]-this._bounds[0][1])/(this._bounds[1][1]-this._bounds[0][1])),s=Math.floor(i*(this._dimensions[0]-1)),o=Math.floor(e*(this._dimensions[1]-1));return[s,o]}FindNear(t,i){let[e,s]=i,[o,a]=t,c=this._GetCellIndex([o-e/2,a-s/2]),h=this._GetCellIndex([o+e/2,a+s/2]),l=new Set;for(let d=c[1];d<=h[1];++d)for(let g=c[0];g<=h[0];++g)if(this._cells[d][g])for(let Y of this._cells[d][g])l.add(Y);return Array.from(l)}UpdateClient(t){this.RemoveClient(t),this._InsertClient(t)}RemoveClient(t){let[i,e]=t.indices;for(let s=i[1];s<=e[1];++s)for(let o=i[0];o<=e[0];++o)this._cells[s][o].delete(t)}};var k=class{constructor(){this._entities=[],this._entitiesMap=new Map,this._ids=0}_GenerateName(){return++this._ids,"__entity__"+this._ids}Add(t,i){i===void 0&&(i=this._GenerateName()),this._entities.push(t),this._entitiesMap.set(i,t),t._parent=this,t._name=i}Get(t){return this._entitiesMap.get(t)}Remove(t){let i=this._entities.indexOf(t);i<0||this._entities.splice(i,1)}Filter(t){return this._entities.filter(t)}Update(t){for(let i of this._entities)i.Update(t)}};var m=class{constructor(){this._pos=new w(this.DoWeirdStuff.bind(this)),this._parent=null,this._fixed=!1,this._offset=new w(this.DoWeirdStuffWithOffset.bind(this)),this._attached=[],this._moving=null}Clip(t,i=!1){this._attached.push(t),t._parent=this,t._fixed=i,t._offset.Copy(t.position.Clone().Sub(this.position))}Unclip(t){let i=this._attached.indexOf(t);i!=-1&&(this._attached.splice(i,1),t._parent=null)}get position(){return this._pos}set position(t){this.position.Copy(t)}MoveTo(t,i,e="linear"){this._moving={counter:0,dur:i,from:this.position.Clone(),to:t,timing:e}}StopMoving(){this._moving=null}DoWeirdStuff(){this._parent&&(this._fixed?this._parent.position.Copy(this.position.Clone().Sub(this._offset)):this._offset.Copy(this.position.Clone().Sub(this._parent.position)));for(let t of this._attached)t.position.Copy(this.position.Clone().Add(t._offset))}DoWeirdStuffWithOffset(){this._parent&&this._fixed&&this.position.Copy(this._parent.position.Clone().Add(this._offset))}Update(t){if(this._moving){let i=this._moving;i.counter+=t*1e3;let e=Math.min(i.counter/i.dur,1),s;switch(i.timing){case"linear":s=e;break;case"ease-in":s=_.ease_in(e);break;case"ease-out":s=_.ease_out(e);break}this.position.Copy(i.from.Clone().Lerp(i.to,s)),e==1&&(this._moving=null)}}};var E=class{constructor(){this._position=new m,this.scale=1,this._target=null,this._vel=new r,this._scaling=null,this._shaking=null,this._offset=new r}get position(){return this._position.position}set position(t){this._position.position.Copy(t)}get shaking(){return this._shaking}get scaling(){return this._scaling}get moving(){return this._position._moving}get velocity(){return this._vel}set velocity(t){this._vel.Copy(t)}Clip(t){this._position.Clip(t._position)}Unclip(t){this._position.Unclip(t._position)}MoveTo(t,i,e="linear"){this._position.MoveTo(t,i,e)}StopMoving(){this._position.StopMoving()}Follow(t){this._target=t}Unfollow(){this._target=null}ScaleTo(t,i,e="linear"){this._scaling={counter:0,dur:i,from:this.scale,to:t,timing:e}}StopScaling(){this._scaling=null}Shake(t,i,e,s){this._shaking={counter:0,count:e,angle:s,dur:i,range:t}}StopShaking(){this._shaking=null,this._offset=new r}Update(t){if(this.moving)this._position.Update(t);else if(this._target){let i=4*t;this.position.Lerp(this._target.position,i)}else{let i=this._vel.Clone();i.Mult(t),this.position.Add(i)}if(this._scaling){let i=this._scaling;i.counter+=t*1e3;let e=Math.min(i.counter/i.dur,1),s;switch(i.timing){case"linear":s=e;break;case"ease-in":s=_.ease_in(e);break;case"ease-out":s=_.ease_out(e);break}this.scale=_.lerp(s,i.from,i.to),e==1&&this.StopScaling()}if(this._shaking){let i=this._shaking;i.counter+=t*1e3;let e=Math.min(i.counter/i.dur,1);this.position.Sub(this._offset),this._offset.Copy(new r(Math.sin(e*Math.PI*2*i.count)*i.range,0).Rotate(i.angle)),this.position.Add(this._offset),e==1&&this.StopShaking()}}};var u=class{constructor(){this._type="",this._parent=null,this._position=new m}get type(){return this._type}get scene(){return this._parent._scene}get parent(){return this._parent}get position(){return this._position.position}set position(t){this._position.position=t}get offset(){return this._position._offset}set offset(t){this._position._offset.Copy(t)}InitComponent(){}GetComponent(t){return this._parent.GetComponent(t)}FindEntity(t){return this._parent.FindEntity(t)}Update(t){}};var H=class extends u{constructor(t){super();this._capture=t.capture===void 0?!1:t.capture,this._eventHandlers=new Map}AddEventHandler(t,i){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(i)}RemoveEventHandler(t,i){if(!this._eventHandlers.has(t))return;let e=this._eventHandlers.get(t),s=e.indexOf(i);s>-1&&e.splice(s,1)}_On(t,i){if(!this._eventHandlers.has(t))return;let e=this._eventHandlers.get(t);for(let s of e)s(i)}};var I=class{constructor(){this._position=new m(this.DoWeirdStuff.bind(this)),this._components=new Map,this._parent=null,this._name=null,this._scene=null,this.groupList=new Set}get name(){return this._name}get scene(){return this._scene}get position(){return this._position.position}set position(t){this._position.position=t}get moving(){return this._position._moving}DoWeirdStuff(){this._components.forEach(t=>{t.position.Copy(this.position.Clone().Add(t.offset))})}Update(t){this._position.Update(t),this._components.forEach(i=>{i.Update(t)})}Clip(t,i=!1){this._position.Clip(t._position,i)}Unclip(t){this._position.Unclip(t._position)}MoveTo(t,i,e="linear"){this._position.MoveTo(t,i,e)}StopMoving(){this._position.StopMoving()}AddComponent(t,i){switch(i===void 0&&(i=t.constructor.name),this._components.set(i,t),t._parent=this,t.position.Copy(this.position.Clone().Add(t.offset)),this.Clip(t,!0),t.InitComponent(),t.type){case"drawable":this.scene._AddDrawable(t);break;case"body":this.scene._AddBody(this,t);break}}GetComponent(t){return this._components.get(t)}FindEntity(t){return this._parent.Get(t)}};var P=class{constructor(t){this._bounds=t.bounds||[[-1e3,-1e3],[1e3,1e3]],this._cellDimensions=t.cellDimensions||[100,100],this._relaxationCount=t.relaxationCount||5,this.paused=!0,this.speed=1,this.timeout=new y,this._bodies=[],this._drawable=[],this._interactiveEntities=[],this._eventHandlers=new Map,this._entityManager=new k,this._spatialGrid=new A(this._bounds,[Math.floor((this._bounds[1][0]-this._bounds[0][0])/this._cellDimensions[0]),Math.floor((this._bounds[1][1]-this._bounds[0][1])/this._cellDimensions[1])]),this._camera=new E}get camera(){return this._camera}CreateEntity(t){let i=new I;return this.AddEntity(i,t),i}AddEventHandler(t,i){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push(i)}RemoveEventHandler(t,i){if(!this._eventHandlers.has(t))return;let e=this._eventHandlers.get(t),s=e.indexOf(i);s>-1&&e.splice(s,1)}SetInteractive(t,i={}){this._interactiveEntities.push(t);let e=new H(i);t.AddComponent(e),t.interactive=e}_On(t,i){if(this._eventHandlers.has(t)){let e=this._eventHandlers.get(t);for(let s of e)s(i)}if(t=="mousedown"){let e=this._spatialGrid.FindNear([i.x,i.y],[0,0]).map(s=>s.entity);for(let s of e)if(!!s.interactive&&s.body.Contains(new Vector(i.x,i.y))&&(s.interactive._On(t,i),s.interactive._id=i.id,s.interactive._capture))break}else if(t=="mousemove"||t=="mouseup")for(let e of this._interactiveEntities)e.interactive._id==i.id&&(e.interactive._On(t,i),t=="mouseup"&&(e.interactive._id=-1))}GetEntityByName(t){return this._entityManager.Get(t)}GetEntitiesByGroup(t){return this._entityManager.Filter(i=>i.groupList.has(t))}AddEntity(t,i){t._scene=this,this._entityManager.Add(t,i)}RemoveEntity(t){this._entityManager.Remove(t),t._components.forEach(i=>{i._type=="drawable"?this._RemoveDrawable(i):i._type=="body"&&this._RemoveBody(t,b)})}_AddDrawable(t){this._drawable.push(t);for(let i=this._drawable.length-1;i>0&&!(t._zIndex>=this._drawable[i-1]._zIndex);--i)[this._drawable[i],this._drawable[i-1]]=[this._drawable[i-1],this._drawable[i]]}_RemoveDrawable(t){let i=this._drawable.indexOf(t);i!=-1&&this._drawable.splice(i,1)}_AddBody(t,i){t.body=i;let e=new SpatialGridController({grid:this._spatialGrid,width:i.width,height:i.height});t.AddComponent(e),this._bodies.push(i)}_RemoveBody(t,i){let e=t.GetComponent("SpatialGridController");e&&this._spatialGrid.RemoveClient(e._client);let s=this._bodies.indexOf(i);s!=-1&&this._bodies.splice(s,1)}_PhysicsUpdate(t){for(let i of this._bodies)i._collisions.left.clear(),i._collisions.right.clear(),i._collisions.top.clear(),i._collisions.bottom.clear();for(let i of this._bodies)i.UpdatePosition(t);for(let i=0;i<this._relaxationCount;++i)for(let e of this._bodies)e.HandleBehavior()}Update(t){this.paused||(this.timeout.Update(t*1e3),t*=this.speed,this._entityManager.Update(t),this._PhysicsUpdate(t),this._camera.Update(t))}Play(){this.paused=!1}Pause(){this.paused=!0}};var p=class{constructor(){this._toLoad=[],this._size=0,this._counter=0,this._path=""}_Add(t,i,e){this._toLoad.push({name:t,path:this._path+i,type:e}),++this._size}AddImage(t,i){return this._Add(t,i,"image"),this}AddAudio(t,i){return this._Add(t,i,"audio"),this}AddJSON(t,i){return this._Add(t,i,"json"),this}AddFont(t,i){return this._Add(t,i,"font"),this}_HandleCallback(t,i,e,s){t.set(i.name,e),++this._counter,this._HandleOnProgress(i),this._counter===this._size&&(this._counter=this._size=0,this._toLoad=[],s(t))}_OnProgressHandler(t,i){}OnProgress(t){return this._OnProgressHandler=t,this}SetPath(t){return this._path=t,this}_HandleOnProgress(t){let i=this._counter/this._size;this._OnProgressHandler(i,t)}Load(t){let i=new Map;if(this._size===0){t(i);return}for(let e of this._toLoad)switch(e.type){case"image":p.LoadImage(e.path,s=>{this._HandleCallback(i,e,s,t)});break;case"audio":p.LoadAudio(e.path,s=>{this._HandleCallback(i,e,s,t)});break;case"json":p.LoadJSON(e.path,s=>{this._HandleCallback(i,e,s,t)});break;case"font":p.LoadFont(e.name,e.path,s=>{this._HandleCallback(i,e,s,t)})}}static LoadImage(t,i){let e=new Image;e.src=t,e.addEventListener("load",()=>{i(e)},{once:!0})}static LoadAudio(t,i){let e=new Audio(t);e.load(),e.addEventListener("canplaythrough",()=>{i(e)},{once:!0})}static LoadJSON(t,i){fetch(t).then(e=>e.json()).then(e=>i(e))}static LoadFont(t,i,e){new FontFace(t,`url(${i})`).load().then(o=>{document.fonts.add(o),e(t)})}};var j=class{constructor(t){this._width=t.width,this._height=t.height,this._preload=t.preload==null?null:t.preload.bind(this),this._init=t.init.bind(this),this._resources=null,this._loader=new p,this._renderer=new M({width:this._width,height:this._height,background:t.background}),this._engine=new x,this._sceneManager=new S,this.timeout=this._engine.timeout,this.audio=(()=>{let e=new Map,s=h=>{e.set(h,new C)};s("music"),s("effects");let o=(h,l,d=!1)=>{e.get(h).AddAudio(l,this._resources.get(l),d)};return{get music(){return e.get("music")},get effects(){return e.get("effects")},AddMusic:(h,l=!1)=>{o("music",h,l)},AddEffect:(h,l=!1)=>{o("effects",h,l)}}})();let i=e=>{let s=this._sceneManager.currentScene;s&&s.Update(e*.001),this._renderer.Render(s)};this._engine._step=i,this._InitSceneEvents(),this._engine.Start(),this._preload?(this._preload(),this._loader.Load(e=>{this._resources=e,this._init()})):(this._resources=new Map,this._init())}get background(){return this._renderer.background}set background(t){this._renderer.background=t}get loader(){return this._loader}get resources(){return this._resources}_InitSceneEvents(){let t="ontouchstart"in document,i=this._renderer._canvas;t?(i.addEventListener("touchstart",e=>this._HandleTouchEvent(e)),i.addEventListener("touchmove",e=>this._HandleTouchEvent(e)),i.addEventListener("touchend",e=>this._HandleTouchEvent(e))):(i.addEventListener("mousedown",e=>this._HandleMouseEvent(e)),i.addEventListener("mousemove",e=>this._HandleMouseEvent(e)),i.addEventListener("mouseup",e=>this._HandleMouseEvent(e)))}_HandleTouchEvent(t){let i={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};this._HandleSceneEvent(i[t.type],t.changedTouches[0].pageX,t.changedTouches[0].pageY)}_HandleMouseEvent(t){this._HandleSceneEvent(t.type,t.pageX,t.pageY)}_HandleSceneEvent(t,i,e){let s=this._sceneManager.currentScene;if(s){let o=this._renderer.DisplayToSceneCoords(s,i,e);s._On(t,{x:o.x,y:o.y,id:0,type:t})}}CreateSection(t){let i=document.createElement("div");return i.id=t,i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.display="none",this._renderer._container.appendChild(i),i}GetSection(t){return document.getElementById(t)}ShowSection(t){this.GetSection(t).style.display="block"}HideSection(t){this.GetSection(t).style.display="none"}CreateScene(t,i={}){let e=new P(i);return this._sceneManager.Add(e,t),e}PlayScene(t){return this._sceneManager.Play(t)}PauseScene(){let t=this._sceneManager.currentScene;t&&(t.paused?t.Play():t.Pause())}};var R={};$(R,{Circle:()=>O,Drawable:()=>f,Picture:()=>F,Polygon:()=>L,Rect:()=>U,Sprite:()=>V,Text:()=>z});var f=class extends u{constructor(t){super();this._type="drawable",this._params=t,this._width=this._params.width||0,this._height=this._params.height||0,this._vertices=[],this._zIndex=this._params.zIndex||0,this.flip={x:this._params.flipX||!1,y:this._params.flipY||!1},this._scale=t.scale||1,this._rotationCount=this._params.rotationCount||0,this.opacity=this._params.opacity!==void 0?this._params.opacity:1,this.filter=this._params.filter||"",this._angle=this._params.angle||this._rotationCount*Math.PI/2||0}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.scene&&(this.scene._RemoveDrawable(this),this.scene._AddDrawable(this))}get width(){return this._width}get height(){return this._height}set width(t){this._width=t,this._ComputeVertices()}set height(t){this._height=t,this._ComputeVertices()}set angle(t){this._angle=t}get angle(){return this._angle}get rotationCount(){return this._rotationCount}set rotationCount(t){this._rotationCount=t,this.angle=this._rotationCount*Math.PI/2}get scale(){return this._scale}set scale(t){this._scale=t}get boundingBox(){let t=this._vertices,i=1/0,e=-1/0,s=1/0,o=-1/0;for(let d of t)d.x<i?i=d.x:d.x>e&&(e=d.x),d.y<s?s=d.y:d.y>o&&(o=d.y);let a=e-i,c=o-s,h=this.position.x+i+a/2,l=this.position.y+s+c/2;return{x:h,y:l,width:a,height:c}}InitComponent(){this._ComputeVertices()}GetVertices(){return[new r(-this._width/2,-this._height/2),new r(this._width/2,-this._height/2),new r(-this._width/2,this._height/2),new r(this._width/2,this._height/2)]}_ComputeVertices(){this._vertices=this.GetVertices();for(let t=0;t<this._vertices.length;++t){let i=this._vertices[t];i.x*=this.flip.x?-this.scale:this.scale,i.y*=this.flip.y?-this.scale:this.scale,i.Rotate(this.angle)}}SetSize(t,i){this._width=t,this._height=i}Draw(t){}},z=class extends f{constructor(t){super(t);this._text=this._params.text,this._lines=this._text.split(/\n/),this._padding=this._params.padding||0,this._align=t.align||"center",this._fontSize=this._params.fontSize||16,this._fontFamily=this._params.fontFamily||"Arial",this._color=this._params.color||"black",this._ComputeDimensions()}get linesCount(){return this._lines.length}get lineHeight(){return this._fontSize+this._padding*2}get text(){return this._text}set text(t){this._text=t,this._ComputeDimensions()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this._ComputeDimensions()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this._ComputeDimensions()}get padding(){return this._padding}set padding(t){this._padding=t,this._ComputeDimensions()}get align(){return this._align}set align(t){this._align=t,this._ComputeDimensions()}_ComputeDimensions(){this._height=this.lineHeight*this.linesCount;let t=0,i=document.createElement("canvas").getContext("2d");i.font=`${this._fontSize}px '${this._fontFamily}'`;for(let e of this._lines){let s=i.measureText(e).width;s>t&&(t=s)}this._width=t+this._padding*2}Draw(t){let i=this._align=="left"?-this._width/2:this._align=="right"?this._width/2:0;t.beginPath(),t.save(),t.globalAlpha=this.opacity,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.rotate(this.angle),t.fillStyle=this._color,t.font=`${this._fontSize}px '${this._fontFamily}'`,t.textAlign=this._align,t.textBaseline="middle";for(let e=0;e<this.linesCount;++e)t.fillText(this._lines[e],i+this._padding,this.lineHeight*e-(this.linesCount-1)/2*this.lineHeight);t.restore()}},F=class extends f{constructor(t){super(t);this._image=this._params.image,this._frameWidth=this._params.frameWidth||this._image.width,this._frameHeight=this._params.frameHeight||this._image.height,this._framePos={x:this._params.posX||0,y:this._params.posY||0}}Draw(t){t.save(),t.globalAlpha=this.opacity,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.rotate(this.angle),t.drawImage(this._image,this._framePos.x*this._frameWidth,this._framePos.y*this._frameHeight,this._frameWidth,this._frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}},U=class extends f{constructor(t){super(t);this.background=this._params.background||"black",this.borderColor=this._params.borderColor||"black",this.borderWidth=this._params.borderWidth||0}Draw(t){t.save(),t.globalAlpha=this.opacity,t.filter=this.filter,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.rotate(this.angle),t.fillStyle=this.background,t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill(),this.borderWidth>0&&t.stroke(),t.restore()}},O=class extends f{constructor(t){super(t);this._radius=this._params.radius,this._width=this._radius*2,this._height=this._radius*2,this.background=this._params.background||"black",this.borderColor=this._params.borderColor||"black",this.borderWidth=this._params.borderWidth||0}get radius(){return this._radius}set radius(t){this._radius=t,this._width=this._radius*2,this._height=this._radius*2,this._ComputeVertices()}Draw(t){t.save(),t.globalAlpha=this.opacity,t.filter=this.filter,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.fillStyle=this.background,t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.beginPath(),t.arc(0,0,this._radius,0,2*Math.PI),t.fill(),this.borderWidth>0&&t.stroke(),t.restore()}},L=class extends f{constructor(t){super(t);this.background=this._params.background||"black",this.borderColor=this._params.borderColor||"black",this.borderWidth=this._params.borderWidth||0}GetVertices(){return this._params.vertices.map(t=>new r(t[0],t[1]))}Draw(t){t.save(),t.globalAlpha=this.opacity,t.filter=this.filter,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.fillStyle=this.background,t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.beginPath();for(let i=0;i<this._vertices.length;++i){let e=this._vertices[i];i==0?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}t.closePath(),t.fill(),this.borderWidth>0&&t.stroke(),t.restore()}},V=class extends f{constructor(t){super(t);this._anims=new Map,this._currentAnim=null,this._paused=!0,this._framePos={x:0,y:0}}AddAnim(t,i){this._anims.set(t,i)}PlayAnim(t,i,e,s){if(this.currentAnim==t)return;this._paused=!1;let o={name:t,rate:i,repeat:e,OnEnd:s,frame:0,counter:0};this._currentAnim=o,this._framePos=this._anims[o.name][o.frame]}Reset(){this._currentAnim&&(this._currentAnim.frame=0,this._currentAnim.counter=0)}Pause(){this._paused=!0}Resume(){this._currentAnim&&(this._paused=!1)}Update(t){if(this._paused)return;let i=this._currentAnim,e=this._anims.get(i.name);i.counter+=t*1e3,i.counter>=i.rate&&(i.counter=0,++i.frame,i.frame>=e.length&&(i.frame=0,i.OnEnd&&i.OnEnd(),i.repeat||(this._currentAnim=null,this._paused=!0)),this._framePos=e[i.frame])}get currentAnim(){return this._currentAnim?this._currentAnim.name:null}Draw(t){t.save(),t.globalAlpha=this.opacity,t.translate(this.position.x,this.position.y),t.scale(this.flip.x?-this.scale:this.scale,this.flip.y?-this.scale:this.scale),t.rotate(this.angle),t.drawImage(this._params.image,this._framePos.x*this._params.frameWidth,this._framePos.y*this._params.frameHeight,this._params.frameWidth,this._params.frameHeight,-this._width/2,-this._height/2,this._width,this._height),t.restore()}};var D={};W(D);var T=class extends u{constructor(t){super();this._particles=[],this._options={lifetime:t.lifetime,friction:t.friction||0,angleVariance:t.angleVariance||0,angle:this._InitMinMax(t.angle),speed:this._InitMinMax(t.speed),acceleration:t.acceleration||new r,scale:this._InitRange(t.scale),opacity:this._InitRange(t.opacity)},this._emitting=null}_InitMinMax(t){return t==null?0:typeof t=="number"?{min:t,max:t}:{min:t.min,max:t.max}}_InitRange(t){return t==null?null:{from:t.from==null?1:t.from,to:t.to}}_CreateParticle(){let t=this.scene.CreateEntity();t.groupList.add("particle"),t.position.Copy(this.position);let i=_.choice(this._particles);t.AddComponent(new i[0](i[1]),"Sprite"),t.AddComponent(new B(this._options))}AddParticle(t,i){this._particles.push([t,i])}Emit(t,i=!1,e=0){if(i)this._emitting={count:t,counter:e,delay:e};else for(let s=0;s<t;++s)this._CreateParticle()}Update(t){if(this._emitting){let i=this._emitting;i.counter+=t*1e3,i.counter>=i.delay&&(i.counter=0,this.Emit(i.count))}}},B=class extends u{constructor(t){super();this._friction=t.friction||0,this._lifetime=t.lifetime,this._angleVariance=t.angleVariance||0,this._acc=t.acceleration||new r,this._counter=0,this._scale=this._InitRange(t.scale),this._opacity=this._InitRange(t.opacity),this._vel=new r(this._InitMinMax(t.speed),0).Rotate(this._InitMinMax(t.angle))}_InitMinMax(t){return _.rand(t.min,t.max)}_InitRange(t){return t?{from:t.from==null?1:t.from,to:t.to}:null}Update(t){if(this._counter+=t*1e3,this._counter>=this._lifetime){this.scene.RemoveEntity(this.parent);return}this._vel.Add(this._acc.Mult(t));let i=60,e=new r(this._vel.x*i*this._friction,this._vel.y*i*this._friction);this._vel.Sub(e.Mult(t)),this._vel.Rotate(_.rand(-this._angleVariance,this._angleVariance)),this.position.Add(this._vel.Clone().Mult(t));let s=this.GetComponent("Sprite"),o=Math.min(this._counter/this._lifetime,1);this._scale&&(s.scale=_.lerp(o,this._scale.from,this._scale.to)),this._opacity&&(s.opacity=_.lerp(o,this._opacity.from,this._opacity.to))}},N={Emitter:T};var X="Lancelot",v={Vector:r,Game:j,Component:u,particle:N,drawable:R,physics:D};if(typeof module=="object"&&typeof module.exports=="object")module.exports=v;else if(typeof define=="function"&&define.amd)define(X,[],v);else{let n=typeof globalThis!="undefined"?globalThis:self;n[X]=v}var Qt=v;export{Qt as default};
