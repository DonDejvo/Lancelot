var Wt=Object.defineProperty;var $t=o=>Wt(o,"__esModule",{value:!0});var N=(o,t)=>{$t(o);for(var e in t)Wt(o,e,{get:t[e],enumerable:!0})};var E=class{_toLoad=[];_size=0;_counter=0;_path="";_onProgressHandler=null;_add(t,e,i){let s;e.startsWith("/")?s=this._path+e.slice(1):s=this._path+e,this._toLoad.push({name:t,path:s,type:i}),++this._size}image(t,e){this._add(t,e,"image")}audio(t,e){this._add(t,e,"audio")}json(t,e){this._add(t,e,"json")}font(t,e){this._add(t,e,"font")}onProgress(t){this._onProgressHandler=t}setPath(t){this._path=t,this._path.endsWith("/")||(this._path+="/")}load(t){let e=new Map;if(this._size===0){t(e);return}for(let i of this._toLoad)switch(i.type){case"image":E.loadImage(i.path,s=>{this._handleCallback(e,i,s,t)});break;case"audio":E.loadAudio(i.path,s=>{this._handleCallback(e,i,s,t)});break;case"json":E.loadJSON(i.path,s=>{this._handleCallback(e,i,s,t)});break;case"font":E.loadFont(i.name,i.path,s=>{this._handleCallback(e,i,s,t)})}}_handleCallback(t,e,i,s){t.set(e.name,i),++this._counter,this._onProgressHandler&&this._onProgressHandler(this._counter/this._size,e.path),this._counter===this._size&&(this._counter=this._size=0,this._toLoad=[],s(t))}static loadImage(t,e){let i=new Image;i.src=t,i.addEventListener("load",()=>{e(i)},{once:!0})}static loadAudio(t,e){let i=new Audio(t);i.load(),i.addEventListener("canplaythrough",()=>{e(i)},{once:!0})}static loadJSON(t,e){fetch(t).then(i=>i.json()).then(i=>e(i))}static loadFont(t,e,i){new FontFace(t,`url(${e})`).load().then(n=>{document.fonts.add(n),i(t)})}};var c=function(){return{parseValue(o,t){return o!==void 0&&(typeof o==typeof t||t===null)?o:t},parseObject(o,t){if(o)for(let e in t)t[e]=typeof t[e]=="object"&&!Array.isArray(t[e])&&t[e]!==null?this.parseObject(o[e],t[e]):this.parseValue(o[e],t[e]),typeof t[e]=="object"&&!Array.isArray(t[e])&&t[e]!==null?t[e].min!==void 0&&t[e].max!==void 0?t[e]=this.parseMinMax(o[e],t[e]):t[e]=this.parseObject(o[e],t[e]):t[e]=this.parseValue(o[e],t[e]);return t},parseMinMax(o,t){if(o===void 0)return t;if(typeof o=="number")return{min:o,max:o};if(typeof o=="object"&&!Array.isArray(o)&&o!==null){let e,i;if(typeof o.min=="number"&&o.min<=t.max?e=o.min:e=t.min,typeof o.max=="number"&&o.max>=t.min?i=o.max:i=t.max,e<=i)return{min:e,max:i}}return t}}}();var W=class{_timeouts=[];set(t,e){let i={action:t,dur:e,counter:0};return this._timeouts.push(i),i}clear(t){let e=this._timeouts.indexOf(t);e!=-1&&this._timeouts.splice(e,1)}update(t){for(let e=0;e<this._timeouts.length;++e){let i=this._timeouts[e];(i.counter+=t)>=i.dur&&(i.action(),this._timeouts.splice(e--,1))}}};var G=class{_paused=!0;_step;constructor(t){this._step=t}get paused(){return this._paused}_RAF(){this._frame=window.requestAnimationFrame(t=>{this._paused||this._RAF();let e=Math.min(t-this._previousRAF,1e3/30);this._step(e),this._previousRAF=t})}start(){this._paused=!1,this._previousRAF=performance.now(),this._RAF()}stop(){this._paused=!0,window.cancelAnimationFrame(this._frame)}};var K=class{_width;_height;_aspect;_scale;_parentElement;_container;_canvas;_context;constructor(t,e,i=document.body){this._width=t,this._height=e,this._parentElement=i,this._aspect=this._width/this._height,this._scale=1,this._buffers=[];for(let s=0;s<5;++s){let n=document.createElement("canvas").getContext("2d");n.canvas.width=this._width,n.canvas.height=this._height,n.imageSmoothingEnabled=!1,this._buffers[s]=n}this._initContainer(),this._initCanvas(),this._onResize(),window.addEventListener("resize",()=>this._onResize())}get canvas(){return this._canvas}render(t){let e=this._context;e.beginPath(),e.clearRect(0,0,this._width,this._height),this._draw(e,t,0,0)}displayToSceneCoords(t,e,i){let s=this._canvas.getBoundingClientRect(),n=(e-s.x)/this._scale,r=(i-s.y)/this._scale,a=t.camera;return{x:(n-this._width/2)/a.scale+a.position.x,y:(r-this._height/2)/a.scale+a.position.y}}_draw(t,e,i,s){let n=e[i];if(!n)return;if(n.hidden){this._draw(t,e,i+1,s);return}let r=this._width,a=this._height;if(n.drawLights(t,r,a),!this._buffers[s]){let l=document.createElement("canvas").getContext("2d");l.canvas.width=r,l.canvas.height=a,this._buffers[s]=l}let h=this._buffers[s];i<e.length-1&&(this._draw(h,e,i+1,s+1),h.globalCompositeOperation="source-over"),n.drawObjects(h,r,a),t.drawImage(h.canvas,0,0)}_initContainer(){let t=this._container=document.createElement("div");t.style.width=this._width+"px",t.style.height=this._height+"px",t.style.position="relative",t.style.left="50%",t.style.top="0%",t.style.transformOrigin="center",this._parentElement.appendChild(t)}_initCanvas(){let t=this._canvas=document.createElement("canvas");t.width=this._width,t.height=this._height,this._context=t.getContext("2d"),t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.display="block",this._container.appendChild(t)}_onResize(){let[t,e]=[this._parentElement.clientWidth,this._parentElement.clientHeight];t/e>this._aspect?this._scale=e/this._height:this._scale=t/this._width,this._container.style.transform="translate(-50%, calc(-50% + "+this._height/2*this._scale+"px)) scale("+this._scale+")",this._context.imageSmoothingEnabled=!1}};var Z=class{_scenes=[];get scenes(){return this._scenes.map(t=>t.scene)}add(t,e,i=0){let s={scene:t,name:e,zIndex:i};this._scenes.push(s);for(let n=this._scenes.length-1;n>0&&!(s.zIndex<this._scenes[n-1].zIndex);--n)[this._scenes[n],this._scenes[n-1]]=[this._scenes[n-1],this._scenes[n]]}get(t){return this._scenes.find(e=>e.name==t).scene}setZIndex(t,e){let i=this.get(t);i&&(this.remove(t),this.add(i,t,e))}remove(t){let e=this._scenes.findIndex(i=>i.name==t);return e!=-1?(this._scenes.splice(e,1),!0):!1}};var d=class{_x;_y;constructor(t=0,e=0){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}set x(t){this.set(t,this.y)}set y(t){this.set(this.x,t)}set(t,e){this._x=t,this._y=e}copy(t){return this.set(t.x,t.y),this}clone(){return new d(this.x,this.y)}add(t){return this.set(this.x+t.x,this.y+t.y),this}sub(t){return this.set(this.x-t.x,this.y-t.y),this}mult(t){return this.set(this.x*t,this.y*t),this}norm(){return this.set(this.y,-this.x),this}unit(){let t=this.mag();return t===0?this:(this.set(this.x/t,this.y/t),this)}mag(){return Math.hypot(this.x,this.y)}lerp(t,e){return this.add(t.clone().sub(this).mult(e))}angle(){return Math.atan2(this.y,this.x)}rot(t){let e=Math.sin(t),i=Math.cos(t),s=this.x*i-this.y*e,n=this.x*e+this.y*i;return this.set(s,n),this}static fromAngle(t){return new d(1,0).rot(t)}static dot(t,e){return t.x*e.x+t.y*e.y}static dist(t,e){return t.clone().sub(e).mag()}static cross(t,e){return t.x*e.y-t.y*e.x}static angleBetween(t,e){let i=t.mag(),s=e.mag();return i===0||s===0?0:Math.acos(d.dot(t,e)/(i*s))}},$=class extends d{_onChangeCallback;constructor(t,e=0,i=0){super(e,i);this._onChangeCallback=t}set(t,e){(t!=this.x||e!=this.y)&&(this._x=t,this._y=e,this._onChangeCallback())}};var y=function(){return{rand(o,t){return Math.random()*(t-o)+o},randint(o,t){return Math.floor(Math.random()*(t-o+1)+o)},lerp(o,t,e){return t+(e-t)*o},clamp(o,t,e){return Math.min(Math.max(o,t),e)},isBetween(o,t,e){return o>=t&&o<=e},sat(o){return this.clamp(o,0,1)},ease(o,t){return this.sat(o**t)},easeIn(o){return this.ease(o,2.4)},easeOut(o){return this.ease(o,.4)},choice(o){let t=o.length;return o[this.randint(0,t-1)]},shuffle(o){let t=o.length;for(let e=0;e<t;++e){let i=this.randint(0,t-1);[o[e],o[i]]=[o[i],o[e]]}}}}();var j=class{_value;_anim=null;constructor(t){this._value=t}get value(){return this._value}set value(t){this._value=t}animate(t,e,i="linear",s=null){this._anim={counter:0,dur:e,from:this._value,to:t,timing:i,onEnd:s}}isAnimating(){return this._anim!==null}stopAnimating(){this._anim=null}update(t){if(this._anim){let e=this._anim;e.counter+=t*1e3;let i=y.sat(e.counter/e.dur),s;switch(e.timing){case"linear":s=i;break;case"ease-in":s=y.easeIn(i);break;case"ease-out":s=y.easeOut(i);break}this._value=y.lerp(s,e.from,e.to),i==1&&(this.stopAnimating(),e.onEnd&&e.onEnd())}}};var D=class{_pos;_parent=null;_fixed=!1;_offset;_attached=[];_anim=null;constructor(){this._pos=new $(this._onPositionChange.bind(this)),this._offset=new $(this._onOffsetChange.bind(this))}get position(){return this._pos}set position(t){this._pos.copy(t)}get offset(){return this._offset}set offset(t){this._offset.copy(t)}clip(t,e=!1){this._attached.push(t),t._parent=this,t._fixed=e,t._offset.copy(t.position.clone().sub(this._pos))}unclip(t){let e=this._attached.indexOf(t);e!=-1&&(this._attached.splice(e,1),t._parent=null)}moveTo(t,e,i="linear",s=null){this._anim={counter:0,dur:e,from:this.position.clone(),to:t,timing:i,onEnd:s}}stopMoving(){this._anim=null}isMoving(){return this._anim!=null}update(t){if(this._anim){let e=this._anim;e.counter+=t*1e3;let i=y.sat(e.counter/e.dur),s;switch(e.timing){case"linear":s=i;break;case"ease-in":s=y.easeIn(i);break;case"ease-out":s=y.easeOut(i);break}this._pos.copy(e.from.clone().lerp(e.to,s)),i==1&&(this.stopMoving(),e.onEnd&&e.onEnd())}}_onPositionChange(){this._parent&&(this._fixed?this._parent.position.copy(this._pos.clone().sub(this._offset)):this._offset.copy(this._pos.clone().sub(this._parent.position)));for(let t of this._attached)t.position.copy(this._pos.clone().add(t._offset))}_onOffsetChange(){this._parent&&this._fixed&&this._pos.copy(this._parent.position.clone().add(this._offset))}};var M=class{_type="";_parent=null;_position=new D;_angle=new j(0);get type(){return this._type}get scene(){return this._parent._scene}get parent(){return this._parent}get position(){return this._position.position}set position(t){this._position.position=t}get offset(){return this._position.offset}set offset(t){this._position.offset=t}get angle(){return this._angle.value}set angle(t){this._angle.value=t}initComponent(){}getComponent(t){return this._parent.getComponent(t)}rotate(t,e,i="linear",s=null){this._angle.animate(t,e,i,s)}update(t){}};var Q=class extends M{_eventHandlers=new Map;constructor(){super();this._type="interactive"}on(t,e,i=!1){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push({handler:e,capture:i})}off(t,e){if(!this._eventHandlers.has(t))return;let i=this._eventHandlers.get(t),s=i.findIndex(n=>n.handler==e);s!=-1&&i.splice(s,1)}handleEvent(t,e){if(!this._eventHandlers.has(t))return!1;let i=!1,s=this._eventHandlers.get(t);for(let n of s)n.handler(e),n.capture&&(i=!0);return i}};var J=class{constructor(t,e,i,s,n=null){this.x=t,this.y=e,this.w=i,this.h=s,this.entity=n}_vsAabb(t){return this.x+this.w/2>=t.x-t.w/2&&this.x-this.w/2<=t.x+t.w/2&&this.y+this.h/2>=t.y-t.h/2&&this.y-this.h/2<=t.y+t.h/2}},V=class{_bounds;_limit;_aabb;_divided=!1;_data=[];_topLeft=null;_topRight=null;_bottomLeft=null;_bottomRight=null;_maxRecursionDepth=5;constructor(t,e){this._bounds=t;let i=t[1][0]-t[0][0],s=t[1][1]-t[0][1];this._aabb=new J(t[0][0]+i/2,t[0][1]+s/2,i,s),this._limit=e}newClient(t,e){let i=new J(t[0],t[1],e[0],e[1]);return this._insert(i),i}updateClient(t){this._insert(t)}findNear(t,e){let[i,s]=e,[n,r]=t,a=new J(n,r,i,s),h=this._search(a);return h==null?[]:Array.from(h)}clear(){this._data=[],this._divided=!1,this._topRight=null,this._topLeft=null,this._bottomLeft=null,this._bottomRight=null}draw(t){t.beginPath(),t.strokeStyle="white",t.strokeRect(this._aabb.x-this._aabb.w/2,this._aabb.y-this._aabb.h/2,this._aabb.w,this._aabb.h),this._divided&&(this._topLeft.draw(t),this._topRight.draw(t),this._bottomLeft.draw(t),this._bottomRight.draw(t))}_divide(){let t=this._bounds,e=t[1][0]-t[0][0],i=t[1][1]-t[0][1];this._topLeft=new V([[t[0][0],t[0][1]],[t[0][0]+e/2,t[0][1]+i/2]],this._limit),this._topRight=new V([[t[0][0]+e/2,t[0][1]],[t[0][0]+e,t[0][1]+i/2]],this._limit),this._bottomLeft=new V([[t[0][0],t[0][1]+i/2],[t[0][0]+e/2,t[0][1]+i]],this._limit),this._bottomRight=new V([[t[0][0]+e/2,t[0][1]+i/2],[t[0][0]+e,t[0][1]+i]],this._limit);for(let s of this._data)this._topLeft._insert(s),this._topRight._insert(s),this._bottomLeft._insert(s),this._bottomRight._insert(s);this._divided=!0}_search(t,e){if(e==null&&(e=new Set),!!t._vsAabb(this._aabb)){if(this._divided)this._topLeft._search(t,e),this._topRight._search(t,e),this._bottomLeft._search(t,e),this._bottomRight._search(t,e);else for(let i of this._data)t._vsAabb(i)&&e.add(i);return e}}_insert(t,e=0){if(!this._aabb._vsAabb(t))return!1;if(this._data.length<this._limit||e>this._maxRecursionDepth)return this._data.push(t),!0;this._divided||this._divide(),this._topLeft._insert(t,e+1),this._topRight._insert(t,e+1),this._bottomLeft._insert(t,e+1),this._bottomRight._insert(t,e+1)}};var tt=class{_body1;_body2;_offset1;_offset2;_length;_strength;constructor(t,e,i){this._body1=t,this._body2=e;let s=c.parseObject(i.offset1,{x:0,y:0});this._offset1=new d(s.x,s.y);let n=c.parseObject(i.offset2,{x:0,y:0});this._offset2=new d(n.x,n.y);let r=this._body1.position.clone().add(this._offset1.clone().rot(this._body1.angle)),a=this._body2.position.clone().add(this._offset2.clone().rot(this._body2.angle));this._length=c.parseValue(i.length,Math.max(d.dist(r,a),1)),this._strength=c.parseValue(i.strength,1)}get offset1(){return this._offset1}set offset1(t){this._offset1.copy(t)}get offset2(){return this._offset2}set offset2(t){this._offset2.copy(t)}get length(){return this._length}set length(t){this._length=Math.max(t,1)}get strength(){return this._strength}set strength(t){this._strength=y.sat(t)}update(t){}},et=class extends tt{constructor(t,e,i){super(t,e,i)}update(t){if(this._body1.mass===0&&this._body2.mass===0)return;let e=this.offset1.clone().rot(this._body1.angle),i=this.offset2.clone().rot(this._body2.angle),s=this._body1.position.clone().add(e),n=this._body2.position.clone().add(i),r=s.clone().sub(n),a=r.clone().unit(),l=(r.mag()-this.length)/this.length,u=a.clone().mult(l*-this.strength*512/(this._body1.inverseMass+this._body2.inverseMass)),_=u.clone().mult(this._body1.inverseMass);this._body1.velocity.add(_.clone().mult(t)),this._body1.angularVelocity+=d.cross(e,_.clone().mult(1/this._body1.inertia))*t;let f=u.clone().mult(this._body2.inverseMass);this._body2.velocity.sub(f.clone().mult(t)),this._body2.angularVelocity-=d.cross(i,f.clone().mult(1/this._body2.inertia))*t}},it=class extends tt{constructor(t,e,i){super(t,e,i)}update(t){if(this._body1.mass===0&&this._body2.mass===0)return;let e=this.offset1.clone().rot(this._body1.angle),i=this.offset2.clone().rot(this._body2.angle),s=this._body1.position.clone().add(e),n=this._body2.position.clone().add(i),r=s.clone().sub(n),a=r.clone().unit(),h=r.mag(),l=16,u=a.clone().mult((h-this.length)*-1/(this._body1.inverseMass+this._body2.inverseMass));this._body1.position.add(u.clone().mult(this._body1.inverseMass*l*t)),this._body2.position.sub(u.clone().mult(this._body2.inverseMass*l*t));let _=(h-this.length)/this.length,f=a.clone().mult(_*-this.strength*512/(this._body1.inverseMass+this._body2.inverseMass)),v=f.clone().mult(this._body1.inverseMass);this._body1.velocity.add(v.clone().mult(t)),this._body1.angularVelocity+=d.cross(e,v.clone().mult(1/this._body1.inertia))*t;let w=f.Clone().Mult(this._body2.inverseMass);this._body2.velocity.Sub(w.Clone().Mult(t)),this._body2.angularVelocity-=d.Cross(i,w.Clone().Mult(1/this._body2.inertia))*t}};var X=class extends M{_vel=new d;_angVel=0;_passiveVel=new d;_behavior=[];_friction;_mass;_rotation;_collisions={left:new Set,right:new Set,top:new Set,bottom:new Set,all:new Set};_options;_followBottomObject;_resized=!1;_behaviorIds=0;_joints=[];constructor(t){super();this._type="body",this._friction=c.parseObject(t.friction,{x:0,y:0,angular:0}),this._mass=c.parseValue(t.mass,0),this._rotation=c.parseValue(t.rotation,0),this._options=c.parseObject(t.options,{axes:{x:!0,y:!0},sides:{left:!0,right:!0,top:!0,bottom:!0}}),this._followBottomObject=c.parseValue(t.followBottomObject,!1)}get velocity(){return this._vel}set velocity(t){this._vel.copy(t)}get angularVelocity(){return this._angVel}set angularVelocity(t){this._angVel=t}get mass(){return this._mass}set mass(t){this._mass=Math.max(t,0)}get friction(){return this._friction}get rotation(){return this._rotation}set rotation(t){this._rotation=t}get inverseMass(){return this._mass===0?0:1/this._mass}get inertia(){return 0}get collisions(){return this._collisions}get options(){return this._options}get followBottomObject(){return this._followBottomObject}set followBottomObject(t){this._followBottomObject=t}get passiveVelocity(){return this._passiveVel}set passiveVelocity(t){this._passiveVel.copy(t)}initComponent(){this.scene.addBody(this.parent,this)}getBoundingRect(){return{width:0,height:0}}addBehavior(t,e,i,s){s===void 0&&(s=this._generateBehaviorName()),this._behavior.push({groups:t.split(" "),type:e,options:c.parseObject(i,{bounce:0,friction:0,action:null}),name:s})}removeBehavior(t){let e=this._behavior.findIndex(i=>i.name==t);e!=-1&&this._behavior.splice(e,1)}updateBehavior(t,e={}){let i=this._behavior.find(s=>s.name==t);if(i)for(let s in e)i.options[s]=e[s]}join(t,e,i){i===void 0&&(i={});let s;switch(e){case"elastic":s=new et(this,t,i);break;case"solid":s=new it(this,t,i);break}return s?(this.scene.world._addJoint(s),this._joints.push(s),t._joints.push(s),s):null}contains(t){return!1}applyForce(t,e){let i=e.clone().sub(this.position),s=t.clone().mult(this.inverseMass);this.velocity.add(s),this.angularVelocity+=d.cross(i,s.clone().mult(1/this.inertia))}updatePosition(t){let e=30,i=new d(this._vel.x*this._friction.x*e,this._vel.y*this._friction.y*e);this._vel.sub(i.mult(t));let s=this._vel.clone().mult(t);this.position.add(s),this.position.add(this._passiveVel.clone().mult(t)),this._passiveVel.set(0,0),this._angVel-=this._angVel*this._friction.angular*e*t,this.angle+=this._angVel*t}handleBehavior(){let t=this.getComponent("QuadtreeController"),e=this.getBoundingRect();for(let i of this._behavior){let s=t.findNearby(e.width,e.height).filter(n=>i.groups.map(r=>n.groupList.has(r)).some(r=>r));s.sort((n,r)=>{let a=n.body.getBoundingRect(),h=r.body.getBoundingRect(),l=d.dist(this.position,n.body.position)/new d(e.width+a.width,e.height+a.height).mag(),u=d.dist(this.position,r.body.position)/new d(e.width+h.width,e.height+h.height).mag();return l-u});for(let n of s){let r;switch(i.type){case"detect":r=Y(this,n.body),r.collide&&i.options.action&&i.options.action(n.body,r.point);break;case"resolve":r=Yt(this,n.body,i.options),r.collide&&i.options.action&&i.options.action(n.body,r.point);break}}}}draw(t){let e=this.getBoundingRect();t.beginPath(),t.strokeStyle="white",t.strokeRect(this.position.x-e.width/2,this.position.y-e.height/2,e.width,e.height)}_generateBehaviorName(){return++this._behaviorIds,"__behavior__"+this._behaviorIds}},b=class extends X{_points;constructor(t){super(t);this._points=t.points}get inertia(){let t=0;for(let e=0;e<verts.length;++e){let s=verts[e].mag();s>t&&(t=s)}return Math.PI*t**2*.5/this.rotation}getBoundingRect(){let t=this._getVertices(),e=0;for(let s=0;s<t.length;++s){let r=t[s].mag();r>e&&(e=r)}let i=e*2;return{width:i,height:i}}contains(t){let e=this.getComputedVertices(),i=e.length,s=0;for(let n=0;n<i;++n){let r=e[n],a=e[(n+1)%i];(t.y-r.y)*(t.y-a.y)<=0&&(t.x<=r.x||t.x<=a.x)&&(r.x>=t.x&&a.x>=t.x||(a.x-r.x)*(t.y-r.y)/(a.y-r.y)>=t.x-r.x)&&++s}return s%2}getComputedVertices(){let t=this._getVertices();for(let e=0;e<t.length;++e){let i=t[e];i.rot(this.angle),i.add(this.position)}return t}_getVertices(){return this._points.map(t=>new d(t[0],t[1]))}static getFaceNormals(t){let e=[];for(let i=0;i<t.length;i++){let s=t[i].clone(),n=t[(i+1)%t.length].clone();e[i]=n.clone().sub(s).norm().unit()}return e}static findSupportPoint(t,e,i){let s=-1/0,n=-1;for(let r=0;r<t.length;r++){let a=t[r].clone().sub(i),h=d.dot(a,e);h>0&&h>s&&(s=h,n=r)}return{sp:t[n],depth:s}}},st=class extends b{_width;_height;constructor(t){super(t);this._width=t.width,this._height=t.height,this._initPoints()}get width(){return this._width}get height(){return this._height}set width(t){this._width=Math.max(t,0),this._initPoints()}set height(t){this._height=Math.max(t,0),this._initPoints()}get inertia(){return(this.width**2+this.height**2)*.1/this.rotation}_initPoints(){this._points=[[-this._width/2,-this._height/2],[this._width/2,-this._height/2],[this._width/2,this._height/2],[-this._width/2,this._height/2]],this._resized=!0}},ot=class extends b{_radius;_sides;constructor(t){super(t);this._radius=t.radius,this._sides=t.sides,this._initPoints()}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._initPoints()}get sides(){return this._sides}set sides(t){this._sides=Math.max(t,3),this._initPoints()}get inertia(){return Math.PI*this.radius**2*.2/this.rotation}getBoundingRect(){return{width:2*this.radius,height:2*this.radius}}_initPoints(){let t=[];for(let e=0;e<this._sides;++e){let i=Math.PI*2/this._sides*e;t.push([Math.cos(i)*this._radius,Math.sin(i)*this._radius])}this._points=t,this._resized=!0}},S=class extends X{_radius;constructor(t){super(t);this._radius=t.radius}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._resized=!0}get inertia(){return Math.PI*this.radius**2*.4/this.rotation}getBoundingRect(){return{width:2*this.radius,height:2*this.radius}}findSupportPoint(t,e){let i=[];i[0]=this.position.clone().add(t.clone().mult(this.radius)),i[1]=this.position.clone().add(t.clone().mult(-this.radius));let s=-1/0,n=-1;for(let r=0;r<i.length;r++){let a=i[r].clone().sub(e),h=d.dot(a,t);h>0&&h>s&&(s=h,n=r)}return{sp:i[n],depth:s,n:t}}findNearestVertex(t){let e=1/0,i=0;for(let s=0;s<t.length;s++){let n=d.dist(t[s],this.position);n<e&&(e=n,i=s)}return t[i]}contains(t){return d.dist(t,this.position)<=this.radius}},R=class extends X{_range;constructor(t){super(t);this._range=t.range}get range(){return this._range}set range(t){this._range=t,this._resized=!0}get point(){return this.position.clone().add(new d(this.range,0).rot(this.angle))}getBoundingRect(){return{width:2*this.range,height:2*this.range}}},Y=(o,t)=>o instanceof S&&t instanceof S?Jt(o,t):o instanceof b&&t instanceof b?Xt(o,t):o instanceof S&&t instanceof b?Tt(o,t):o instanceof b&&t instanceof S?Tt(t,o):o instanceof R&&t instanceof b?Dt(o,t):o instanceof b&&t instanceof R?Dt(t,o):o instanceof R&&t instanceof S?Ot(o,t):o instanceof S&&t instanceof R?Ot(t,o):o instanceof R&&t instanceof R?Qt(t,o):{collide:!1},Lt=(o,t,e,i)=>{let s=t.clone().sub(o),n=i.clone().sub(e),r=s.x*n.y-s.y*n.x,a=((e.x-o.x)*s.y-(e.y-o.y)*s.x)/r,h=((e.x-o.x)*n.y-(e.y-o.y)*n.x)/r;return 0<=a&&a<=1&&0<=h&&h<=1?{collide:!0,point:o.clone().add(s.clone().mult(h))}:{collide:!1}},Qt=(o,t)=>{let e=Lt(o.position,o.point,t.position,t.point);return e.collide&&(o._collisions.all.add(t),t._collisions.all.add(o)),e},Dt=(o,t)=>{let e=o.point,i=1/0,s=null,n=t.getComputedVertices();for(let r=0;r<n.length;++r){let a=n[r],h=n[(r+1)%n.length],l=Lt(o.position,e,a,h);if(l.collide){let u=d.dist(o.position,l.point);u<i&&(i=u,s=l.point)}}return s!=null?(o._collisions.all.add(t),t._collisions.all.add(o),{collide:!0,point:s}):{collide:!1}},Ot=(o,t)=>{let e=o.point,i=e.clone().sub(o.position).unit(),s=t.position.clone().sub(o.position),n=t.radius**2,r=s.mag()**2,a=d.dot(s,i),h=r-a*a;if(n-h<0)return{collide:!1};let l=Math.sqrt(n-h),u;r<n?u=a+l:u=a-l;let _=o.position.clone().add(i.clone().mult(u));return d.dot(_.clone().sub(o.position),e.clone().sub(o.position))<0||d.dist(_,o.position)>o.range?{collide:!1}:(o._collisions.all.add(t),t._collisions.all.add(o),{collide:!0,point:_})},Jt=(o,t)=>{let e=o.position.clone().sub(t.position),i={};return e.mag()<o.radius+t.radius?(i.normal=e.clone().unit(),i.depth=o.radius+t.radius-e.mag(),i.point=o.position.clone().add(i.normal.clone().mult(o.radius)),i.collide=!0,o._collisions.all.add(t),t._collisions.all.add(o),i):{collide:!1}},Xt=(o,t)=>{let e=o.getComputedVertices(),i=t.getComputedVertices(),s=b.getFaceNormals(e),n=b.getFaceNormals(i),r=[];for(let _=0;_<s.length;_++){let f=b.findSupportPoint(i,s[_].clone().mult(-1),e[_]);if(f.n=s[_].clone(),r[_]=f,f.sp==null)return{collide:!1}}let a=[];for(let _=0;_<n.length;_++){let f=b.findSupportPoint(e,n[_].clone().mult(-1),i[_]);if(f.n=n[_].clone(),a[_]=f,f.sp==null)return{collide:!1}}r=r.concat(a);let h=1/0,l=0;for(let _=0;_<r.length;_++)r[_].depth<h&&(h=r[_].depth,l=_);let u=t.position.clone().sub(o.position);return d.dot(u,r[l].n)>0&&r[l].n.mult(-1),o._collisions.all.add(t),t._collisions.all.add(o),{collide:!0,normal:r[l].n,depth:r[l].depth,point:r[l].sp}},Tt=(o,t)=>{let e=t.getComputedVertices(),i=b.getFaceNormals(e),s=[];for(let u=0;u<i.length;u++){let _=o.findSupportPoint(i[u].clone().mult(-1),e[u].clone());if(_.sp==null)return{collide:!1};s[u]=_}let n=t.position.clone().sub(o.position).unit().mult(-1),r=b.findSupportPoint(e,n.clone(),o.position.clone().add(n.clone().mult(-o.radius)));if(r.sp==null)return{collide:!1};r.n=n.clone(),s.push(r);let a=1/0,h=0;for(let u=0;u<s.length;u++)s[u].depth<a&&(a=s[u].depth,h=u);let l=t.position.clone().sub(o.position);return d.dot(l,s[h].n)<0&&s[h].n.mult(-1),o._collisions.all.add(t),t._collisions.all.add(o),{collide:!0,normal:s[h].n,point:s[h].sp,depth:s[h].depth}},Yt=(o,t,e)=>{o instanceof S&&t instanceof b&&([o,t]=[t,o]);let i=Y(o,t);if(i.collide){let s={collide:!0,point:i.point};if(o.mass===0&&t.mass===0)return s;o.options.axes.x&&t.options.axes.x||(i.normal.x=0),o.options.axes.y&&t.options.axes.y||(i.normal.y=0);let n=e.bounce,r=e.friction,a={left:new d(-1,0),right:new d(1,0),top:new d(0,-1),bottom:new d(0,1)},h;d.dot(i.normal,a.left)>=Math.SQRT2/2?h="left":d.dot(i.normal,a.right)>=Math.SQRT2/2?h="right":d.dot(i.normal,a.top)>=Math.SQRT2/2?h="top":d.dot(i.normal,a.bottom)>=Math.SQRT2/2&&(h="bottom");let l=i.point.clone().sub(o.position),u=i.point.clone().sub(t.position),_=o.angularVelocity,f=t.angularVelocity,v=o._vel,w=t._vel,g=v.clone().add(new d(-_*l.y,_*l.x)),p=w.clone().add(new d(-f*u.y,f*u.x)),x=g.clone().sub(p),m=-(1+n)*d.dot(x,i.normal)/(o.inverseMass+t.inverseMass+Math.pow(d.cross(l,i.normal),2)/o.inertia+Math.pow(d.cross(u,i.normal),2)/t.inertia),k=i.normal.clone().mult(m),A=k.clone().mult(o.inverseMass),B=k.clone().mult(t.inverseMass),Pt=d.dot(k,a.left),jt=d.dot(k,a.right),Rt=d.dot(k,a.top),Et=d.dot(k,a.bottom);if((Pt>=Math.SQRT2/2||Pt<Math.SQRT2/2&&h=="left")&&(!o.options.sides.right||!t.options.sides.left))return s;if((jt>=Math.SQRT2/2||jt<Math.SQRT2/2&&h=="right")&&(!o.options.sides.left||!t.options.sides.right))return s;if((Rt>=Math.SQRT2/2||Rt<Math.SQRT2/2&&h=="top")&&(!o.options.sides.bottom||!t.options.sides.top))return s;if((Et>=Math.SQRT2/2||Et<Math.SQRT2/2&&h=="bottom")&&(!o.options.sides.top||!t.options.sides.bottom))return s;let Vt=i.normal.clone().mult(i.depth/(o.inverseMass+t.inverseMass));if(o.position.add(Vt.clone().mult(o.inverseMass)),t.position.sub(Vt.clone().mult(t.inverseMass)),d.dot(x,i.normal)<=0){o._vel.add(A),t._vel.sub(B),o.angularVelocity+=d.cross(l,A.clone().mult(1/o.inertia)),t.angularVelocity-=d.cross(u,B.clone().mult(1/o.inertia));let q=i.normal.clone().norm(),Nt=-(1+n)*d.dot(x,q)*r/(o.inverseMass+t.inverseMass+Math.pow(d.cross(l,q),2)/o.inertia+Math.pow(d.cross(u,q),2)/t.inertia),St=q.clone().mult(Nt),Bt=St.clone().mult(o.inverseMass),At=St.clone().mult(t.inverseMass);switch(o._vel.add(Bt.clone()),t._vel.sub(At.clone()),o.angularVelocity+=d.cross(l,Bt.clone().mult(1/o.inertia)),t.angularVelocity-=d.cross(u,At.clone().mult(1/t.inertia)),h){case"left":o._collisions.right.add(t),t._collisions.left.add(o);break;case"right":o._collisions.left.add(t),t._collisions.right.add(o);break;case"top":o._collisions.bottom.add(t),t._collisions.top.add(o);break;case"bottom":o._collisions.top.add(t),t._collisions.bottom.add(o);break}}return h=="bottom"?t.followBottomObject&&(t.passiveVelocity=o.velocity):h=="top"&&o.followBottomObject&&(o.passiveVelocity=t.velocity),s}return{collide:!1}};var nt=class{_relaxationCount;_gravity;_quadtree;_bodies=[];_joints=[];constructor(t={}){this._relaxationCount=c.parseValue(t.relaxationCount,3),this._gravity=c.parseValue(t.gravity,0);let e=c.parseValue(t.bounds,[[-1e3,-1e3],[1e3,1e3]]),i=c.parseObject(t.cellDimension,{width:100,height:100}),s=c.parseValue(t.cellLimit,10);this._quadtree=new V(e,s)}get quadtree(){return this._quadtree}addJoint(t){this._joints.push(t)}removeJoint(t){let e=this._joints.indexOf(t);e!=-1&&this._joints.splice(e,1)}addBody(t,e){t._body=e;let i=new It({quadtree:this._quadtree});t.addComponent(i),this._bodies.push(e)}removeBody(t,e){let i=this._bodies.indexOf(e);if(i!=-1){for(let s of e._joints){let n=s._body2;n._joints.splice(n._joints.indexOf(s),1),this.removeJoint(s)}this._bodies.splice(i,1)}}update(t){for(let e of this._bodies)e._collisions.left.clear(),e._collisions.right.clear(),e._collisions.top.clear(),e._collisions.bottom.clear(),e._collisions.all.clear();for(let e of this._bodies)e.mass!=0&&(e.velocity.y+=this._gravity*t),e.updatePosition(t);for(let e of this._joints)e.update(t);for(let e=0;e<this._relaxationCount;++e)for(let i of this._bodies)i.handleBehavior();this._quadtree.clear();for(let e of this._bodies)e.getComponent("QuadtreeController").updateClient()}raycast(t,e){let i=[];t=t.split(" ");let s=new R({range:e.range});s.position=e.position,s.angle=e.angle;let n=s.getBoundingRect(),r=this._bodies.filter(a=>{if(!t.map(l=>a.parent.groupList.has(l)).some(l=>l))return!1;let h=a.getBoundingRect();return(s.position.x+n.width/2-(a.position.x-h.width/2))*(s.position.x-n.width/2-(a.position.x+h.width/2))<0||(s.position.y+n.height/2-(a.position.y-h.height/2))*(s.position.y-n.height/2-(a.position.y+h.height/2))<0});for(let a of r){let h=Y(s,a);h.collide&&i.push({body:a,point:h.point})}return i}},It=class extends M{_quadtree;_client=null;constructor(t){super();this._quadtree=t.quadtree}initComponent(){let t=[this._parent.body.position.x,this._parent.body.position.y],e=this._parent.body.getBoundingRect();this._client=this._quadtree.newClient(t,[e.width,e.height]),this._client.entity=this._parent}findNearby(t,e){return this._quadtree.findNear([this._parent.position.x,this._parent.position.y],[t,e]).filter(s=>s.entity!=this._parent).map(s=>s.entity)}updateClient(){let t=[this._parent.body.position.x,this._parent.body.position.y];if(this._client.x=t[0],this._client.y=t[1],this._parent.body._resized){this._parent.body._resized=!1;let e=this._parent.body.getBoundingRect();this._client.w=e.width,this._client.h=e.height}this._quadtree.updateClient(this._client)}};var P=class{_color;_parsed=null;constructor(t="black"){this._color=t}set(t){this._color=t,this._parsed=null}fill(t){t.fillStyle=this.get(t)}stroke(t){t.strokeStyle=this.get(t)}get(t){return this._parsed==null&&(this._parsed=P.parse(t,this._color)),this._parsed}static parse(t,e){if(typeof e!="string")return"black";let i=e.split(";"),s=i.length;if(s===1)return e;let n,r=i[1].split(",").map(a=>parseFloat(a));switch(i[0]){case"linear-gradient":n=t.createLinearGradient(...r);break;case"radial-gradient":n=t.createRadialGradient(...r);break;default:return"black"}for(let a=2;a<s;++a){let h=i[a].split("=");n.addColorStop(parseFloat(h[1]),h[0])}return n}};var O=class{_offset=new d;_anim=null;get offset(){return this._offset}shake(t,e,i,s){let n=i*e/1e3;this._anim={counter:0,count:n,angle:s,dur:e,range:t}}isShaking(){return this._anim!==null}stopShaking(){this._anim=null,this._offset.set(0,0)}update(t){if(this._anim){let e=this._anim;e.counter+=t*1e3;let i=y.sat(e.counter/e.dur);this._offset.copy(new d(Math.sin(i*Math.PI*2*e.count)*e.range,0).rot(e.angle)),i==1&&this.stopShaking()}}};var T=class{_name=null;_scene=null;_parent=null;_groupList=new Set;_components=new Map;_position=new D;_interactive=null;_body=null;_onUpdate=null;_properties=new Map;get name(){return this._name}get scene(){return this._scene}get position(){return this._position.position}set position(t){this._position.position=t}get interactive(){return this._interactive}get body(){return this._body}get groupList(){return this._groupList}get props(){return this._properties}clip(t,e=!1){this._position.clip(t._position,e)}unclip(t){this._position.unclip(t._position)}moveTo(t,e,i="linear",s=null){this._position.moveTo(t,e,i,s)}stopMoving(){this._position.stopMoving()}isMoving(){return this._position.isMoving()}addComponent(t,e){e===void 0&&(e=t.constructor.name),this._components.set(e,t),t._parent=this,t.position.copy(this.position.clone().add(t.offset)),this.clip(t,!0),t.initComponent()}getComponent(t){return this._components.get(t)}_updatePosition(t){this._position.update(t)}update(t){this._updatePosition(t),this._onUpdate&&this._onUpdate(t),this._components.forEach(e=>{e.update(t)})}onUpdate(t){this._onUpdate=t}};var rt=class extends T{_scale=new j(1);_target=null;_t=4;_vel=new d;_shaker=new O;constructor(){super()}get position(){return this._position.position}get scale(){return this._scale.value}set scale(t){t>0&&(this._scale.value=t)}get velocity(){return this._vel}set velocity(t){this._vel.copy(t)}get shaker(){return this._shaker}follow(t,e=4){this._target=t,this._t=e}unfollow(){this._target=null}isScaling(){return this._scale.isAnimating()}scaleTo(t,e,i="linear",s=null){this._scale.animate(t,e,i,s)}stopScaling(){this._scale.stopAnimating()}moveAndScale(t,e,i,s="linear",n=null){this.moveTo(t,i,s,n),this.scaleTo(e,i,s)}stop(){this.stopMoving(),this.stopScaling()}_updatePosition(t){if(this.isMoving())this._position.update(t);else if(this._target!=null){let e=y.sat(this._t*t*60);this.position.lerp(this._target.position,e)}else{let e=this._vel.clone();e.mult(t),this.position.add(e)}this._scale.update(t),this._shaker.update(t)}};var at=class{_entities=[];_entitiesMap=new Map;_ids=0;add(t,e){e===void 0&&(e=this._generateName()),this._entities.push(t),this._entitiesMap.set(e,t),t._parent=this,t._name=e}get(t){return this._entitiesMap.get(t)}remove(t){let e=this._entities.indexOf(t);e<0||this._entities.splice(e,1)}filter(t){return this._entities.filter(t)}update(t){for(let e of this._entities)e.update(t)}_generateName(){return++this._ids,"__entity__"+this._ids}};var ht=class{_fps=60;_frameCounter=0;_timeCounter=0;get fps(){return this._fps}update(t){this._timeCounter+=t,++this._frameCounter,this._timeCounter>=1&&(this._timeCounter-=1,this._fps=this._frameCounter,this._frameCounter=0)}};var lt=class{_paused=!0;_hidden=!0;_world;_lights=[];_drawable=[];_interactiveEntities=[];_keys=new Set;_entityManager=new at;_buffer=null;_light;_background;_timeout=new W;_camera;_interactive=new Q;_game=null;debug=!1;_fpsMeter=new ht;_drawCounter=0;constructor(t={}){this._world=new nt(t.physics),this._light=new P(c.parseValue(t.light,"white")),this._background=new P(c.parseValue(t.background,t.background)),this._camera=new rt,this.addEntity(this._camera,"Camera")}get paused(){return this._paused}get hidden(){return this._hidden}get timeout(){return this._timeout}get camera(){return this._camera}get world(){return this._world}get resources(){return this._game.resources}get audio(){return this._game.audio}get background(){return this._background._color}set background(t){this._background.set(t)}get light(){return this._light._color}set light(t){this._light.set(t)}get interactive(){return this._interactive}isKeyPressed(t){return this._keys.has(t)}setInteractive(t){this._interactiveEntities.push(t);let e=new Q;t.addComponent(e),t._interactive=e}getEntityByName(t){return this._entityManager.get(t)}getEntitiesByGroup(t){return this._entityManager.filter(e=>e.groupList.has(t))}handleEvent(t,e){let i=!1;if(t.startsWith("mouse")){if(t=="mousedown"){let s=this._world.quadtree.findNear([e.x,e.y],[0,0]).map(n=>n.entity);for(let n of s)!n.interactive||n.body.contains(new d(e.x,e.y))&&(n.interactive.id=e.id,n.interactive.handleEvent(t,e)&&(i=!0))}}else if(t.startsWith("key"))switch(t){case"keydown":this._keys.add(e.key);break;case"keyup":this._keys.delete(e.key);break}return i||this._interactive.handleEvent(t,e)&&(i=!0),i}createEntity(t){let e=new T;return this.addEntity(e,t),e}addEntity(t,e){t._scene=this,this._entityManager.add(t,e)}removeEntity(t){this._entityManager.remove(t),t._components.forEach(e=>{switch(e._type){case"drawable":this.removeDrawable(e);break;case"body":this.removeBody(t,e);break;case"light":this.removeLight(e);break;case"interactive":this._interactiveEntities.splice(this._interactiveEntities.indexOf(t),1);break}})}addDrawable(t){this._drawable.push(t);for(let e=this._drawable.length-1;e>0&&!(t._zIndex>=this._drawable[e-1]._zIndex);--e)[this._drawable[e],this._drawable[e-1]]=[this._drawable[e-1],this._drawable[e]]}removeDrawable(t){let e=this._drawable.indexOf(t);e!=-1&&this._drawable.splice(e,1)}addBody(t,e){this._world.addBody(t,e)}removeBody(t,e){this._world.removeBody(t,e)}addLight(t){this._lights.push(t)}removeLight(t){this._lights.splice(this._lights.indexOf(t),1)}hide(){this._paused=!0,this._hidden=!0}pause(){this._paused=!0}play(){this._paused=!1,this._hidden=!1}drawLights(t,e,i){t.globalCompositeOperation="source-over",t.beginPath(),this._light.fill(t),t.fillRect(0,0,e,i);let s=this._camera,n=s.position.clone().add(s.shaker.offset);t.globalCompositeOperation="lighter",t.save(),t.translate(-n.x*s.scale+e/2,-n.y*s.scale+i/2),t.scale(s.scale,s.scale);for(let r of this._lights)r.drawInternal(t);t.restore(),t.globalCompositeOperation="multiply"}drawObjects(t,e,i){let s=this._camera,n=s.position.clone().add(s.shaker.offset);this._buffer||(this._buffer=document.createElement("canvas").getContext("2d"),this._buffer.canvas.width=e,this._buffer.canvas.height=i,this._buffer.imageSmoothingEnabled=!1);let r=this._buffer;if(r.beginPath(),this._background.fill(r),r.fillRect(0,0,e,i),r.save(),r.translate(-n.x*s.scale+e/2,-n.y*s.scale+i/2),r.scale(s.scale,s.scale),this.debug){this.world.quadtree.draw(r);for(let a of this.world._bodies)a.draw(r)}this._drawCounter=0;for(let a of this._drawable){let h=a.getBoundingBox(),l=new d(h.x,h.y);l.sub(n),l.mult(s.scale);let[u,_]=[h.width,h.height].map(f=>f*s.scale);l.x+u/2<-e/2||l.x-u/2>e/2||l.y+_/2<-i/2||l.y-_/2>i/2||(++this._drawCounter,a.drawInternal(r))}r.restore(),this._drawDebugInfo(r,e,i),t.drawImage(r.canvas,0,0)}update(t){this._fpsMeter.update(t),!this._paused&&(this.timeout.update(t*1e3),this._entityManager.update(t),this._world.update(t))}_drawDebugInfo(t,e,i){if(!this.debug)return;let s=0,n=0,r=Math.max(e*.4,200),a=Math.max(e*.2,100),h=Math.max(e*.01,4),l=Math.max(e*.025,12),u=Math.max(e*.005,2),_="white",f="rgba(128,128,128,0.5)",v=[`Paused: ${this._paused}`,`FPS: ${this._fpsMeter.fps}`,`Keys pressed: ${Array.from(this._keys).join(",")}`,`Entities: ${this._entityManager._entities.length}`,`Bodies: ${this._world._bodies.length}`,`${this._drawCounter} objects drawn of total ${this._drawable.length}`,`Camera: x = ${this.camera.position.x.toFixed(2)}, y = ${this.camera.position.y.toFixed(2)}, z = ${this.camera.scale.toFixed(2)}`];t.beginPath(),t.font=l+"px Arial",t.fillStyle=f,t.fillRect(s,n,Math.max(Math.max(...v.map(w=>t.measureText(w).width))+h*2,r),Math.max(v.length*(l+u)+h*2,a)),t.textBaseline="top",t.fillStyle=_;for(let w=0;w<v.length;++w)t.fillText(v[w],s+h,n+h+w*(l+u))}};var dt=class{_resources;_bgmusic;_effects;constructor(t){this._resources=t,this._effects=new Ht(this._resources),this._bgmusic=new zt(this._resources)}get bgmusic(){return this._bgmusic}get effects(){return this._effects}},zt=class{_resources;_audio=null;_volume=1;_speed=1;_loop=!1;constructor(t){this._resources=t}get volume(){return this._volume}set volume(t){let e=y.sat(t);this._volume=e,this._set()}get speed(){return this._speed}set speed(t){t>0&&(this._speed=t,this._set())}get loop(){return this._loop}set loop(t){this._loop=t,this._set()}get time(){return this._audio?this._audio.currentTime:0}set time(t){this._audio&&(this._audio.currentTime=y.clamp(t,0,this._audio.duration))}get paused(){return this._audio?this._audio.paused:!0}set(t){this._audio=this._resources.get(t).cloneNode(!0),this._set()}play(){this._audio&&this._audio.play()}pause(){this._audio&&this._audio.pause()}_set(){this._audio&&(this._audio.volume=this._volume,this._audio.playbackRate=this._speed,this._audio.loop=this._loop)}},Ht=class{_resources;_volume=1;_arr=[];constructor(t){this._resources=t}get volume(){return this._volume}set volume(t){let e=y.sat(t);this._volume=t;for(let i of this._arr)i.volume=this._volume}play(t,e){let i=c.parseValue(e.speed,1),s=this._resources.get(t).cloneNode(!0);s.addEventListener("ended",()=>{let n=this._arr.indexOf(s);n!=-1&&this._arr.splice(n,1)}),s.volume=this._volume,s.playbackRate=i,this._arr.push(s),s.play()}};var ut=class{_resources=null;_config;_width;_height;_init;_preload;_parentElement;_renderer;_load=new E;_sceneManager=new Z;_engine;_timeout=new W;_audio=null;constructor(t){this._config=t,this._width=t.width,this._height=t.height,this._init=t.init.bind(this);let e;(e=c.parseValue(t.preload,null))!==null&&(this._preload=e.bind(this)),this._parentElement=c.parseValue(t.parentElement,document.body);let i=this._parentElement;i.style.WebkitUserSelect="none",i.style.userSelect="none",i.style.touchAction="none",this._renderer=new K(this._width,this._height,this._parentElement);let s=n=>{this._timeout.update(n);let r=this._sceneManager.scenes;for(let a of r)a.update(n*.001);this._renderer.render(r)};this._engine=new G(s),this._initEventListeners(),this._initControls(),this._engine.start(),this._preload?(this._preload(),this._load.load(n=>{this._resources=n,this._audio=new dt(this._resources),this._init()})):this._init()}get load(){return this._load}get resources(){return this._resources}get timeout(){return this._timeout}get audio(){return this._audio}createScene(t,e,i){let s=new lt(i);return s._game=this,this._sceneManager.add(s,t,e),s}requestFullScreen(){let t=this._parentElement,e=t.requestFullScreen||t.webkitRequestFullScreen;e&&e.call(t)}_initEventListeners(){let t="ontouchstart"in document,e=this._renderer.canvas;t?(e.addEventListener("touchstart",i=>this._handleTouchEvent(i)),e.addEventListener("touchmove",i=>this._handleTouchEvent(i)),e.addEventListener("touchend",i=>this._handleTouchEvent(i))):(e.addEventListener("mousedown",i=>this._handleMouseEvent(i)),e.addEventListener("mousemove",i=>this._handleMouseEvent(i)),e.addEventListener("mouseup",i=>this._handleMouseEvent(i))),addEventListener("keydown",i=>this._handleKeyEvent(i)),addEventListener("keyup",i=>this._handleKeyEvent(i))}_handleKeyEvent(t){t.preventDefault(),this._handleSceneEvent(t.type,{key:t.key})}_handleTouchEvent(t){t.preventDefault();let e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};this._handleSceneEvent(e[t.type],{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY})}_handleMouseEvent(t){t.preventDefault(),this._handleSceneEvent(t.type,{x:t.pageX,y:t.pageY})}_handleSceneEvent(t,e){for(let i of this._sceneManager.scenes){let s=Object.assign({},e);if(t.startsWith("mouse")){let n=this._renderer.displayToSceneCoords(i,s.x,s.y);s.x=n.x,s.y=n.y}if(i.handleEvent(t,s,this._renderer))break}}_initControls(){let t=c.parseObject(this._config.controls,{active:!1,theme:"dark",layout:{DPad:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},X_Button:"e",Y_Button:"d",A_Button:"s",B_Button:"f",L_Button:"Control",R_Button:"Control",START_Button:" ",SELECT_Button:"Tab"}});if(!t.active||!("ontouchstart"in document))return;let e,i;switch(t.theme){case"light":e="black",i="white";break;default:e="white",i="black"}let s=t.layout,n=(g,p=!0)=>{g.style.pointerEvents="auto",g.style.position="absolute",g.style.border="2px solid "+e,g.style.color=e,g.style.fontFamily="Arial",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",p&&(g.style.background=i)},r=(g,p,x)=>{let m=document.createElement("div");return m.style.width="46px",m.style.height="46px",m.style.right=g-5+"px",m.style.bottom=p+10+"px",m.textContent=x,m.style.borderRadius="50%",m.style.fontSize="22px",n(m),l.appendChild(m),m},a=g=>{let p=document.createElement("div");return p.style.width="46px",p.style.height="46px",p.style.bottom=190+"px",p.style.fontSize="22px",g=="left"?(p.style.left=5+"px",p.textContent="L",p.style.borderRadius="50% 0 0 50%"):g=="right"&&(p.style.right=5+"px",p.textContent="R",p.style.borderRadius="0 50% 50% 0"),n(p),l.appendChild(p),p},h=g=>{let p=document.createElement("div");return p.style.width="50px",p.style.height="22px",g=="Start"?p.style.left="calc(50% + "+3+"px)":g=="Select"&&(p.style.right="calc(50% + "+3+"px)"),p.style.bottom=20+"px",p.textContent=g,p.style.borderRadius="12px",p.style.fontSize="12px",p.style.fontWeight="bolder",n(p),l.appendChild(p),p},l=document.createElement("div");l.style.width="100%",l.style.height="100%",l.style.left="0",l.style.top="0",l.style.zIndex="999",l.style.position="absolute",l.style.pointerEvents="none";let u={},_=document.createElement("div");_.style.width="120px",_.style.height="120px",_.style.left="10px",_.style.bottom="50px",_.style.borderRadius="50%",_.style.overflow="hidden",n(_),l.appendChild(_);for(let g=0;g<4;++g){let p=document.createElement("div");p.style.width="120px",p.style.height="120px",p.style.left=-75+150*(g%2)+"px",p.style.top=-75+150*Math.floor(g/2)+"px",n(p,!1),_.appendChild(p)}u.DPad=_,u.A_Button=r(10,63,"A"),u.B_Button=r(63,10,"B"),u.X_Button=r(63,116,"X"),u.Y_Button=r(116,63,"Y"),u.L_Button=a("left"),u.R_Button=a("right"),u.SELECT_Button=h("Select",-20),u.START_Button=h("Start",20),this._parentElement.appendChild(l);let f={left:{v:new d(-1,0),n:"left"},right:{v:new d(1,0),n:"right"},up:{v:new d(0,-1),n:"up"},down:{v:new d(0,1),n:"down"}},v=g=>{let p=_.getBoundingClientRect(),x=g.changedTouches[0].pageX-(p.x+p.width/2),m=g.changedTouches[0].pageY-(p.y+p.height/2),k=new d(x,m);if(k.mag()<20)return[];let A=k.clone().unit(),B=[];return d.dot(A,f.left.v)>=.5&&B.push(f.left.n),d.dot(A,f.right.v)>=.5&&B.push(f.right.n),d.dot(A,f.up.v)>=.5&&B.push(f.up.n),d.dot(A,f.down.v)>=.5&&B.push(f.down.n),B},w=(g,p,x)=>{for(let m of p)this._handleSceneEvent(g,{key:x[m]})};for(let g in u){let p=u[g],x=s[g];if(g=="DPad"){p.addEventListener("touchstart",m=>{m.preventDefault();let k=v(m);w("keydown",k,x)}),p.addEventListener("touchmove",m=>{m.preventDefault(),w("keyup",["left","right","up","down"],x);let k=v(m);w("keydown",k,x)}),p.addEventListener("touchend",m=>{m.preventDefault();let k=v(m);w("keyup",["left","right","up","down"],x)});continue}p.addEventListener("touchstart",m=>{m.preventDefault(),this._handleSceneEvent("keydown",{key:x})}),p.addEventListener("touchmove",m=>{m.preventDefault(),this._handleSceneEvent("keydown",{key:x})}),p.addEventListener("touchend",m=>{m.preventDefault(),this._handleSceneEvent("keyup",{key:x})})}}};var ct={};N(ct,{Color:()=>P,LevelMaker:()=>_t,Loader:()=>E,QuadTree:()=>V,Tileset:()=>H,TimeoutHandler:()=>W,Vector:()=>d,math:()=>y,paramParser:()=>c});var L=class extends M{_zIndex;_opacity;_fillColor;_strokeColor;_strokeWidth;_visible=!0;constructor(t={}){super();this._type="drawable",this._zIndex=c.parseValue(t.zIndex,0),this._opacity=new j(c.parseValue(t.opacity,1)),this._fillColor=new P(c.parseValue(t.fillColor,"white")),this._strokeColor=new P(t.strokeColor),this._strokeWidth=c.parseValue(t.strokeWidth,1),this._strokeCap=c.parseValue(t.strokeCap,"butt"),this._shadowColor=new P(c.parseValue(t.shadowColor,"transparent")),this._shadow=c.parseObject(t.shadow,{x:0,y:0})}get visible(){return this._visible}set visible(t){this._visible=t}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.scene&&(this.scene.removeDrawable(this),this.scene.addDrawable(this))}get opacity(){return this._opacity.value}set opacity(t){this._opacity.value=y.sat(t)}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=Math.max(t,0)}get fillColor(){return this._fillColor._color}set fillColor(t){this._fillColor.set(t)}get shadowColor(){return this._shadowColor._color}set shadowColor(t){this._shadowColor.set(t)}get shadow(){return this._shadow}get strokeColor(){return this._strokeColor._color}set strokeColor(t){this._strokeColor.set(t)}fade(t,e,i="linear",s=null){this._opacity.animate(t,e,i,s)}getBoundingBox(){return{x:0,y:0,width:0,height:0}}initComponent(){this.scene.addDrawable(this)}drawInternal(t){!this.visible||(t.save(),this.shadowColor!="transparent"&&(this.shadow.x!=0||this.shadow.y!=0)&&(t.save(),t.translate(this.shadow.x,this.shadow.y),this.drawShadow(t),t.restore()),this.draw(t),t.restore())}draw(t){}drawShadow(t){}update(t){this._opacity.update(t)}},C=class extends L{_flip;_scale;_image=null;_imageOptions=null;_center=new d;_width;_height;_imageParams=null;_shaker=new O;constructor(t={}){super(t);this._imageParams=c.parseValue(t.image,null);let e=c.parseObject(t.scale,{x:1,y:1});this._scale={x:new j(e.x),y:new j(e.y)},this._width=c.parseValue(t.width,0),this._height=c.parseValue(t.height,0)}get width(){return this._width}set width(t){this._width=Math.max(t,0)}get height(){return this._height}set height(t){this._height=Math.max(t,0)}get scale(){return{x:this._scale.x.value,y:this._scale.y.value}}set scale(t){let e=c.parseObject(t,{x:this._scale.x.value,y:this._scale.y.value});this._scale.x.value=e.x,this._scale.y.value=e.y}get center(){return this._center}set center(t){this._center.copy(t)}get shaker(){return this._shaker}scaleTo(t,e,i="linear",s=null){let n=c.parseObject(t,{x:this._scale.x.value,y:this._scale.y.value});this._scale.x.value!=n.x&&this._scale.x.animate(n.x,e,i,s),this._scale.y.value!=n.y&&this._scale.y.animate(n.y,e,i,s)}initComponent(){super.initComponent(),this._imageParams!==null&&(this._image=this.scene.resources.get(this._imageParams.name),this._imageOptions=c.parseObject(this._imageParams,{width:this._image.width,height:this._image.height,frameWidth:this._image.width,frameHeight:this._image.height,framePosition:{x:0,y:0}}))}getBoundingBox(){let t=Math.hypot(this._width,this._height);return{width:t*Math.abs(this.scale.x),height:t*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}drawInternal(t){!this.visible||(t.save(),t.translate(this.position.x+this._shaker.offset.x,this.position.y+this._shaker.offset.y),this.shadowColor!="transparent"&&(this.shadow.x!=0||this.shadow.y!=0)&&(t.save(),t.translate(this.shadow.x,this.shadow.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.angle),t.translate(-this._center.x,-this._center.y),this.drawShadow(t),t.restore()),t.scale(this.scale.x,this.scale.y),t.rotate(this.angle),t.translate(-this._center.x,-this._center.y),this.draw(t),t.restore())}drawImage(t,e={}){if(this._image==null)return;let i=c.parseObject(e,{clip:!0,framePosition:this._imageOptions.framePosition,width:this._imageOptions.width,height:this._imageOptions.height});i.clip&&t.clip(),t.drawImage(this._image,i.framePosition.x*this._imageOptions.frameWidth,i.framePosition.y*this._imageOptions.frameHeight,this._imageOptions.frameWidth,this._imageOptions.frameHeight,-i.width/2,-i.height/2,i.width,i.height)}update(t){super.update(t),this._scale.x.update(t),this._scale.y.update(t),this._shaker.update(t),this._angle.update(t)}followBody(){!this.parent.body||this.parent.addComponent(new Ft({target:this}))}setSize(t,e){this._width=t,this._height=e}},Ft=class extends M{constructor(t){super();this._target=t.target}update(t){let e=this.parent.body;this._target.angle=e.angle,this._target.offset=e.offset}};var I=class extends C{constructor(t){super(t)}draw(t){t.globalAlpha=this.opacity,this.drawImage(t,{clip:!1,width:this._width,height:this._height})}drawShadow(t){this._shadowColor.fill(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill()}};var z=class extends C{_anims=new Map;_currentAnim=null;_paused=!0;_framePos={x:0,y:0};constructor(t){super(t)}get currentAnim(){return this._currentAnim?this._currentAnim.name:null}addAnim(t,e){this._anims.set(t,e)}play(t,e,i,s){if(t==null){this._currentAnim&&(this._paused=!1);return}if(this.currentAnim==t)return;this._paused=!1;let n={name:t,rate:e,repeat:i,OnEnd:s,frame:0,counter:0};this._currentAnim=n,this._framePos=this._anims.get(n.name)[n.frame]}reset(){this._currentAnim&&(this._currentAnim.frame=0,this._currentAnim.counter=0)}pause(){this._paused=!0}update(t){if(super.update(t),this._paused)return;let e=this._currentAnim,i=this._anims.get(e.name);e.counter+=t*1e3,e.counter>=e.rate&&(e.counter=0,++e.frame,e.frame>=i.length&&(e.frame=0,e.OnEnd&&e.onEnd(),e.repeat||(this._currentAnim=null,this._paused=!0)),this._framePos=i[e.frame])}draw(t){t.globalAlpha=this.opacity,this.drawImage(t,{clip:!1,width:this._width,height:this._height,framePosition:this._framePos})}drawShadow(t){this._shadowColor.fill(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill()}};var H=class{constructor(t){this._image=t.image,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight,this._columns=t.columns,this._tileCount=t.tileCount,this._tileData=[]}get image(){return this._image}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get columns(){return this._columns}get tileCount(){return this._tileCount}createTile(t,e){let i=this._getData(e),s=t.createEntity(),n;i&&i.animation?(n=new z({image:{name:this._image,frameWidth:this._tileWidth,frameHeight:this._tileHeight}}),n.addAnim("loop",i.animation.frames.map(a=>this._getPos(a))),n.play("loop",i.animation.frameRate,!0)):n=new I({image:{name:this._image,frameWidth:this._tileWidth,frameHeight:this._tileHeight,framePosition:this._getPos(e)}}),s.addComponent(n,"TileSprite");let r=new Map;for(let a of i==null?[]:i.properties)r.set(a.name,a.value);return s.props.set("tile-data",r),s}addAnim(t,e,i){let s=this._getData(t);s||(s=this._createData(t)),s.animation={frameRate:e,frames:i}}addProp(t,e,i){let s=this._getData(t);s||(s=this._createData(t)),s.properties.push({name:e,value:i})}_getPos(t){return{x:t%this._columns,y:Math.floor(t/this._columns)}}_createData(t){let e={id:t,properties:[]};return this._tileData.push(e),e}_getData(t){return this._tileData.find(e=>e.id==t)}static loadFromTiledJSON(t,e){let i=new H({image:e,tileWidth:t.tilewidth,tileHeight:t.tileheight,columns:t.columns,tileCount:t.tilecount});if(t.tiles)for(let s of t.tiles){let n=s.id;if(s.properties)for(let r of s.properties)i.addProp(n,r.name,r.value);if(s.animation){let r=[];for(let a of s.animation)r.push(a.tileid);i.addAnim(n,s.animation[0].duration,r)}}return i}};var _t=class{_tileWidth;_tileHeight;_onTile=null;_onObject=null;constructor(t){this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight}get tileWidth(){return this._tileWidth}set tileWidth(t){this._tileWidth=t}get tileHeight(){return this._tileHeight}set tileHeight(t){this._tileHeight=t}onTile(t){this._onTile=t}onObject(t){this._onObject=t}createLevel(t,e,i){let s=a=>{let h=-1,l=0;for(let u=0;u<i.length;++u){if(a<l+i[u].tileCount){h=u;break}l+=i[u].tileCount}return h==-1?null:i[h].createTile(t,a-l)},n=(a,h)=>{for(let l=0;l<a.data.length;++l){let u=a.data[l]-1,_=l%e.width,f=Math.floor(l/e.width);if(u==-1)continue;let v=s(u);if(v===null)return;v.position.set((_+.5)*this._tileWidth,(f+.5)*this._tileHeight);let w=v.getComponent("TileSprite");w.setSize(this._tileWidth,this._tileHeight),w.zIndex=h,this._onTile&&this._onTile(v)}},r=(a,h)=>{for(let l of a.objects){let u={name:l.name,type:l.type,x:l.x/e.tilewidth*this._tileWidth,y:l.y/e.tileheight*this._tileHeight,width:l.width===void 0?0:l.width/e.tilewidth*this._tileWidth,height:l.height===void 0?0:l.height/e.tileheight*this._tileHeight},_;if(l.gid!==void 0){_=s(l.gid-1),_.position.set(u.x+u.width/2,u.y-u.height/2);let f=_.getComponent("TileSprite");f.setSize(u.width,u.height),f.zIndex=h}else _=t.createEntity(),_.position.set(u.x,u.y);this._onObject&&this._onObject(_,u)}};for(let a=0;a<e.layers.length;++a){let h=e.layers[a],l=a;switch(h.type){case"tilelayer":n(h,l);break;case"objectgroup":r(h,l);break}}}};var bt={};N(bt,{Circle:()=>yt,Drawable:()=>L,FixedDrawable:()=>C,Line:()=>mt,Path:()=>vt,Picture:()=>I,Polygon:()=>F,Rect:()=>pt,RegularPolygon:()=>ft,RoundedRect:()=>gt,Sprite:()=>z,Text:()=>wt});var pt=class extends C{constructor(t){super(t)}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill(),this._strokeWidth!=0&&t.stroke(),this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var F=class extends C{_points;constructor(t){super(t);this._points=c.parseValue(t.points,[])}getBoundingBox(){let t=this._points,e=0,i=0;for(let n=0;n<t.length;++n){let r=t[n],a=r.length,h=Math.hypot(r[a-2],r[a-1]);h>e&&(e=h,i=n)}let s=e*2;return{width:s*Math.abs(this.scale.x),height:s*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath();for(let e=0;e<=this._points.length;++e){let i=this._points[e%this._points.length];if(e==0){let s=i.length;t.moveTo(i[s-2],i[s-1])}else i.length==6?t.bezierCurveTo(...i):i.length==4?t.quadraticCurveTo(...i):t.lineTo(...i)}t.closePath(),t.fill(),this._strokeWidth!=0&&t.stroke(),this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath();for(let e=0;e<=this._points.length;++e){let i=this._points[e%this._points.length];if(e==0){let s=i.length;t.moveTo(i[s-2],i[s-1])}else i.length==6?t.bezierCurveTo(...i):i.length==4?t.quadraticCurveTo(...i):t.lineTo(...i)}t.closePath(),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}},ft=class extends F{_radius;_sides;constructor(t){super(t);this._radius=t.radius,this._sides=t.sides,this._initPoints()}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._initPoints()}get sides(){return this._sides}set sides(t){this._sides=Math.max(t,3),this._initPoints()}_initPoints(){let t=[];for(let e=0;e<this.sides;++e){let i=Math.PI*2/this.sides*e;t.push([Math.cos(i)*this.radius,Math.sin(i)*this.radius])}this._points=t}getBoundingBox(){return{width:this._radius*2*Math.abs(this.scale.x),height:this._radius*2*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}},gt=class extends F{_borderRadius;constructor(t){super(t);this._borderRadius=t.borderRadius,this._initPoints()}get width(){return this._width}set width(t){this._width=t,this._initPoints()}get height(){return this._height}set height(t){this._height=t,this._initPoints()}get borderRadius(){return this._borderRadius}set borderRadius(t){this._borderRadius=t,this._initPoints()}_initPoints(){let t=this._width,e=this._height,i=this._borderRadius;this._points=[[-t/2,-(e/2-i)],[-t/2,-e/2,-(t/2-i),-e/2],[t/2-i,-e/2],[t/2,-e/2,t/2,-(e/2-i)],[t/2,e/2-i],[t/2,e/2,t/2-i,e/2],[-(t/2-i),e/2],[-t/2,e/2,-t/2,e/2-i]]}};var mt=class extends C{_length;constructor(t){super(t);this._length=t.length}get length(){return this._length}set length(t){this._length=Math.max(t,0)}getGoundingBox(){let t=d.fromAngle(this._angle).mult(this._length/2);return{width:this._length*Math.abs(this.scale.x),height:this._length*Math.abs(this.scale.y),x:t.x,y:t.y}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._strokeColor.stroke(t),t.beginPath(),t.moveTo(0,0),t.lineTo(this._length,0),t.stroke()}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.stroke(t),t.beginPath(),t.moveTo(0,0),t.lineTo(this._length,0),t.stroke()}};var yt=class extends C{_radius;constructor(t){super(t);this._radius=t.radius}get radius(){return this._radius}set radius(t){this._radius=t}getBoundingBox(){return{width:this._radius*2*Math.abs(this.scale.x),height:this._radius*2*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath(),t.arc(0,0,this._radius,0,2*Math.PI),t.fill(),this.strokeWidth!=0&&t.stroke(),this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath(),t.arc(0,0,this._radius,0,2*Math.PI),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var wt=class extends C{_text;_lines;_padding;_align;_fontFamily;_fontSize;_fontStyle;constructor(t){super(t);this._text=c.parseValue(t.text,""),this._lines=this._text.split(/\n/),this._padding=c.parseValue(t.padding,0),this._align=c.parseValue(t.align,"center"),this._fontSize=c.parseValue(t.fontSize,16),this._fontFamily=c.parseValue(t.fontFamily,"Arial"),this._fontStyle=c.parseValue(t.fontStyle,"normal"),this._computeDimensions()}get linesCount(){return this._lines.length}get lineHeight(){return this._fontSize+this._padding*2}get text(){return this._text}set text(t){this._text=t,this._lines=this._text.split(/\n/),this._computeDimensions()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=Math.max(t,0),this._computeDimensions()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this._computeDimensions()}get padding(){return this._padding}set padding(t){this._padding=t,this._computeDimensions()}get align(){return this._align}set align(t){this._align=t,this._computeDimensions()}_computeDimensions(){this._height=this.lineHeight*this.linesCount;let t=0,e=document.createElement("canvas").getContext("2d");e.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`;for(let i of this._lines){let s=e.measureText(i).width;s>t&&(t=s)}this._width=t+this._padding*2}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`,t.textAlign=this._align,t.textBaseline="middle",t.beginPath();for(let e=0;e<this.linesCount;++e)t.fillText(this._lines[e],this._padding,this.lineHeight*e-(this.linesCount-1)/2*this.lineHeight),this._strokeWidth&&t.strokeText(this._lines[e],this._padding,this.lineHeight*e-(this.linesCount-1)/2*this.lineHeight)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t);let e=this._align=="left"?-this._width/2:this._align=="right"?this._width/2:0;t.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`,t.textAlign=this._align,t.textBaseline="middle",t.beginPath();for(let i=0;i<this.linesCount;++i)this.fillColor!="transparent"&&t.fillText(this._lines[i],e+this._padding,this.lineHeight*i-(this.linesCount-1)/2*this.lineHeight),this._strokeWidth&&t.strokeText(this._lines[i],e+this._padding,this.lineHeight*i-(this.linesCount-1)/2*this.lineHeight)}};var vt=class extends L{_points;constructor(t){super(t);this._points=t.points}getBoundingBox(){let t=this._points,e=1/0,i=-1/0,s=1/0,n=-1/0;for(let r=0;r<t.length;++r){let a=t[r],h=a.length,l=a[h-2],u=a[h-1];l<e?e=l:l>i&&(i=l),u<s?s=u:u>n&&(n=u)}return{width:Math.abs(i-e),height:Math.abs(n-s),x:(i+e)/2,y:(n+s)/2}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath();for(let e=0;e<=this._points.length;++e){let i=this._points[e%this._points.length];if(e==0){let s=i.length;t.moveTo(i[s-2],i[s-1])}else i.length==6?t.bezierCurveTo(...i):i.length==4?t.quadraticCurveTo(...i):t.lineTo(...i)}t.closePath(),t.fill(),this._strokeWidth!=0&&t.stroke(),this._image&&this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath();for(let e=0;e<=this._points.length;++e){let i=this._points[e%this._points.length];if(e==0){let s=i.length;t.moveTo(i[s-2],i[s-1])}else i.length==6?t.bezierCurveTo(...i):i.length==4?t.quadraticCurveTo(...i):t.lineTo(...i)}t.closePath(),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var xt={};N(xt,{Ball:()=>S,Box:()=>st,Polygon:()=>b,Ray:()=>R,RegularPolygon:()=>ot});var Mt={};N(Mt,{RadialLight:()=>kt});var Ct=class extends M{_color;_scale;constructor(t){super();this._type="light",this._color=new P(t.color),this._scale=new j(c.parseValue(t.scale,1))}get color(){return this._color._color}set color(t){this._color.set(t)}get scale(){return this._scale.value}set scale(t){this._scale.value=t}scaleTo(t,e,i="linear",s=null){this._scale.animate(t,e,i,s)}initComponent(){this.scene.addLight(this)}drawInternal(t){t.save(),t.translate(this.position.x,this.position.y),t.scale(this.scale,this.scale),t.rotate(this.angle),this.draw(t),t.restore()}draw(t){}update(t){this._scale.update(t),this._angle.update(t)}};var kt=class extends Ct{_radius;_angleRange;constructor(t){super(t);this._radius=t.radius,this._angleRange=c.parseValue(t.angleRange,Math.PI*2)}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0)}get angleRange(){return this._angleRange}set angleRange(t){this._angleRange=y.clamp(t,0,Math.PI*2)}draw(t){this._color.fill(t),t.beginPath(),t.arc(0,0,this.radius,-this.angleRange/2,this.angleRange/2),t.lineTo(0,0),t.closePath(),t.fill()}};var qt="Lancelot",U={Game:ut,Component:M,utils:ct,drawable:bt,physics:xt,light:Mt};if(typeof module=="object"&&typeof module.exports=="object")module.exports=U;else if(typeof define=="function"&&define.amd)define(qt,[],U);else{let o=typeof globalThis!="undefined"?globalThis:self;o[qt]=U}var Es=U;export{Es as default};
