var At=Object.defineProperty;var Qt=n=>At(n,"__esModule",{value:!0});var F=(n,t)=>{Qt(n);for(var i in t)At(n,i,{get:t[i],enumerable:!0})};var E=class{_toLoad=[];_size=0;_counter=0;_path="";_onProgressHandler=null;_add(t,i,s){let o;i.startsWith("/")?o=this._path+i.slice(1):o=this._path+i,this._toLoad.push({name:t,path:o,type:s}),++this._size}image(t,i){this._add(t,i,"image")}audio(t,i){this._add(t,i,"audio")}json(t,i){this._add(t,i,"json")}font(t,i){this._add(t,i,"font")}onProgress(t){this._onProgressHandler=t}setPath(t){this._path=t,this._path.endsWith("/")||(this._path+="/")}load(t){let i=new Map;if(this._size===0){t(i);return}for(let s of this._toLoad)switch(s.type){case"image":E.loadImage(s.path,o=>{this._handleCallback(i,s,o,t)});break;case"audio":E.loadAudio(s.path,o=>{this._handleCallback(i,s,o,t)});break;case"json":E.loadJSON(s.path,o=>{this._handleCallback(i,s,o,t)});break;case"font":E.loadFont(s.name,s.path,o=>{this._handleCallback(i,s,o,t)})}}_handleCallback(t,i,s,o){t.set(i.name,s),++this._counter,this._onProgressHandler&&this._onProgressHandler(this._counter/this._size,i.path),this._counter===this._size&&(this._counter=this._size=0,this._toLoad=[],o(t))}static loadImage(t,i){let s=new Image;s.src=t,s.addEventListener("load",()=>{i(s)},{once:!0})}static loadAudio(t,i){let s=new Audio(t);s.load(),s.addEventListener("canplaythrough",()=>{i(s)},{once:!0})}static loadJSON(t,i){fetch(t).then(s=>s.json()).then(s=>i(s))}static loadFont(t,i,s){new FontFace(t,`url(${i})`).load().then(r=>{document.fonts.add(r),s(t)})}};var u=function(){return{parseValue(n,t){return n!==void 0&&(typeof n==typeof t||t===null)?n:t},parseObject(n,t){if(n)for(let i in t)t[i]=typeof t[i]=="object"&&!Array.isArray(t[i])&&t[i]!==null?this.parseObject(n[i],t[i]):this.parseValue(n[i],t[i]),typeof t[i]=="object"&&!Array.isArray(t[i])&&t[i]!==null?t[i].min!==void 0&&t[i].max!==void 0?t[i]=this.parseMinMax(n[i],t[i]):t[i]=this.parseObject(n[i],t[i]):t[i]=this.parseValue(n[i],t[i]);return t},parseMinMax(n,t){if(n===void 0)return t;if(typeof n=="number")return{min:n,max:n};if(typeof n=="object"&&!Array.isArray(n)&&n!==null){let i,s;if(typeof n.min=="number"&&n.min<=t.max?i=n.min:i=t.min,typeof n.max=="number"&&n.max>=t.min?s=n.max:s=t.max,i<=s)return{min:i,max:s}}return t}}}();var B=class{_timeouts=[];set(t,i){let s={action:t,dur:i,counter:0};return this._timeouts.push(s),s}clear(t){let i=this._timeouts.indexOf(t);i!=-1&&this._timeouts.splice(i,1)}update(t){for(let i=0;i<this._timeouts.length;++i){let s=this._timeouts[i];(s.counter+=t)>=s.dur&&(s.action(),this._timeouts.splice(i--,1))}}};var Y=class{_paused=!0;_step;constructor(t){this._step=t}get paused(){return this._paused}_RAF(){this._frame=window.requestAnimationFrame(t=>{this._paused||this._RAF();let i=Math.min(t-this._previousRAF,1e3/30);this._step(i),this._previousRAF=t})}start(){this._paused=!1,this._previousRAF=performance.now(),this._RAF()}stop(){this._paused=!0,window.cancelAnimationFrame(this._frame)}};var U=class{_width;_height;_aspect;_scale;_parentElement;_container;_canvas;_context;constructor(t,i,s=document.body){this._width=t,this._height=i,this._parentElement=s,this._aspect=this._width/this._height,this._scale=1,this._buffers=[];for(let o=0;o<5;++o){let r=document.createElement("canvas").getContext("2d");r.canvas.width=this._width,r.canvas.height=this._height,r.imageSmoothingEnabled=!1,this._buffers[o]=r}this._initContainer(),this._initCanvas(),this._onResize(),window.addEventListener("resize",()=>this._onResize())}get canvas(){return this._canvas}render(t){let i=this._context;i.beginPath(),i.clearRect(0,0,this._width,this._height);let s=(o,r,a)=>{let h=t[r];if(!h)return;if(h.hidden){s(o,r+1,a);return}let l=this._width,_=this._height;if(h.drawLights(o,l,_),!this._buffers[a]){let f=document.createElement("canvas").getContext("2d");f.canvas.width=l,f.canvas.height=_,this._buffers[a]=f}let p=this._buffers[a];r<t.length-1&&(s(p,r+1,a+1),p.globalCompositeOperation="source-over"),h.drawObjects(p,l,_),o.drawImage(p.canvas,0,0)};s(i,0,0)}displayToSceneCoords(t,i,s){let o=this._canvas.getBoundingClientRect(),r=(i-o.x)/this._scale,a=(s-o.y)/this._scale,h=t.camera;return{x:(r-this._width/2)/h.scale+h.position.x,y:(a-this._height/2)/h.scale+h.position.y}}_initContainer(){let t=this._container=document.createElement("div");t.style.width=this._width+"px",t.style.height=this._height+"px",t.style.position="relative",t.style.left="50%",t.style.top="0%",t.style.transformOrigin="center",this._parentElement.appendChild(t)}_initCanvas(){let t=this._canvas=document.createElement("canvas");t.width=this._width,t.height=this._height,this._context=t.getContext("2d"),t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.display="block",t.style.background="black",this._container.appendChild(t)}_onResize(){let[t,i]=[this._parentElement.clientWidth,this._parentElement.clientHeight];t/i>this._aspect?this._scale=i/this._height:this._scale=t/this._width,this._container.style.transform="translate(-50%, calc(-50% + "+this._height/2*this._scale+"px)) scale("+this._scale+")",this._context.imageSmoothingEnabled=!1}};var G=class{_scenes=[];get scenes(){return this._scenes.map(t=>t.scene)}add(t,i,s=0){let o={scene:t,name:i,zIndex:s};this._scenes.push(o);for(let r=this._scenes.length-1;r>0&&!(o.zIndex<this._scenes[r-1].zIndex);--r)[this._scenes[r],this._scenes[r-1]]=[this._scenes[r-1],this._scenes[r]]}get(t){return this._scenes.find(i=>i.name==t).scene}setZIndex(t,i){let s=this.get(t);s&&(this.remove(t),this.add(s,t,i))}remove(t){let i=this._scenes.findIndex(s=>s.name==t);return i!=-1?(this._scenes.splice(i,1),!0):!1}};var d=class{_x;_y;constructor(t=0,i=0){this._x=t,this._y=i}get x(){return this._x}get y(){return this._y}set x(t){this.set(t,this.y)}set y(t){this.set(this.x,t)}set(t,i){this._x=t,this._y=i}copy(t){return this.set(t.x,t.y),this}clone(){return new d(this.x,this.y)}add(t){return this.set(this.x+t.x,this.y+t.y),this}sub(t){return this.set(this.x-t.x,this.y-t.y),this}mult(t){return this.set(this.x*t,this.y*t),this}norm(){return this.set(this.y,-this.x),this}unit(){let t=this.mag();return t===0?this:(this.set(this.x/t,this.y/t),this)}mag(){return Math.hypot(this.x,this.y)}lerp(t,i){return this.add(t.clone().sub(this).mult(i))}angle(){return Math.atan2(this.y,this.x)}rot(t){let i=Math.sin(t),s=Math.cos(t),o=this.x*s-this.y*i,r=this.x*i+this.y*s;return this.set(o,r),this}static fromAngle(t){return new d(1,0).rot(t)}static dot(t,i){return t.x*i.x+t.y*i.y}static dist(t,i){return t.clone().sub(i).mag()}static cross(t,i){return t.x*i.y-t.y*i.x}static angleBetween(t,i){let s=t.mag(),o=i.mag();return s===0||o===0?0:Math.acos(d.dot(t,i)/(s*o))}},q=class extends d{_onChangeCallback;constructor(t,i=0,s=0){super(i,s);this._onChangeCallback=t}set(t,i){(t!=this.x||i!=this.y)&&(this._x=t,this._y=i,this._onChangeCallback())}};var y=function(){return{rand(n,t){return Math.random()*(t-n)+n},randint(n,t){return Math.floor(Math.random()*(t-n+1)+n)},lerp(n,t,i){return t+(i-t)*n},clamp(n,t,i){return Math.min(Math.max(n,t),i)},isBetween(n,t,i){return n>=t&&n<=i},sat(n){return this.clamp(n,0,1)},ease(n,t){return this.sat(n**t)},easeIn(n){return this.ease(n,2.4)},easeOut(n){return this.ease(n,.4)},choice(n){let t=n.length;return n[this.randint(0,t-1)]},shuffle(n){let t=n.length;for(let i=0;i<t;++i){let s=this.randint(0,t-1);[n[i],n[s]]=[n[s],n[i]]}}}}();var j=class{_value;_anim=null;constructor(t){this._value=t}get value(){return this._value}set value(t){this._value=t}animate(t,i,s="linear",o=null){this._anim={counter:0,dur:i,from:this._value,to:t,timing:s,onEnd:o}}isAnimating(){return this._anim!==null}stopAnimating(){this._anim=null}update(t){if(this._anim){let i=this._anim;i.counter+=t*1e3;let s=y.sat(i.counter/i.dur),o;switch(i.timing){case"linear":o=s;break;case"ease-in":o=y.easeIn(s);break;case"ease-out":o=y.easeOut(s);break}this._value=y.lerp(o,i.from,i.to),s==1&&(this.stopAnimating(),i.onEnd&&i.onEnd())}}};var D=class{_pos;_parent=null;_fixed=!1;_offset;_attached=[];_anim=null;constructor(){this._pos=new q(this._onPositionChange.bind(this)),this._offset=new q(this._onOffsetChange.bind(this))}get position(){return this._pos}set position(t){this._pos.copy(t)}get offset(){return this._offset}set offset(t){this._offset.copy(t)}clip(t,i=!1){this._attached.push(t),t._parent=this,t._fixed=i,t._offset.copy(t.position.clone().sub(this._pos))}unclip(t){let i=this._attached.indexOf(t);i!=-1&&(this._attached.splice(i,1),t._parent=null)}moveTo(t,i,s="linear",o=null){this._anim={counter:0,dur:i,from:this.position.clone(),to:t,timing:s,onEnd:o}}stopMoving(){this._anim=null}isMoving(){return this._anim!=null}update(t){if(this._anim){let i=this._anim;i.counter+=t*1e3;let s=y.sat(i.counter/i.dur),o;switch(i.timing){case"linear":o=s;break;case"ease-in":o=y.easeIn(s);break;case"ease-out":o=y.easeOut(s);break}this._pos.copy(i.from.clone().lerp(i.to,o)),s==1&&(this.stopMoving(),i.onEnd&&i.onEnd())}}_onPositionChange(){this._parent&&(this._fixed?this._parent.position.copy(this._pos.clone().sub(this._offset)):this._offset.copy(this._pos.clone().sub(this._parent.position)));for(let t of this._attached)t.position.copy(this._pos.clone().add(t._offset))}_onOffsetChange(){this._parent&&this._fixed&&this._pos.copy(this._parent.position.clone().add(this._offset))}};var C=class{_type="";_parent=null;_position=new D;_angle=new j(0);get type(){return this._type}get scene(){return this._parent._scene}get parent(){return this._parent}get position(){return this._position.position}set position(t){this._position.position=t}get offset(){return this._position.offset}set offset(t){this._position.offset=t}get angle(){return this._angle.value}set angle(t){this._angle.value=t}initComponent(){}getComponent(t){return this._parent.getComponent(t)}rotate(t,i,s="linear",o=null){this._angle.animate(t,i,s,o)}update(t){}};var N=class extends C{_eventHandlers=new Map;constructor(){super();this._type="interactive"}on(t,i,s=!1){this._eventHandlers.has(t)||this._eventHandlers.set(t,[]),this._eventHandlers.get(t).push({handler:i,capture:s})}off(t,i){if(!this._eventHandlers.has(t))return;let s=this._eventHandlers.get(t),o=s.findIndex(r=>r.handler==i);o!=-1&&s.splice(o,1)}handleEvent(t,i){if(!this._eventHandlers.has(t))return!1;let s=!1,o=this._eventHandlers.get(t);for(let r of o)r.handler(i),r.capture&&(s=!0);return s}};var Q=class{constructor(t,i,s,o,r=null){this.x=t,this.y=i,this.w=s,this.h=o,this.entity=r}_vsAabb(t){return this.x+this.w/2>=t.x-t.w/2&&this.x-this.w/2<=t.x+t.w/2&&this.y+this.h/2>=t.y-t.h/2&&this.y-this.h/2<=t.y+t.h/2}},V=class{_bounds;_limit;_aabb;_divided=!1;_data=[];_topLeft=null;_topRight=null;_bottomLeft=null;_bottomRight=null;_maxRecursionDepth=5;constructor(t,i){this._bounds=t;let s=t[1][0]-t[0][0],o=t[1][1]-t[0][1];this._aabb=new Q(t[0][0]+s/2,t[0][1]+o/2,s,o),this._limit=i}newClient(t,i){let s=new Q(t[0],t[1],i[0],i[1]);return this._insert(s),s}updateClient(t){this._insert(t)}findNear(t,i){let[s,o]=i,[r,a]=t,h=new Q(r,a,s,o),l=this._search(h);return l==null?[]:Array.from(l)}clear(){this._data=[],this._divided=!1,this._topRight=null,this._topLeft=null,this._bottomLeft=null,this._bottomRight=null}draw(t){t.beginPath(),t.strokeStyle="white",t.strokeRect(this._aabb.x-this._aabb.w/2,this._aabb.y-this._aabb.h/2,this._aabb.w,this._aabb.h),this._divided&&(this._topLeft.draw(t),this._topRight.draw(t),this._bottomLeft.draw(t),this._bottomRight.draw(t))}_divide(){let t=this._bounds,i=t[1][0]-t[0][0],s=t[1][1]-t[0][1];this._topLeft=new V([[t[0][0],t[0][1]],[t[0][0]+i/2,t[0][1]+s/2]],this.limit),this._topRight=new V([[t[0][0]+i/2,t[0][1]],[t[0][0]+i,t[0][1]+s/2]],this.limit),this._bottomLeft=new V([[t[0][0],t[0][1]+s/2],[t[0][0]+i/2,t[0][1]+s]],this.limit),this._bottomRight=new V([[t[0][0]+i/2,t[0][1]+s/2],[t[0][0]+i,t[0][1]+s]],this.limit);for(let o of this._data)this._topLeft._insert(o),this._topRight._insert(o),this._bottomLeft._insert(o),this._bottomRight._insert(o);this.divided=!0}_search(t,i){if(i==null&&(i=new Set),!!t._vsAabb(this._aabb)){if(this._divided)this._topLeft._search(t,i),this._topRight._search(t,i),this._bottomLeft._search(t,i),this._bottomRight._search(t,i);else for(let s of this._data)t._vsAabb(s)&&i.add(s);return i}}_insert(t,i=0){if(!this._aabb._vsAabb(t))return!1;if(this._data.length<this._limit||i>this._maxRecursionDepth)return this._data.push(t),!0;this._divided||this._divide(),this._topLeft._insert(t,i+1),this._topRight._insert(t,i+1),this._bottomLeft._insert(t,i+1),this._bottomRight._insert(t,i+1)}};var K=class{_body1;_body2;_offset1;_offset2;_length;_strength;constructor(t,i,s){this._body1=t,this._body2=i;let o=u.parseObject(s.offset1,{x:0,y:0});this._offset1=new d(o.x,o.y);let r=u.parseObject(s.offset2,{x:0,y:0});this._offset2=new d(r.x,r.y);let a=this._body1.position.clone().add(this._offset1.clone().rot(this._body1.angle)),h=this._body2.position.clone().add(this._offset2.clone().rot(this._body2.angle));this._length=u.parseValue(s.length,Math.max(d.dist(a,h),1)),this._strength=u.parseValue(s.strength,1)}get offset1(){return this._offset1}set offset1(t){this._offset1.copy(t)}get offset2(){return this._offset2}set offset2(t){this._offset2.copy(t)}get length(){return this._length}set length(t){this._length=Math.max(t,1)}get strength(){return this._strength}set strength(t){this._strength=y.sat(t)}update(t){}},Z=class extends K{constructor(t,i,s){super(t,i,s)}update(t){if(this._body1.mass===0&&this._body2.mass===0)return;let i=this.offset1.clone().rot(this._body1.angle),s=this.offset2.clone().rot(this._body2.angle),o=this._body1.position.clone().add(i),r=this._body2.position.clone().add(s),a=o.clone().sub(r),h=a.clone().unit(),_=(a.mag()-this.length)/this.length,p=h.clone().mult(_*-this.strength*512/(this._body1.inverseMass+this._body2.inverseMass)),f=p.clone().mult(this._body1.inverseMass);this._body1.velocity.add(f.clone().mult(t)),this._body1.angularVelocity+=d.cross(i,f.clone().mult(1/this._body1.inertia))*t;let w=p.clone().mult(this._body2.inverseMass);this._body2.velocity.sub(w.clone().mult(t)),this._body2.angularVelocity-=d.cross(s,w.clone().mult(1/this._body2.inertia))*t}},tt=class extends K{constructor(t,i,s){super(t,i,s)}update(t){if(this._body1.mass===0&&this._body2.mass===0)return;let i=this.offset1.clone().rot(this._body1.angle),s=this.offset2.clone().rot(this._body2.angle),o=this._body1.position.clone().add(i),r=this._body2.position.clone().add(s),a=o.clone().sub(r),h=a.clone().unit(),l=a.mag(),_=16,p=h.clone().mult((l-this.length)*-1/(this._body1.inverseMass+this._body2.inverseMass));this._body1.position.add(p.clone().mult(this._body1.inverseMass*_*t)),this._body2.position.sub(p.clone().mult(this._body2.inverseMass*_*t));let f=(l-this.length)/this.length,w=h.clone().mult(f*-this.strength*512/(this._body1.inverseMass+this._body2.inverseMass)),g=w.clone().mult(this._body1.inverseMass);this._body1.velocity.add(g.clone().mult(t)),this._body1.angularVelocity+=d.cross(i,g.clone().mult(1/this._body1.inertia))*t;let c=w.Clone().Mult(this._body2.inverseMass);this._body2.velocity.Sub(c.Clone().Mult(t)),this._body2.angularVelocity-=d.Cross(s,c.Clone().Mult(1/this._body2.inertia))*t}};var X=class extends C{_vel=new d;_angVel=0;_passiveVel=new d;_behavior=[];_friction;_mass;_rotation;_collisions={left:new Set,right:new Set,top:new Set,bottom:new Set,all:new Set};_options;_followBottomObject;_resized=!1;constructor(t){super();this._type="body",this._friction=u.parseObject(t.friction,{x:0,y:0,angular:0}),this._mass=u.parseValue(t.mass,0),this._rotation=u.parseValue(t.rotation,0),this._options=u.parseObject(t.options,{axes:{x:!0,y:!0},sides:{left:!0,right:!0,top:!0,bottom:!0}}),this._followBottomObject=u.parseValue(t.followBottomObject,!1)}get velocity(){return this._vel}set velocity(t){this._vel.copy(t)}get angularVelocity(){return this._angVel}set angularVelocity(t){this._angVel=t}get mass(){return this._mass}set mass(t){this._mass=Math.max(t,0)}get friction(){return this._friction}get rotation(){return this._rotation}set rotation(t){this._rotation=t}get inverseMass(){return this._mass===0?0:1/this._mass}get inertia(){return 0}get collisions(){return this._collisions}get options(){return this._options}get followBottomObject(){return this._followBottomObject}set followBottomObject(t){this._followBottomObject=t}get passiveVelocity(){return this._passiveVel}set passiveVelocity(t){this._passiveVel.copy(t)}initComponent(){this.scene.addBody(this.parent,this)}getBoundingRect(){return{width:0,height:0}}addBehavior(t,i,s={}){this._behavior.push({groups:t.split(" "),type:i,options:u.parseObject(s,{bounce:0,friction:0,action:null})})}join(t,i,s={}){let o;switch(i){case"elastic":o=new Z(this,t,s);break;case"solid":o=new tt(this,t,s);break}if(!o)return;this.scene.world._addJoint(o)}contains(t){return!1}applyForce(t,i){let s=i.clone().sub(this.position),o=t.clone().mult(this.inverseMass);this.velocity.add(o),this.angularVelocity+=d.cross(s,o.clone().mult(1/this.inertia))}updatePosition(t){let i=16,s=new d(this._vel.x*this._friction.x*i,this._vel.y*this._friction.y*i);this._vel.sub(s.mult(t));let o=this._vel.clone().mult(t);this.position.add(o),this.position.add(this._passiveVel.clone().mult(t)),this._passiveVel.set(0,0),this._angVel-=this._angVel*this._friction.angular*i*t,this.angle+=this._angVel*t}handleBehavior(){let t=this.getComponent("QuadtreeController"),i=this.getBoundingRect();for(let s of this._behavior){let o=t.findNearby(i.width,i.height).filter(r=>s.groups.map(a=>r.groupList.has(a)).some(a=>a));for(let r of o){let a;switch(s.type){case"DetectCollision":a=$(this,r.body),a.collide&&s.options.action&&s.options.action(r.body,a.point);break;case"ResolveCollision":a=Yt(this,r.body,s.options),a.collide&&s.options.action&&s.options.action(r.body,a.point);break}}}}},b=class extends X{_points;constructor(t){super(t);this._points=t.points}get inertia(){let t=0;for(let i=0;i<verts.length;++i){let o=verts[i].mag();o>t&&(t=o)}return Math.PI*t**2*.5/this.rotation}getBoundingRect(){let t=this._getVertices(),i=0;for(let o=0;o<t.length;++o){let a=t[o].mag();a>i&&(i=a)}let s=i*2;return{width:s,height:s}}contains(t){let i=this.getComputedVertices(),s=i.length,o=0;for(let r=0;r<s;++r){let a=i[r],h=i[(r+1)%s];(t.y-a.y)*(t.y-h.y)<=0&&(t.x<=a.x||t.x<=h.x)&&(a.x>=t.x&&h.x>=t.x||(h.x-a.x)*(t.y-a.y)/(h.y-a.y)>=t.x-a.x)&&++o}return o%2}getComputedVertices(){let t=this._getVertices();for(let i=0;i<t.length;++i){let s=t[i];s.rot(this.angle),s.add(this.position)}return t}_getVertices(){return this._points.map(t=>new d(t[0],t[1]))}static getFaceNormals(t){let i=[];for(let s=0;s<t.length;s++){let o=t[s].clone(),r=t[(s+1)%t.length].clone();i[s]=r.clone().sub(o).norm().unit()}return i}static findSupportPoint(t,i,s){let o=-1/0,r=-1;for(let a=0;a<t.length;a++){let h=t[a].clone().sub(s),l=d.dot(h,i);l>0&&l>o&&(o=l,r=a)}return{sp:t[r],depth:o}}},et=class extends b{_width;_height;constructor(t){super(t);this._width=t.width,this._height=t.height,this._initPoints()}get width(){return this._width}get height(){return this._height}set width(t){this._width=Math.max(t,0),this._initPoints()}set height(t){this._height=Math.max(t,0),this._initPoints()}get inertia(){return(this.width**2+this.height**2)*.1/this.rotation}_initPoints(){this._points=[[-this._width/2,-this._height/2],[this._width/2,-this._height/2],[this._width/2,this._height/2],[-this._width/2,this._height/2]],this._resized=!0}},it=class extends b{_radius;_sides;constructor(t){super(t);this._radius=t.radius,this._sides=t.sides,this._initPoints()}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._initPoints()}get sides(){return this._sides}set sides(t){this._sides=Math.max(t,3),this._initPoints()}get inertia(){return Math.PI*this.radius**2*.2/this.rotation}getBoundingRect(){return{width:2*this.radius,height:2*this.radius}}_initPoints(){let t=[];for(let i=0;i<this._sides;++i){let s=Math.PI*2/this._sides*i;t.push([Math.cos(s)*this._radius,Math.sin(s)*this._radius])}this._points=t,this._resized=!0}},S=class extends X{_radius;constructor(t){super(t);this._radius=t.radius}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._resized=!0}get inertia(){return Math.PI*this.radius**2*.4/this.rotation}getBoundingRect(){return{width:2*this.radius,height:2*this.radius}}findSupportPoint(t,i){let s=[];s[0]=this.position.clone().add(t.clone().mult(this.radius)),s[1]=this.position.clone().add(t.clone().mult(-this.radius));let o=-1/0,r=-1;for(let a=0;a<s.length;a++){let h=s[a].clone().sub(i),l=d.dot(h,t);l>0&&l>o&&(o=l,r=a)}return{sp:s[r],depth:o,n:t}}findNearestVertex(t){let i=1/0,s=0;for(let o=0;o<t.length;o++){let r=d.dist(t[o],this.position);r<i&&(i=r,s=o)}return t[s]}contains(t){return d.dist(t,this.position)<=this.radius}},R=class extends X{_range;constructor(t){super(t);this._range=t.range}get range(){return this._range}set range(t){this._range=t,this._resized=!0}get point(){return this.position.clone().add(new d(this.range,0).rot(this.angle))}getBoundingRect(){return{width:2*this.range,height:2*this.range}}},$=(n,t)=>n instanceof S&&t instanceof S?$t(n,t):n instanceof b&&t instanceof b?Jt(n,t):n instanceof S&&t instanceof b?Ot(n,t):n instanceof b&&t instanceof S?Ot(t,n):n instanceof R&&t instanceof b?Dt(n,t):n instanceof b&&t instanceof R?Dt(t,n):n instanceof R&&t instanceof S?Wt(n,t):n instanceof S&&t instanceof R?Wt(t,n):n instanceof R&&t instanceof R?Xt(t,n):{collide:!1},Lt=(n,t,i,s)=>{let o=t.clone().sub(n),r=s.clone().sub(i),a=o.x*r.y-o.y*r.x,h=((i.x-n.x)*o.y-(i.y-n.y)*o.x)/a,l=((i.x-n.x)*r.y-(i.y-n.y)*r.x)/a;return 0<=h&&h<=1&&0<=l&&l<=1?{collide:!0,point:n.clone().add(o.clone().mult(l))}:{collide:!1}},Xt=(n,t)=>Lt(n.position,n.point,t.position,t.point),Dt=(n,t)=>{let i=n.point,s=1/0,o=null,r=t.getComputedVertices();for(let a=0;a<r.length;++a){let h=r[a],l=r[(a+1)%r.length],_=Lt(n.position,i,h,l);if(_.collide){let p=d.dist(n.position,_.point);p<s&&(s=p,o=_.point)}}return o!=null?(n._collisions.all.add(t),t._collisions.all.add(n),{collide:!0,point:o}):{collide:!1}},Wt=(n,t)=>{let i=n.point,s=i.clone().sub(n.position).unit(),o=t.position.clone().sub(n.position),r=t.radius**2,a=o.mag()**2,h=d.dot(o,s),l=a-h*h;if(r-l<0)return{collide:!1};let _=Math.sqrt(r-l),p;a<r?p=h+_:p=h-_;let f=n.position.clone().add(s.clone().mult(p));return d.dot(f.clone().sub(n.position),i.clone().sub(n.position))<0||d.dist(f,n.position)>n.range?{collide:!1}:(n._collisions.all.add(t),t._collisions.all.add(n),{collide:!0,point:f})},$t=(n,t)=>{let i=n.position.clone().sub(t.position),s={};return i.mag()<n.radius+t.radius?(s.normal=i.clone().unit(),s.depth=n.radius+t.radius-i.mag(),s.point=n.position.clone().add(s.normal.clone().mult(n.radius)),s.collide=!0,n._collisions.all.add(t),t._collisions.all.add(n),s):{collide:!1}},Jt=(n,t)=>{let i=n.getComputedVertices(),s=t.getComputedVertices(),o=b.getFaceNormals(i),r=b.getFaceNormals(s),a=[];for(let f=0;f<o.length;f++){let w=b.findSupportPoint(s,o[f].clone().mult(-1),i[f]);if(w.n=o[f].clone(),a[f]=w,w.sp==null)return{collide:!1}}let h=[];for(let f=0;f<r.length;f++){let w=b.findSupportPoint(i,r[f].clone().mult(-1),s[f]);if(w.n=r[f].clone(),h[f]=w,w.sp==null)return{collide:!1}}a=a.concat(h);let l=1/0,_=0;for(let f=0;f<a.length;f++)a[f].depth<l&&(l=a[f].depth,_=f);let p=t.position.clone().sub(n.position);return d.dot(p,a[_].n)>0&&a[_].n.mult(-1),n._collisions.all.add(t),t._collisions.all.add(n),{collide:!0,normal:a[_].n,depth:a[_].depth,point:a[_].sp}},Ot=(n,t)=>{let i=t.getComputedVertices(),s=b.getFaceNormals(i),o=[];for(let p=0;p<s.length;p++){let f=n.findSupportPoint(s[p].clone().mult(-1),i[p].clone());if(f.sp==null)return{collide:!1};o[p]=f}let r=t.position.clone().sub(n.position).unit().mult(-1),a=b.findSupportPoint(i,r.clone(),n.position.clone().add(r.clone().mult(-n.radius)));if(a.sp==null)return{collide:!1};a.n=r.clone(),o.push(a);let h=1/0,l=0;for(let p=0;p<o.length;p++)o[p].depth<h&&(h=o[p].depth,l=p);let _=t.position.clone().sub(n.position);return d.dot(_,o[l].n)<0&&o[l].n.mult(-1),n._collisions.all.add(t),t._collisions.all.add(n),{collide:!0,normal:o[l].n,point:o[l].sp,depth:o[l].depth}},Yt=(n,t,i)=>{n instanceof S&&t instanceof b&&([n,t]=[t,n]);let s=$(n,t);if(s.collide){let o={collide:!0,point:s.point};if(n.mass===0&&t.mass===0)return o;n.options.axes.x&&t.options.axes.x||(s.normal.x=0),n.options.axes.y&&t.options.axes.y||(s.normal.y=0);let r=i.bounce,a=i.friction,h={left:new d(-1,0),right:new d(1,0),top:new d(0,-1),bottom:new d(0,1)},l;d.dot(s.normal,h.left)>=Math.SQRT2/2?l="left":d.dot(s.normal,h.right)>=Math.SQRT2/2?l="right":d.dot(s.normal,h.top)>=Math.SQRT2/2?l="top":d.dot(s.normal,h.bottom)>=Math.SQRT2/2&&(l="bottom");let _=s.point.clone().sub(n.position),p=s.point.clone().sub(t.position),f=n.angularVelocity,w=t.angularVelocity,g=n._vel,c=t._vel,v=g.clone().add(new d(-f*_.y,f*_.x)),m=c.clone().add(new d(-w*p.y,w*p.x)),P=v.clone().sub(m),A=-(1+r)*d.dot(P,s.normal)/(n.inverseMass+t.inverseMass+Math.pow(d.cross(_,s.normal),2)/n.inertia+Math.pow(d.cross(p,s.normal),2)/t.inertia),M=s.normal.clone().mult(A),Ct=M.clone().mult(n.inverseMass),kt=M.clone().mult(t.inverseMass),Mt=d.dot(M,h.left),Pt=d.dot(M,h.right),jt=d.dot(M,h.top),Rt=d.dot(M,h.bottom);if((Mt>=Math.SQRT2/2||Mt<Math.SQRT2/2&&l=="left")&&(!n.options.sides.right||!t.options.sides.left))return o;if((Pt>=Math.SQRT2/2||Pt<Math.SQRT2/2&&l=="right")&&(!n.options.sides.left||!t.options.sides.right))return o;if((jt>=Math.SQRT2/2||jt<Math.SQRT2/2&&l=="top")&&(!n.options.sides.bottom||!t.options.sides.top))return o;if((Rt>=Math.SQRT2/2||Rt<Math.SQRT2/2&&l=="bottom")&&(!n.options.sides.top||!t.options.sides.bottom))return o;let Et=s.normal.clone().mult(s.depth/(n.inverseMass+t.inverseMass));if(n.position.add(Et.clone().mult(n.inverseMass)),t.position.sub(Et.clone().mult(t.inverseMass)),d.dot(P,s.normal)<=0){n._vel.add(Ct),t._vel.sub(kt),n.angularVelocity+=d.cross(_,Ct.clone().mult(1/n.inertia)),t.angularVelocity-=d.cross(p,kt.clone().mult(1/n.inertia));let H=s.normal.clone().norm(),Nt=-(1+r)*d.dot(P,H)*a/(n.inverseMass+t.inverseMass+Math.pow(d.cross(_,H),2)/n.inertia+Math.pow(d.cross(p,H),2)/t.inertia),Vt=H.clone().mult(Nt),St=Vt.clone().mult(n.inverseMass),Bt=Vt.clone().mult(t.inverseMass);switch(n._vel.add(St.clone()),t._vel.sub(Bt.clone()),n.angularVelocity+=d.cross(_,St.clone().mult(1/n.inertia)),t.angularVelocity-=d.cross(p,Bt.clone().mult(1/t.inertia)),l){case"left":n._collisions.right.add(t),t._collisions.left.add(n);break;case"right":n._collisions.left.add(t),t._collisions.right.add(n);break;case"top":n._collisions.bottom.add(t),t._collisions.top.add(n);break;case"bottom":n._collisions.top.add(t),t._collisions.bottom.add(n);break}}return l=="bottom"?t.followBottomObject&&(t.passiveVelocity=n.velocity):l=="top"&&n.followBottomObject&&(n.passiveVelocity=t.velocity),o}return{collide:!1}};var st=class{_relaxationCount;_gravity;_quadtree;_bodies=[];_joints=[];constructor(t={}){this._relaxationCount=u.parseValue(t.relaxationCount,3),this._gravity=u.parseValue(t.gravity,0);let i=u.parseValue(t.bounds,[[-1e3,-1e3],[1e3,1e3]]),s=u.parseObject(t.cellDimension,{width:100,height:100}),o=u.parseValue(t.cellLimit,10);this._quadtree=new V(i,o)}get quadtree(){return this._quadtree}addJoint(t){this._joints.push(t)}addBody(t,i){t._body=i;let s=new Tt({quadtree:this._quadtree});t.addComponent(s),this._bodies.push(i)}removeBody(t,i){let s=this._bodies.indexOf(i);s!=-1&&this._bodies.splice(s,1)}update(t){for(let i of this._bodies)i._collisions.left.clear(),i._collisions.right.clear(),i._collisions.top.clear(),i._collisions.bottom.clear(),i._collisions.all.clear();for(let i of this._bodies)i.mass!=0&&(i.velocity.y+=this._gravity*t),i.updatePosition(t);for(let i of this._joints)i.update(t);for(let i=0;i<this._relaxationCount;++i)for(let s of this._bodies)s.handleBehavior();this._quadtree.clear();for(let i of this._bodies)i.getComponent("QuadtreeController").updateClient()}raycast(t){let i=[],s=t.groups.split(" "),o=new R({range:t.range});o.position=t.position,o.angle=t.angle;let r=o.getBoundingRect(),a=this._bodies.filter(h=>{if(!s.map(_=>h.parent.groupList.has(_)).some(_=>_))return!1;let l=h.getBoundingRect();return(o.position.x+r.width/2-(h.position.x-l.width/2))*(o.position.x-r.width/2-(h.position.x+l.width/2))<0||(o.position.y+r.height/2-(h.position.y-l.height/2))*(o.position.y-r.height/2-(h.position.y+l.height/2))<0});for(let h of a){let l=$(o,h);l.collide&&i.push({body:h,point:l.point})}return i}},Tt=class extends C{_quadtree;_client=null;constructor(t){super();this._quadtree=t.quadtree}initComponent(){let t=[this._parent.body.position.x,this._parent.body.position.y],i=this._parent.body.getBoundingRect();this._client=this._quadtree.newClient(t,[i.width,i.height]),this._client.entity=this._parent}findNearby(t,i){return this._quadtree.findNear([this._parent.position.x,this._parent.position.y],[t,i]).filter(o=>o.entity!=this._parent).map(o=>o.entity)}updateClient(){let t=[this._parent.body.position.x,this._parent.body.position.y];if(this._client.x=t[0],this._client.y=t[1],this._parent.body._resized){this._parent.body._resized=!1;let i=this._parent.body.getBoundingRect();this._client.w=i.width,this._client.h=i.height}this._quadtree.updateClient(this._client)}};var k=class{_color;_parsed=null;constructor(t="black"){this._color=t}set(t){this._color=t,this._parsed=null}fill(t){t.fillStyle=this.get(t)}stroke(t){t.strokeStyle=this.get(t)}get(t){return this._parsed==null&&(this._parsed=k.parse(t,this._color)),this._parsed}static parse(t,i){if(typeof i!="string")return"black";let s=i.split(";"),o=s.length;if(o===1)return i;let r,a=s[1].split(",").map(h=>parseFloat(h));switch(s[0]){case"linear-gradient":r=t.createLinearGradient(...a);break;case"radial-gradient":r=t.createRadialGradient(...a);break;default:return"black"}for(let h=2;h<o;++h){let l=s[h].split("=");r.addColorStop(parseFloat(l[1]),l[0])}return r}};var W=class{_offset=new d;_anim=null;get offset(){return this._offset}shake(t,i,s,o){let r=s*i/1e3;this._anim={counter:0,count:r,angle:o,dur:i,range:t}}isShaking(){return this._anim!==null}stopShaking(){this._anim=null,this._offset.set(0,0)}update(t){if(this._anim){let i=this._anim;i.counter+=t*1e3;let s=y.sat(i.counter/i.dur);this._offset.copy(new d(Math.sin(s*Math.PI*2*i.count)*i.range,0).rot(i.angle)),s==1&&this.stopShaking()}}};var O=class{_name=null;_scene=null;_parent=null;_groupList=new Set;_components=new Map;_position=new D;_interactive=null;_body=null;_onUpdate=null;get name(){return this._name}get scene(){return this._scene}get position(){return this._position.position}set position(t){this._position.position=t}get interactive(){return this._interactive}get body(){return this._body}get groupList(){return this._groupList}clip(t,i=!1){this._position.clip(t._position,i)}unclip(t){this._position.unclip(t._position)}moveTo(t,i,s="linear",o=null){this._position.moveTo(t,i,s,o)}stopMoving(){this._position.stopMoving()}isMoving(){return this._position.isMoving()}addComponent(t,i){i===void 0&&(i=t.constructor.name),this._components.set(i,t),t._parent=this,t.position.copy(this.position.clone().add(t.offset)),this.clip(t,!0),t.initComponent()}getComponent(t){return this._components.get(t)}_updatePosition(t){this._position.update(t)}update(t){this._updatePosition(t),this._onUpdate&&this._onUpdate(t),this._components.forEach(i=>{i.update(t)})}onUpdate(t){this._onUpdate=t}};var ot=class extends O{_scale=new j(1);_target=null;_followOffset=4;_vel=new d;_shaker=new W;constructor(){super()}get position(){return this._position.position.clone().add(this._shaker.offset)}get scale(){return this._scale.value}set scale(t){this._scale.value=t}get velocity(){return this._vel}set velocity(t){this._vel.copy(t)}get shaker(){return this._shaker}follow(t,i=4){this._target=t,this._followOffset=i}unfollow(){this._target=null}isScaling(){return this._scale.isAnimating()}scaleTo(t,i,s="linear",o=null){this._scale.animate(t,i,s,o)}stopScaling(){this._scale.stopAnimating()}moveAndScale(t,i,s,o="linear",r=null){this.moveTo(t,s,o,r),this.scaleTo(i,s,o)}stop(){this.stopMoving(),this.stopScaling()}_updatePosition(t){if(this.isMoving())this._position.update(t);else if(this._target!==null){let i=this._followOffset*t;this.position.lerp(this._target.position,i)}else{let i=this._vel.clone();i.mult(t),this.position.add(i)}this._scale.update(t),this._shaker.update(t)}};var nt=class{_entities=[];_entitiesMap=new Map;_ids=0;_generateName(){return++this._ids,"__entity__"+this._ids}add(t,i){i===void 0&&(i=this._generateName()),this._entities.push(t),this._entitiesMap.set(i,t),t._parent=this,t._name=i}get(t){return this._entitiesMap.get(t)}remove(t){let i=this._entities.indexOf(t);i<0||this._entities.splice(i,1)}filter(t){return this._entities.filter(t)}update(t){for(let i of this._entities)i.update(t)}};var rt=class{_paused=!0;_hidden=!0;_world;_lights=[];_drawable=[];_interactiveEntities=[];_keys=new Set;_entityManager=new nt;_buffer=null;_light;_background;_timeout=new B;_camera;_interactive=new N;_resources=null;constructor(t={}){this._world=new st(t.physics),this._light=new k(u.parseValue(t.light,"white")),this._background=new k(u.parseValue(t.background,t.background)),this._camera=new ot,this.addEntity(this._camera,"Camera")}get paused(){return this._paused}get hidden(){return this._hidden}get timeout(){return this._timeout}get camera(){return this._camera}get world(){return this._world}get resources(){return this._resources}get background(){return this._background._color}set background(t){this._background.set(t)}get light(){return this._light._color}set light(t){this._light.set(t)}get interactive(){return this._interactive}isKeyPressed(t){return this._keys.has(t)}setInteractive(t){this._interactiveEntities.push(t);let i=new N;t.addComponent(i),t._interactive=i}getEntityByName(t){return this._entityManager.get(t)}getEntitiesByGroup(t){return this._entityManager.filter(i=>i.groupList.has(t))}handleEvent(t,i){let s=!1;if(t.startsWith("mouse")){if(t=="mousedown"){let o=this._world.quadtree.findNear([i.x,i.y],[0,0]).map(r=>r.entity);for(let r of o)!r.interactive||r.body.contains(new d(i.x,i.y))&&(r.interactive.id=i.id,r.interactive.handleEvent(t,i)&&(s=!0))}}else if(t.startsWith("key"))switch(t){case"keydown":this._keys.add(i.key);break;case"keyup":this._keys.delete(i.key);break}return s||this._interactive.handleEvent(t,i)&&(s=!0),s}createEntity(t){let i=new O;return this.addEntity(i,t),i}addEntity(t,i){t._scene=this,this._entityManager.add(t,i)}removeEntity(t){this._entityManager.remove(t),t._components.forEach(i=>{switch(i._type){case"drawable":this.removeDrawable(i);break;case"body":this.removeBody(t,i);break;case"light":this.removeLight(i);break;case"interactive":this._interactiveEntities.splice(this._interactiveEntities.indexOf(t),1);break}})}addDrawable(t){this._drawable.push(t);for(let i=this._drawable.length-1;i>0&&!(t._zIndex>=this._drawable[i-1]._zIndex);--i)[this._drawable[i],this._drawable[i-1]]=[this._drawable[i-1],this._drawable[i]]}removeDrawable(t){let i=this._drawable.indexOf(t);i!=-1&&this._drawable.splice(i,1)}addBody(t,i){this._world.addBody(t,i)}removeBody(t,i){this._world.removeBody(t,i)}addLight(t){this._lights.push(t)}removeLight(t){this._lights.splice(this._lights.indexOf(t),1)}hide(){this._paused=!0,this._hidden=!0}pause(){this._paused=!0}play(){this._paused=!1,this._hidden=!1}drawLights(t,i,s){t.globalCompositeOperation="source-over",t.beginPath(),this._light.fill(t),t.fillRect(0,0,i,s);let o=this._camera;t.globalCompositeOperation="lighter",t.save(),t.translate(-o.position.x*o.scale+i/2,-o.position.y*o.scale+s/2),t.scale(o.scale,o.scale);for(let r of this._lights)r.drawInternal(t);t.restore(),t.globalCompositeOperation="multiply"}drawObjects(t,i,s){let o=this._camera;this._buffer||(this._buffer=document.createElement("canvas").getContext("2d"),this._buffer.canvas.width=i,this._buffer.canvas.height=s,this._buffer.imageSmoothingEnabled=!1);let r=this._buffer;r.beginPath(),this._background.fill(r),r.fillRect(0,0,i,s),r.save(),r.translate(-o.position.x*o.scale+i/2,-o.position.y*o.scale+s/2),r.scale(o.scale,o.scale);for(let a of this._drawable){let h=a.getBoundingBox(),l=new d(h.x,h.y);l.sub(o.position),l.mult(o.scale);let[_,p]=[h.width,h.height].map(f=>f*o.scale);l.x+_/2<-i/2||l.x-_/2>i/2||l.y+p/2<-s/2||l.y-p/2>s/2||a.drawInternal(r)}r.restore(),t.drawImage(r.canvas,0,0)}update(t){this._paused||(this.timeout.update(t*1e3),this._entityManager.update(t),this._world.update(t))}};var at=class{_resources;_bgmusic;_effects;constructor(t){this._resources=t,this._effects=new zt(this._resources),this._bgmusic=new It(this._resources)}get bgmusic(){return this._bgmusic}get effects(){return this._effects}},It=class{_resources;_audio=null;_volume=1;_speed=1;_loop=!1;constructor(t){this._resources=t}get volume(){return this._volume}set volume(t){let i=y.sat(t);this._volume=i,this._set()}get speed(){return this._speed}set speed(t){t>0&&(this._speed=t,this._set())}get loop(){return this._loop}set loop(t){this._loop=t,this._set()}get time(){return this._audio?this._audio.currentTime:0}set time(t){this._audio&&(this._audio.currentTime=y.clamp(t,0,this._audio.duration))}get paused(){return this._audio?this._audio.paused:!0}set(t){this._audio=this._resources.get(t).cloneNode(!0),this._set()}play(){this._audio&&this._audio.play()}pause(){this._audio&&this._audio.pause()}_set(){this._audio&&(this._audio.volume=this._volume,this._audio.playbackRate=this._speed,this._audio.loop=this._loop)}},zt=class{_resources;_volume=1;_arr=[];constructor(t){this._resources=t}get volume(){return this._volume}set volume(t){let i=y.sat(t);this._volume=t;for(let s of this._arr)s.volume=this._volume}play(t,i){let s=u.parseValue(i.speed,1),o=this._resources.get(t).cloneNode(!0);o.addEventListener("ended",()=>{let r=this._arr.indexOf(o);r!=-1&&this._arr.splice(r,1)}),o.volume=this._volume,o.playbackRate=s,this._arr.push(o),o.play()}};var ht=class{_resources=null;_config;_width;_height;_init;_preload;_parentElement;_renderer;_load=new E;_sceneManager=new G;_engine;_timeout=new B;_audio=null;constructor(t){this._config=t,this._width=t.width,this._height=t.height,this._init=t.init.bind(this);let i;(i=u.parseValue(t.preload,null))!==null&&(this._preload=i.bind(this)),this._parentElement=u.parseValue(t.parentElement,document.body);let s=this._parentElement;s.style.WebkitUserSelect="none",s.style.userSelect="none",s.style.touchAction="none",this._renderer=new U(this._width,this._height,this._parentElement);let o=r=>{this._timeout.update(r);let a=this._sceneManager.scenes;for(let h of a)h.update(r*.001);this._renderer.render(a)};this._engine=new Y(o),this._initEventListeners(),this._initControls(),this._engine.start(),this._preload?(this._preload(),this._load.load(r=>{this._resources=r,this._audio=new at(this._resources),this._init()})):this._init()}get load(){return this._load}get resources(){return this._resources}get timeout(){return this._timeout}get audio(){return this._audio}createScene(t,i,s){let o=new rt(s);return o._resources=this._resources,this._sceneManager.add(o,t,i),o}requestFullScreen(){let t=this._parentElement,i=t.requestFullScreen||t.webkitRequestFullScreen;i&&i.call(t)}_initEventListeners(){let t="ontouchstart"in document,i=this._renderer.canvas;t?(i.addEventListener("touchstart",s=>this._handleTouchEvent(s)),i.addEventListener("touchmove",s=>this._handleTouchEvent(s)),i.addEventListener("touchend",s=>this._handleTouchEvent(s))):(i.addEventListener("mousedown",s=>this._handleMouseEvent(s)),i.addEventListener("mousemove",s=>this._handleMouseEvent(s)),i.addEventListener("mouseup",s=>this._handleMouseEvent(s))),addEventListener("keydown",s=>this._handleKeyEvent(s)),addEventListener("keyup",s=>this._handleKeyEvent(s))}_handleKeyEvent(t){t.preventDefault(),this._handleSceneEvent(t.type,{key:t.key})}_handleTouchEvent(t){t.preventDefault();let i={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};this._handleSceneEvent(i[t.type],{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY})}_handleMouseEvent(t){t.preventDefault(),this._handleSceneEvent(t.type,{x:t.pageX,y:t.pageY})}_handleSceneEvent(t,i){for(let s of this._sceneManager.scenes){let o=Object.assign({},i);if(t.startsWith("mouse")){let r=this._renderer.displayToSceneCoords(s,o.x,o.y);o.x=r.x,o.y=r.y}if(s.handleEvent(t,o,this._renderer))break}}_initControls(){let t=u.parseObject(this._config.controls,{active:!1,layout:{DPad:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},X_Button:"e",Y_Button:"d",A_Button:"s",B_Button:"f",L_Button:"Control",R_Button:"Control",START_Button:" ",SELECT_Button:"Tab"}});if(!t.active||!("ontouchstart"in document))return;let i=t.layout,s=(g,c=!0)=>{let v="rgba(150, 150, 150, 0.6)";g.style.pointerEvents="auto",g.style.position="absolute",g.style.border="2px solid "+v,g.style.color=v,g.style.fontFamily="Arial",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",c&&(g.style.background="radial-gradient(circle at center, "+v+" 0, rgba(0, 0, 0, 0.6) 60%)")},o=(g,c,v)=>{let m=document.createElement("div");return m.style.width="46px",m.style.height="46px",m.style.right=g-5+"px",m.style.bottom=c+10+"px",m.textContent=v,m.style.borderRadius="50%",m.style.fontSize="22px",s(m),h.appendChild(m),m},r=g=>{let c=document.createElement("div");return c.style.width="46px",c.style.height="46px",c.style.bottom=190+"px",c.style.fontSize="22px",g=="left"?(c.style.left=5+"px",c.textContent="L",c.style.borderRadius="50% 0 0 50%"):g=="right"&&(c.style.right=5+"px",c.textContent="R",c.style.borderRadius="0 50% 50% 0"),s(c),h.appendChild(c),c},a=g=>{let c=document.createElement("div");return c.style.width="50px",c.style.height="22px",g=="Start"?c.style.left="calc(50% + "+3+"px)":g=="Select"&&(c.style.right="calc(50% + "+3+"px)"),c.style.bottom=20+"px",c.textContent=g,c.style.borderRadius="12px",c.style.fontSize="12px",c.style.fontWeight="bolder",s(c),h.appendChild(c),c},h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.left="0",h.style.top="0",h.style.zIndex="999",h.style.position="absolute",h.style.pointerEvents="none";let l={},_=document.createElement("div");_.style.width="120px",_.style.height="120px",_.style.left="10px",_.style.bottom="50px",_.style.borderRadius="50%",_.style.overflow="hidden",s(_),h.appendChild(_);for(let g=0;g<4;++g){let c=document.createElement("div");c.style.width="120px",c.style.height="120px",c.style.left=-75+150*(g%2)+"px",c.style.top=-75+150*Math.floor(g/2)+"px",s(c,!1),_.appendChild(c)}l.DPad=_,l.A_Button=o(10,63,"A"),l.B_Button=o(63,10,"B"),l.X_Button=o(63,116,"X"),l.Y_Button=o(116,63,"Y"),l.L_Button=r("left"),l.R_Button=r("right"),l.SELECT_Button=a("Select",-20),l.START_Button=a("Start",20),this._parentElement.appendChild(h);let p={left:{v:new d(-1,0),n:"left"},right:{v:new d(1,0),n:"right"},up:{v:new d(0,-1),n:"up"},down:{v:new d(0,1),n:"down"}},f=g=>{let c=_.getBoundingClientRect(),v=g.changedTouches[0].pageX-(c.x+c.width/2),m=g.changedTouches[0].pageY-(c.y+c.height/2),P=new d(v,m);if(P.mag()<20)return[];let A=P.clone().unit(),M=[];return d.dot(A,p.left.v)>=.5&&M.push(p.left.n),d.dot(A,p.right.v)>=.5&&M.push(p.right.n),d.dot(A,p.up.v)>=.5&&M.push(p.up.n),d.dot(A,p.down.v)>=.5&&M.push(p.down.n),M},w=(g,c,v)=>{for(let m of c)this._handleSceneEvent(g,{key:v[m]})};for(let g in l){let c=l[g],v=i[g];if(g=="DPad"){c.addEventListener("touchstart",m=>{m.preventDefault();let P=f(m);w("keydown",P,v)}),c.addEventListener("touchmove",m=>{m.preventDefault(),w("keyup",["left","right","up","down"],v);let P=f(m);w("keydown",P,v)}),c.addEventListener("touchend",m=>{m.preventDefault();let P=f(m);w("keyup",["left","right","up","down"],v)});continue}c.addEventListener("touchstart",m=>{m.preventDefault(),this._handleSceneEvent("keydown",{key:v})}),c.addEventListener("touchmove",m=>{m.preventDefault(),this._handleSceneEvent("keydown",{key:v})}),c.addEventListener("touchend",()=>{e.preventDefault(),this._handleSceneEvent("keyup",{key:v})})}}};var dt={};F(dt,{Color:()=>k,Loader:()=>E,QuadTree:()=>V,Tileset:()=>lt,TimeoutHandler:()=>B,Vector:()=>d,math:()=>y,paramParser:()=>u});var L=class extends C{_zIndex;_opacity;_fillColor;_strokeColor;_strokeWidth;_visible=!0;constructor(t={}){super();this._type="drawable",this._zIndex=u.parseValue(t.zIndex,0),this._opacity=new j(u.parseValue(t.opacity,1)),this._fillColor=new k(u.parseValue(t.fillColor,"white")),this._strokeColor=new k(t.strokeColor),this._strokeWidth=u.parseValue(t.strokeWidth,1),this._strokeCap=u.parseValue(t.strokeCap,"butt"),this._shadowColor=new k(u.parseValue(t.shadowColor,"transparent")),this._shadow=u.parseObject(t.shadow,{x:0,y:0})}get visible(){return this._visible}set visible(t){this._visible=t}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.scene&&(this.scene.removeDrawable(this),this.scene.addDrawable(this))}get opacity(){return this._opacity.value}set opacity(t){this._opacity.value=y.sat(t)}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=Math.max(t,0)}get fillColor(){return this._fillColor._color}set fillColor(t){this._fillColor.set(t)}get shadowColor(){return this._shadowColor._color}set shadowColor(t){this._shadowColor.set(t)}get shadow(){return this._shadow}get strokeColor(){return this._strokeColor._color}set strokeColor(t){this._strokeColor.set(t)}fade(t,i,s="linear",o=null){this._opacity.animate(t,i,s,o)}getBoundingBox(){return{x:0,y:0,width:0,height:0}}initComponent(){this.scene.addDrawable(this)}drawInternal(t){!this.visible||(t.save(),this.shadowColor!="transparent"&&(this.shadow.x!=0||this.shadow.y!=0)&&(t.save(),t.translate(this.shadow.x,this.shadow.y),this.drawShadow(t),t.restore()),this.draw(t),t.restore())}draw(t){}drawShadow(t){}update(t){this._opacity.update(t)}},x=class extends L{_flip;_scale;_image=null;_imageOptions=null;_center=new d;_width;_height;_imageParams=null;_shaker=new W;constructor(t={}){super(t);this._imageParams=u.parseValue(t.image,null);let i=u.parseObject(t.scale,{x:1,y:1});this._scale={x:new j(i.x),y:new j(i.y)},this._width=u.parseValue(t.width,0),this._height=u.parseValue(t.height,0)}get width(){return this._width}set width(t){this._width=Math.max(t,0)}get height(){return this._height}set height(t){this._height=Math.max(t,0)}get scale(){return{x:this._scale.x.value,y:this._scale.y.value}}set scale(t){let i=u.parseObject(t,{x:this._scale.x.value,y:this._scale.y.value});this._scale.x.value=i.x,this._scale.y.value=i.y}get center(){return this._center}set center(t){this._center.copy(t)}get shaker(){return this._shaker}scaleTo(t,i,s="linear",o=null){let r=u.parseObject(t,{x:this._scale.x.value,y:this._scale.y.value});this._scale.x.value!=r.x&&this._scale.x.animate(r.x,i,s,o),this._scale.y.value!=r.y&&this._scale.y.animate(r.y,i,s,o)}initComponent(){super.initComponent(),this._imageParams!==null&&(this._image=this.scene.resources.get(this._imageParams.name),this._imageOptions=u.parseObject(this._imageParams,{width:this._image.width,height:this._image.height,frameWidth:this._image.width,frameHeight:this._image.height,framePosition:{x:0,y:0}}))}getBoundingBox(){let t=Math.hypot(this._width,this._height);return{width:t*Math.abs(this.scale.x),height:t*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}drawInternal(t){!this.visible||(t.save(),t.translate(this.position.x+this._shaker.offset.x,this.position.y+this._shaker.offset.y),this.shadowColor!="transparent"&&(this.shadow.x!=0||this.shadow.y!=0)&&(t.save(),t.translate(this.shadow.x,this.shadow.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.angle),t.translate(-this._center.x,-this._center.y),this.drawShadow(t),t.restore()),t.scale(this.scale.x,this.scale.y),t.rotate(this.angle),t.translate(-this._center.x,-this._center.y),this.draw(t),t.restore())}drawImage(t,i=this._imageOptions.width,s=this._imageOptions.height,o=!0,r=this._imageOptions.framePosition){o&&t.clip(),t.drawImage(this._image,r.x*this._imageOptions.frameWidth,r.y*this._imageOptions.frameHeight,this._imageOptions.frameWidth,this._imageOptions.frameHeight,-i/2,-s/2,i,s)}update(t){super.update(t),this._scale.x.update(t),this._scale.y.update(t),this._shaker.update(t),this._angle.update(t)}followBody(){!this.parent.body||this.parent.addComponent(new Ht({target:this}))}setSize(t,i){this._width=t,this._height=i}},Ht=class extends C{constructor(t){super();this._target=t.target}update(t){let i=this.parent.body;this._target.angle=i.angle,this._target.offset=i.offset}};var T=class extends x{constructor(t){super(t)}draw(t){t.globalAlpha=this.opacity,this.drawImage(t,this._width,this._height,!1)}drawShadow(t){this._shadowColor.fill(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill()}};var I=class extends x{_anims=new Map;_currentAnim=null;_paused=!0;_framePos={x:0,y:0};constructor(t){super(t)}get currentAnim(){return this._currentAnim?this._currentAnim.name:null}addAnim(t,i){this._anims.set(t,i)}play(t,i,s,o){if(t==null){this._currentAnim&&(this._paused=!1);return}if(this.currentAnim==t)return;this._paused=!1;let r={name:t,rate:i,repeat:s,OnEnd:o,frame:0,counter:0};this._currentAnim=r,this._framePos=this._anims.get(r.name)[r.frame]}reset(){this._currentAnim&&(this._currentAnim.frame=0,this._currentAnim.counter=0)}pause(){this._paused=!0}update(t){if(super.update(t),this._paused)return;let i=this._currentAnim,s=this._anims.get(i.name);i.counter+=t*1e3,i.counter>=i.rate&&(i.counter=0,++i.frame,i.frame>=s.length&&(i.frame=0,i.OnEnd&&i.onEnd(),i.repeat||(this._currentAnim=null,this._paused=!0)),this._framePos=s[i.frame])}draw(t){t.globalAlpha=this.opacity,this.drawImage(t,this._width,this._height,!1,this._framePos)}drawShadow(t){this._shadowColor.fill(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill()}};var lt=class{constructor(t){this._image=t.image,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight,this._columns=t.columns,this._tileData=[]}get image(){return this._image}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get columns(){return this._columns}createTile(t,i){let s=this._getData(i),o=t.createEntity(),r;return s&&s.animation?(r=new I({image:{name:this._image,frameWidth:this._tileWidth,frameHeight:this._tileHeight}}),r.addAnim("loop",s.animation.frames.map(a=>this._getPos(a))),r.play("loop",s.animation.frameRate,!0)):r=new T({image:{name:this._image,frameWidth:this._tileWidth,frameHeight:this._tileHeight,framePosition:this._getPos(i)}}),o.addComponent(r,"TileSprite"),o.addComponent(new Ft({properties:s==null?[]:s.properties})),o}addAnim(t,i,s){let o=this._getData(t);o||(o=this._createData(t)),o.animation={frameRate:i,frames:s}}addProperty(t,i,s){let o=this._getData(t);o||(o=this._createData(t)),o.properties.push({name:i,value:s})}_getPos(t){return{x:t%this._columns,y:Math.floor(t/this._columns)}}_createData(t){let i={id:t,properties:[]};return this._tileData.push(i),i}_getData(t){return this._tileData.find(i=>i.id==t)}},Ft=class extends C{_properties=new Map;constructor(t){super();for(let i of t.properties)this._properties.set(i.name,i.value)}get properties(){return this._properties}};var yt={};F(yt,{Circle:()=>ft,Drawable:()=>L,FixedDrawable:()=>x,Line:()=>pt,Path:()=>mt,Picture:()=>T,Polygon:()=>z,Rect:()=>ut,RegularPolygon:()=>ct,RoundedRect:()=>_t,Sprite:()=>I,Text:()=>gt});var ut=class extends x{constructor(t){super(t)}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),t.fill(),this._strokeWidth!=0&&t.stroke(),this._image&&this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath(),t.rect(-this._width/2,-this._height/2,this._width,this._height),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var z=class extends x{_points;constructor(t){super(t);this._points=u.parseValue(t.points,[])}getBoundingBox(){let t=this._points,i=0,s=0;for(let r=0;r<t.length;++r){let a=t[r],h=a.length,l=Math.hypot(a[h-2],a[h-1]);l>i&&(i=l,s=r)}let o=i*2;return{width:o*Math.abs(this.scale.x),height:o*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath();for(let i=0;i<=this._points.length;++i){let s=this._points[i%this._points.length];if(i==0){let o=s.length;t.moveTo(s[o-2],s[o-1])}else s.length==6?t.bezierCurveTo(...s):s.length==4?t.quadraticCurveTo(...s):t.lineTo(...s)}t.closePath(),t.fill(),this._strokeWidth!=0&&t.stroke(),this._image&&this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath();for(let i=0;i<=this._points.length;++i){let s=this._points[i%this._points.length];if(i==0){let o=s.length;t.moveTo(s[o-2],s[o-1])}else s.length==6?t.bezierCurveTo(...s):s.length==4?t.quadraticCurveTo(...s):t.lineTo(...s)}t.closePath(),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}},ct=class extends z{_radius;_sides;constructor(t){super(t);this._radius=t.radius,this._sides=t.sides,this._initPoints()}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0),this._initPoints()}get sides(){return this._sides}set sides(t){this._sides=Math.max(t,3),this._initPoints()}_initPoints(){let t=[];for(let i=0;i<this.sides;++i){let s=Math.PI*2/this.sides*i;t.push([Math.cos(s)*this.radius,Math.sin(s)*this.radius])}this._points=t}getBoundingBox(){return{width:this._radius*2*Math.abs(this.scale.x),height:this._radius*2*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}},_t=class extends z{_borderRadius;constructor(t){super(t);this._borderRadius=t.borderRadius,this._initPoints()}get width(){return this._width}set width(t){this._width=t,this._initPoints()}get height(){return this._height}set height(t){this._height=t,this._initPoints()}get borderRadius(){return this._borderRadius}set borderRadius(t){this._borderRadius=t,this._initPoints()}_initPoints(){let t=this._width,i=this._height,s=this._borderRadius;this._points=[[-t/2,-(i/2-s)],[-t/2,-i/2,-(t/2-s),-i/2],[t/2-s,-i/2],[t/2,-i/2,t/2,-(i/2-s)],[t/2,i/2-s],[t/2,i/2,t/2-s,i/2],[-(t/2-s),i/2],[-t/2,i/2,-t/2,i/2-s]]}};var pt=class extends x{_length;constructor(t){super(t);this._length=t.length}get length(){return this._length}set length(t){this._length=Math.max(t,0)}getGoundingBox(){let t=d.fromAngle(this._angle).mult(this._length/2);return{width:this._length*Math.abs(this.scale.x),height:this._length*Math.abs(this.scale.y),x:t.x,y:t.y}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._strokeColor.stroke(t),t.beginPath(),t.moveTo(0,0),t.lineTo(this._length,0),t.stroke()}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.stroke(t),t.beginPath(),t.moveTo(0,0),t.lineTo(this._length,0),t.stroke()}};var ft=class extends x{_radius;constructor(t){super(t);this._radius=t.radius}get radius(){return this._radius}set radius(t){this._radius=t}getBoundingBox(){return{width:this._radius*2*Math.abs(this.scale.x),height:this._radius*2*Math.abs(this.scale.y),x:this.position.x-this._center.x*Math.abs(this.scale.x),y:this.position.y-this._center.y*Math.abs(this.scale.y)}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath(),t.arc(0,0,this._radius,0,2*Math.PI),t.fill(),this.strokeWidth!=0&&t.stroke(),this._image&&this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath(),t.arc(0,0,this._radius,0,2*Math.PI),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var gt=class extends x{_text;_lines;_padding;_align;_fontFamily;_fontSize;_fontStyle;constructor(t){super(t);this._text=u.parseValue(t.text,""),this._lines=this._text.split(/\n/),this._padding=u.parseValue(t.padding,0),this._align=u.parseValue(t.align,"center"),this._fontSize=u.parseValue(t.fontSize,16),this._fontFamily=u.parseValue(t.fontFamily,"Arial"),this._fontStyle=u.parseValue(t.fontStyle,"normal"),this._computeDimensions()}get linesCount(){return this._lines.length}get lineHeight(){return this._fontSize+this._padding*2}get text(){return this._text}set text(t){this._text=t,this._lines=this._text.split(/\n/),this._computeDimensions()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=Math.max(t,0),this._computeDimensions()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this._computeDimensions()}get padding(){return this._padding}set padding(t){this._padding=t,this._computeDimensions()}get align(){return this._align}set align(t){this._align=t,this._computeDimensions()}_computeDimensions(){this._height=this.lineHeight*this.linesCount;let t=0,i=document.createElement("canvas").getContext("2d");i.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`;for(let s of this._lines){let o=i.measureText(s).width;o>t&&(t=o)}this._width=t+this._padding*2}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`,t.textAlign=this._align,t.textBaseline="middle",t.beginPath();for(let i=0;i<this.linesCount;++i)t.fillText(this._lines[i],this._padding,this.lineHeight*i-(this.linesCount-1)/2*this.lineHeight),this._strokeWidth&&t.strokeText(this._lines[i],this._padding,this.lineHeight*i-(this.linesCount-1)/2*this.lineHeight)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t);let i=this._align=="left"?-this._width/2:this._align=="right"?this._width/2:0;t.font=`${this._fontStyle} ${this._fontSize}px '${this._fontFamily}'`,t.textAlign=this._align,t.textBaseline="middle",t.beginPath();for(let s=0;s<this.linesCount;++s)this.fillColor!="transparent"&&t.fillText(this._lines[s],i+this._padding,this.lineHeight*s-(this.linesCount-1)/2*this.lineHeight),this._strokeWidth&&t.strokeText(this._lines[s],i+this._padding,this.lineHeight*s-(this.linesCount-1)/2*this.lineHeight)}};var mt=class extends L{_points;constructor(t){super(t);this._points=t.points}getBoundingBox(){let t=this._points,i=1/0,s=-1/0,o=1/0,r=-1/0;for(let a=0;a<t.length;++a){let h=t[a],l=h.length,_=h[l-2],p=h[l-1];_<i?i=_:_>s&&(s=_),p<o?o=p:p>r&&(r=p)}return{width:Math.abs(s-i),height:Math.abs(r-o),x:(s+i)/2,y:(r+o)/2}}draw(t){t.globalAlpha=this.opacity,t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._fillColor.fill(t),this._strokeColor.stroke(t),t.beginPath();for(let i=0;i<=this._points.length;++i){let s=this._points[i%this._points.length];if(i==0){let o=s.length;t.moveTo(s[o-2],s[o-1])}else s.length==6?t.bezierCurveTo(...s):s.length==4?t.quadraticCurveTo(...s):t.lineTo(...s)}t.closePath(),t.fill(),this._strokeWidth!=0&&t.stroke(),this._image&&this.drawImage(t)}drawShadow(t){t.lineWidth=this.strokeWidth,t.lineCap=this.strokeCap,this._shadowColor.fill(t),this._shadowColor.stroke(t),t.beginPath();for(let i=0;i<=this._points.length;++i){let s=this._points[i%this._points.length];if(i==0){let o=s.length;t.moveTo(s[o-2],s[o-1])}else s.length==6?t.bezierCurveTo(...s):s.length==4?t.quadraticCurveTo(...s):t.lineTo(...s)}t.closePath(),this.fillColor!="transparent"&&t.fill(),this.strokeWidth!=0&&t.stroke()}};var wt={};F(wt,{Ball:()=>S,Box:()=>et,Polygon:()=>b,Ray:()=>R,RegularPolygon:()=>it});var xt={};F(xt,{RadialLight:()=>bt});var vt=class extends C{_color;_scale;constructor(t){super();this._type="light",this._color=new k(t.color),this._scale=new j(u.parseValue(t.scale,1))}get color(){return this._color._color}set color(t){this._color.set(t)}get scale(){return this._scale.value}set scale(t){this._scale.value=t}scaleTo(t,i,s="linear",o=null){this._scale.animate(t,i,s,o)}initComponent(){this.scene.addLight(this)}drawInternal(t){t.save(),t.translate(this.position.x,this.position.y),t.scale(this.scale,this.scale),t.rotate(this.angle),this.draw(t),t.restore()}draw(t){}update(t){this._scale.update(t),this._angle.update(t)}};var bt=class extends vt{_radius;_angleRange;constructor(t){super(t);this._radius=t.radius,this._angleRange=u.parseValue(t.angleRange,Math.PI*2)}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,0)}get angleRange(){return this._angleRange}set angleRange(t){this._angleRange=y.clamp(t,0,Math.PI*2)}draw(t){this._color.fill(t),t.beginPath(),t.arc(0,0,this.radius,-this.angleRange/2,this.angleRange/2),t.lineTo(0,0),t.closePath(),t.fill()}};var qt="Lancelot",J={Game:ht,Component:C,utils:dt,drawable:yt,physics:wt,light:xt};if(typeof module=="object"&&typeof module.exports=="object")module.exports=J;else if(typeof define=="function"&&define.amd)define(qt,[],J);else{let n=typeof globalThis!="undefined"?globalThis:self;n[qt]=J}var Cs=J;export{Cs as default};
