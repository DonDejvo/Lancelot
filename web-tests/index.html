<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
    background: black;
    margin: 0;
    position: fixed;
    width: 100%;
    height: 100%;
}
    </style>
</head>
<body>
    <script type="module">
import defaultExport from "../src/Lancelot.js";

const WIDTH = 720, HEIGHT = 480;
const { Vector, Tileset, LevelMaker, math } = Lancelot.utils;

let game;
addEventListener("DOMContentLoaded", () => {
    game = new Lancelot.Game({
        width: WIDTH,
        height: HEIGHT,
        quality: 0.2,
        init: init,
        preload: preload,
        controls: {
            active: true,
            theme: "dark"
        }
    });
});

function preload() {
    this.load.image("background", "background.png");
    this.load.image("tileset", "tileset.png");
    this.load.image("objects", "objects.png");
    this.load.json("level", "level.json");
}

function init() {

    const level = this.resources.get("level");
    
    const tilesets = [
        Tileset.loadFromTiledJSON(level.tilesets[0], "tileset"),
        Tileset.loadFromTiledJSON(level.tilesets[1], "background"),
        Tileset.loadFromTiledJSON(level.tilesets[2], "objects"),
    ];

    const levelMaker = new LevelMaker({
        tileWidth: 64,
        tileHeight: 64
    });

    const scene = new Lancelot.Scene(this, "main", 0, {
        background: "rgb(25,25,25)",
        physics: {
            bounds: [[0, 0], [levelMaker.tileWidth * level.width, levelMaker.tileHeight * level.height]]
        }
    });
    scene.play();
    // scene.debug = true;

    levelMaker.createLevel(scene, level, tilesets);

    scene.camera.onUpdate((dt) => {

        let v = new Vector();
        if(scene.isKeyPressed("ArrowLeft")) {
            v.x = -1;
        } else if(scene.isKeyPressed("ArrowRight")) {
            v.x = 1;
        } else {
            v.x = 0;
        }
        if(scene.isKeyPressed("ArrowUp")) {
            v.y = -1;
        } else if(scene.isKeyPressed("ArrowDown")) {
            v.y = 1;
        } else {
            v.y = 0;
        }
        if(scene.isKeyPressed("d")) {
            scene.camera.scale -= scene.camera.scale * 0.01 * dt * 30;
        } else if(scene.isKeyPressed("e")) {
            scene.camera.scale += scene.camera.scale * 0.01 * dt * 30;
        }
        v.unit().mult(400);
        scene.camera.velocity = v;
    });



    const scene2 = new Lancelot.Scene(this, "ui", 1, {
        background: "transparent"
    });
    scene2.play();
    

    const shape = scene2.create();
    shape.position.y = HEIGHT * 0;
    shape.add(new Lancelot.drawable.Star({
        width: WIDTH,
        height: HEIGHT * 0.2,
        outerRadius: 80,
        innerRadius: 40,
        peaks: 5,
        fillColor: "rgba(0,0,0,0.5)",
        strokeColor: "darkred",
        strokeWidth: 4
    }), "Shape");
    shape.onUpdate((dt) => {
        const comp = shape.get("Shape");
        //comp.angle += dt;
    });
    shape.moveBy(new Vector(300, 0), 2000, "linear");

    const shape2 = scene2.create();
    shape2.position.y = HEIGHT * 0.3;
    shape2.add(new Lancelot.drawable.Star({
        width: WIDTH,
        height: HEIGHT * 0.2,
        outerRadius: 80,
        innerRadius: 40,
        peaks: 5,
        fillColor: "rgba(0,0,0,0.5)",
        strokeColor: "darkred",
        strokeWidth: 4
    }), "Shape");
    shape2.moveBy(new Vector(300, 0), 2000, "ease-in-out");

    this.timeout.set(() => this.quality = 1.0, 2000);
}
    </script>
</body>
</html>