<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <script type="module">
        import defaultExport from "../src/Lancelot.js";

        class Controller01 extends Lancelot.Component {
            constructor() {
                super();
            }
            Update(elapsedTimeS) {
                const line = this.GetComponent("Line");
                line.angle = this.parent.body.angle;
                if(this.parent.body.collisions.all.size == 0) {
                    line.range = 500;
                }
                
            }
        }

        class Controller02 extends Lancelot.Component {
            constructor() {
                super();
            }
            Update(elapsedTimeS) {
                const rect = this.GetComponent("Rect");
                rect.angle = this.parent.body.angle;
            }
        }

        class Controller04 extends Lancelot.Component {
            constructor() {
                super();
            }
            Update(elapsedTimeS) {
                const poly = this.GetComponent("Shape");
                poly.angle = this.parent.body.angle;
            }
        }

        const game = new Lancelot.Game({
            width: 800,
            height: 540,
            init: init
        });

        function init() {

            const scene = this.CreateScene("scene01", {
                background: "#4A4A4A",
                light: "#111"
            });
            this.PlayScene("scene01");

            const createEntity01 = () => {

                const entity = scene.CreateEntity();
                let line;
                entity.AddComponent(line = new Lancelot.drawable.Line({
                    range: 500,
                    strokeStyle: "linear;0,-4,0,4;red=0;pink=0.5;red=1",
                    strokeWidth: 10,
                    zIndex: 99
                }));
                let body;
                entity.AddComponent(body = new Lancelot.physics.Ray({
                    range: 500
                }));
                entity.AddComponent(new Controller01());
                
                body.angularVelocity = 0.3;
                body.angle = 0.1
                body.AddBehavior("e02", "detect", (other, point) => {
                    line.range = Lancelot.Vector.Dist(body.position, point);
                });

                return entity;
            }

            const createEntity02 = (x, y, a) => {
                const entity = scene.CreateEntity();
                entity.groupList.add("e02");
                entity.position.Set(x, y);

                let box;
                entity.AddComponent(box = new Lancelot.drawable.Rect({
                    width: 120,
                    height: 80,
                    fillStyle: "lime"
                }));
                box.angle = a;
                let body;
                entity.AddComponent(body = new Lancelot.physics.Box({
                    width: 120,
                    height: 80
                }));
                entity.AddComponent(new Controller02());
                body.angle = a;
                body.angularVelocity = 0.5;

                return entity;
            }

            const createEntity03 = (x, y) => {
                const entity = scene.CreateEntity();
                entity.groupList.add("e02");
                entity.position.Set(x, y);

                let box;
                entity.AddComponent(box = new Lancelot.drawable.Circle({
                    radius: 60,
                    fillStyle: "cyan"
                }));
                
                let body;
                entity.AddComponent(body = new Lancelot.physics.Ball({
                    radius: 60
                }));

                return entity;
            }

            const createEntity04 = (x, y, a, sides) => {
                const entity = scene.CreateEntity();
                entity.groupList.add("e02");
                entity.position.Set(x, y);

                let box;
                entity.AddComponent(box = new Lancelot.drawable.RegularPolygon({
                    radius: 60,
                    sides: sides,
                    fillStyle: "pink"
                }), "Shape");
                
                let body;
                entity.AddComponent(body = new Lancelot.physics.RegularPolygon({
                    radius: 60,
                    sides: sides
                }));
                entity.AddComponent(new Controller04());
                body.angle = a;
                body.angularVelocity = 0.5;

                return entity;
            }

            const ray = createEntity01();
            ray.AddComponent(new Lancelot.light.RadialLight({
                color: "radial;0,0,0,0,0,250;white=0;rgba(255,255,255,0)=1",
                radius: 250
            }));

            createEntity04(200, 0, 0.7, 5);
            createEntity04(100, 200, 0.1, 3);
            createEntity03(-100, 150);
            createEntity02(-250, -100, 0.3);
            createEntity02(0, -200, 1.4);
        }
        
    </script>
    
</body>
</html>