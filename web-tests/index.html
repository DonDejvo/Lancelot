<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <script type="module">
        import defaultExport from "../src/Lancelot.js";

        class Controller extends Lancelot.Component {
            constructor() {
                super();

            }
            Update() {
                const sprite = this.GetComponent("Sprite");
                const body = this.parent.body;

                if(body.mass !== 0) {
                    body.velocity.y += 5;
                }
                sprite.angle = body.angle;
            }
        }

        const game = new Lancelot.Game({
            width: 420,
            height: 480,
            background: "#242424",
            init: init
        });

        function init() {
            
            const scene = this.CreateScene("test", {
                cellDimensions: [40, 40],
                relaxationCount: 5
            });
            this.PlayScene("test");

            const InitBall = (x, y, a, vx, vy, va, w, h, m = 0) => {
                const e1 = scene.CreateEntity();
                e1.groupList.add("m1");
                e1.position.Set(x, y);

                const body = new Lancelot.physics.Ball({
                    radius: w / 2,
                    mass: m,
                    bounce: 0.9,
                    friction: { x: 0.01, y: 0.01, angular: 0.01 }
                });
                e1.AddComponent(body);
                body.angle = a;
                body.velocity.Set(vx, vy);
                body.angularVelocity = va;
                body.AddBehavior("m1", "resolve", (other) => {
                    
                });

                const sprite = new Lancelot.drawable.Circle({
                    radius: w / 2,
                    fillStyle: "grey",
                    strokeStyle: "white",
                    strokeWidth: 1
                });
                e1.AddComponent(sprite, "Sprite");
                e1.AddComponent(new Controller());
                return e1;
            }

            const InitBox = (x, y, a, vx, vy, va, w, h, m = 0) => {
                const e1 = scene.CreateEntity();
                e1.groupList.add("m1");
                e1.position.Set(x, y);

                const body = new Lancelot.physics.Box({
                    width: w,
                    height: h,
                    mass: m,
                    bounce: 0.9,
                    friction: { x: 0.01, y: 0.01, angular: 0.01 }
                });
                e1.AddComponent(body);
                body.angle = a;
                body.velocity.Set(vx, vy);
                body.angularVelocity = va;
                body.AddBehavior("m1", "resolve", (other) => {
                    
                });

                const sprite = new Lancelot.drawable.Rect({
                    width: w,
                    height: h,
                    fillStyle: "grey",
                    strokeStyle: "white",
                    strokeWidth: 1
                });
                e1.AddComponent(sprite, "Sprite");
                e1.AddComponent(new Controller());
                return e1;
            }

            InitBox(0, 220, 0, 0, 0, 0, 420, 20);
            InitBox(-200, 0, 0, 0, 0, 0, 20, 480);
            InitBox(200, 0, 0, 0, 0, 0, 20, 480);
            for(let i = 0; i < 1; ++i) {
                InitBall((i % 8) * 40 - 160, -220 - Math.floor(i / 8) * 40, 0, Lancelot.math.rand(-100, 100), 0, 5, 20, 20, 5);
            }
            
            
        }

        
    </script>
    
</body>
</html>