<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <script type="module">
        import defaultExport from "../src/Lancelot.js";

        class TransitionController extends Lancelot.Component {
            constructor(params) {
                super();
                this.dur = params.dur;
                this.counter = 0;
            }
            Update(elapsedTimeS) {
                const light = this.GetComponent("RadialLight");
                this.counter += elapsedTimeS * 1000;
                const progress = Lancelot.math.sat(this.counter / this.dur);
                const dist = Lancelot.math.lerp(progress, 300, 0);
                const angle = Lancelot.math.lerp(progress, -0.8, 4 * Math.PI);

                light.position.Set(dist * Math.cos(angle), dist * Math.sin(angle));
                light.radius = progress * 600;

                const count = 2;
                if(this.counter > this.dur) {
                    const progress1 = (this.counter * count % this.dur) / this.dur;
                    let [from, to] = Math.floor(this.counter * count / this.dur) % 2 == 0 ? [50, 250] : [250, 50];
                    light.color = `rgb(${Lancelot.math.lerp(progress1, from, to)}, 0, 0)`;
                }
            }
        }

        const game = new Lancelot.Game({
            width: 800,
            height: 540,
            preload: preload,
            init: init
        });

        function preload() {
            this.loader.OnProgress((_, obj) => {
                console.log(obj);
            });
            this.loader.AddImage("vikings", "jpg.jpg");
        }

        function init() {

            const scene = this.CreateScene("x", {
                background: "black",
                light: "black"
            });
            scene.Play();

            let light = scene.CreateEntity();
            light.AddComponent(new Lancelot.light.RadialLight({
                color: "white",
                radius: 5
            }));
            light.AddComponent(new TransitionController({
                dur: 2000
            }));

            let bg = scene.CreateEntity();
            bg.AddComponent(new Lancelot.drawable.Image({
                image: scene.resources.get("vikings"),
                width: 800,
                height: 540
            }));

        }
        
    </script>
    
</body>
</html>