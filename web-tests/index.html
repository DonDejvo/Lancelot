<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
    background: black;
    margin: 0;
    position: fixed;
    width: 100%;
    height: 100%;
}
    </style>
</head>
<body>
    <script type="module">
import defaultExport from "../src/Lancelot.js";

const WIDTH = 960, HEIGHT = 640;
const { Vector, Tileset, LevelMaker } = Lancelot.utils;

let game;
addEventListener("DOMContentLoaded", () => {
    game = new Lancelot.Game({
        width: WIDTH,
        height: HEIGHT,
        init: init,
        preload: preload,
        controls: {
            active: true,
            theme: "dark"
        }
    });
});

function preload() {
    this.load.image("background", "background.png");
    this.load.image("tileset", "tileset.png");
    this.load.image("objects", "objects.png");
    this.load.json("level", "level.json");
}

function init() {

    const level = this.resources.get("level");
    
    const tilesets = [
        Tileset.loadFromTiledJSON(level.tilesets[0], "tileset"),
        Tileset.loadFromTiledJSON(level.tilesets[1], "background"),
        Tileset.loadFromTiledJSON(level.tilesets[2], "objects"),
    ];

    const levelMaker = new LevelMaker({
        tileWidth: 128,
        tileHeight: 128
    });

    const scene = this.createScene("main", 0, {
        background: "#242424",
        physics: {
            bounds: [[0, 0], [levelMaker.tileWidth * level.width, levelMaker.tileHeight * level.height]]
        }
    });
    scene.debug = true;
    scene.play();

    levelMaker.createLevel(scene, level, tilesets);

    scene.camera.onUpdate((dt) => {
        let v = new Vector();
        if(scene.isKeyPressed("ArrowLeft")) {
            v.x = -1;
        } else if(scene.isKeyPressed("ArrowRight")) {
            v.x = 1;
        } else {
            v.x = 0;
        }
        if(scene.isKeyPressed("ArrowUp")) {
            v.y = -1;
        } else if(scene.isKeyPressed("ArrowDown")) {
            v.y = 1;
        } else {
            v.y = 0;
        }
        if(scene.isKeyPressed("d")) {
            scene.camera.scale -= scene.camera.scale * 0.01 * dt * 30;
        } else if(scene.isKeyPressed("e")) {
            scene.camera.scale += scene.camera.scale * 0.01 * dt * 30;
        }
        v.unit().mult(400);
        scene.camera.velocity = v;
    });
    
}
    </script>
</body>
</html>